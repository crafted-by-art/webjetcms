<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Tools.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjet8v9</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm</a> &gt; <span class="el_source">Tools.java</span></div><h1>Tools.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm;

import org.apache.commons.lang.StringUtils;
import org.apache.commons.lang.time.FastDateFormat;
import org.apache.http.Header;
import org.apache.http.HttpResponse;
import org.apache.http.client.fluent.Form;
import org.apache.http.client.fluent.Request;
import org.apache.http.client.fluent.Response;
import org.apache.http.util.EntityUtils;
import org.apache.struts.util.ResponseUtils;
import org.json.JSONArray;
import org.json.JSONException;
import org.jsoup.Jsoup;
import org.springframework.context.ApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import sk.iway.Password;
import sk.iway.iwcm.common.DocTools;
import sk.iway.iwcm.common.FilePathTools;
import sk.iway.iwcm.components.basket.BasketDB;
import sk.iway.iwcm.components.domainRedirects.DomainRedirectDB;
import sk.iway.iwcm.database.SimpleQuery;
import sk.iway.iwcm.doc.DocDB;
import sk.iway.iwcm.doc.DocDetails;
import sk.iway.iwcm.form.FormDB;
import sk.iway.iwcm.helpers.RequestHelper;
import sk.iway.iwcm.i18n.Prop;
import sk.iway.iwcm.io.IwcmFile;
import sk.iway.iwcm.io.IwcmFsDB;
import sk.iway.iwcm.stat.StatDB;

import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import javax.servlet.jsp.JspWriter;
import javax.servlet.jsp.PageContext;
import javax.swing.*;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.*;
import java.math.BigDecimal;
import java.net.InetAddress;
import java.net.URL;
import java.net.URLConnection;
import java.nio.charset.Charset;
import java.security.Principal;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import java.text.*;
import java.util.List;
import java.util.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *  Podporne metody
 *
 *@Title        WebJET
 *@Company      Interway s.r.o. (www.interway.sk)
 *@Copyright    Interway s.r.o. (c) 2001-2002
 *@author       $Author: jeeff $
 *@version      $Revision: 1.6 $
 *@created      Nedeďż˝e, 2003, december 28
 *@modified     $Date: 2004/02/19 17:21:45 $
 */
<span class="fc" id="L72">public class Tools</span>
{
	public static final DecimalFormat decimalFormat;
	private static FastDateFormat simpleDateTimeFormat;
	private static FastDateFormat simpleDateFormat;
	private static FastDateFormat simpleTimeFormat;
	public static final Collator slovakCollator;

	static
	{
<span class="fc" id="L82">		decimalFormat = new DecimalFormat(&quot;0.##&quot;);</span>
<span class="fc" id="L83">		simpleDateFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateFormat&quot;));</span>
<span class="fc" id="L84">		simpleDateTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateTimeFormat&quot;));</span>
<span class="fc" id="L85">		simpleTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;timeFormat&quot;));</span>
<span class="fc" id="L86">		slovakCollator = Collator.getInstance(new Locale(&quot;sk&quot;));</span>
<span class="fc" id="L87">		slovakCollator.setStrength(Collator.SECONDARY);</span>
<span class="fc" id="L88">	}</span>

	/**
	 * Toto potrebujeme zavolat po inicializacii Constants aby bolo mozne zmenit pattern
	 */
	public static void reinitialize()
	{
<span class="fc" id="L95">		simpleDateFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateFormat&quot;));</span>
<span class="fc" id="L96">		simpleDateTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateTimeFormat&quot;));</span>
<span class="fc" id="L97">		simpleTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;timeFormat&quot;));</span>
<span class="fc" id="L98">	}</span>

	public static String formatDate(long date)
	{
<span class="pc bpc" id="L102" title="1 of 2 branches missed.">		if (date == 0) return &quot;&quot;;</span>
<span class="fc" id="L103">		return (formatDate(new Date(date)));</span>
	}
	public static String formatDate(Date date)
	{
<span class="fc bfc" id="L107" title="All 2 branches covered.">		if (date == null) return &quot;&quot;;</span>
<span class="fc" id="L108">		return (simpleDateFormat.format(date));</span>
	}
	public static String formatDate(Object o, String nullValue)
	{
<span class="nc bnc" id="L112" title="All 2 branches missed.">		if (o == null) return nullValue;</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">		if(o instanceof Date)</span>
<span class="nc" id="L114">			return simpleDateFormat.format((Date)o);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">		if(o instanceof java.sql.Timestamp)</span>
<span class="nc" id="L116">			return simpleDateFormat.format((java.sql.Timestamp)o);</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">		if(o instanceof java.sql.Date)</span>
<span class="nc" id="L118">			return simpleDateFormat.format((java.sql.Date)o);</span>
<span class="nc" id="L119">		return nullValue;</span>
	}
	public static String formatTime(long time)
	{
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">		if (time == 0) return &quot;&quot;;</span>
<span class="fc" id="L124">		return (formatTime(new Date(time)));</span>
	}
	public static String formatTime(Date date)
	{
<span class="fc bfc" id="L128" title="All 2 branches covered.">		if (date == null) return &quot;&quot;;</span>
<span class="fc" id="L129">		return (simpleTimeFormat.format(date));</span>
	}
	public static String formatDateTime(long time)
	{
<span class="fc" id="L133">		return (formatDate(new Date(time)) + &quot; &quot; + formatTime(new Date(time)));</span>
	}
	public static String formatDateTime(Date time)
	{
<span class="fc bfc" id="L137" title="All 2 branches covered.">		if (time == null) return &quot;&quot;;</span>
<span class="fc" id="L138">		return formatDateTime(time.getTime());</span>
	}
	public static String formatDateTime(Object o, String nullValue)
	{
<span class="fc bfc" id="L142" title="All 2 branches covered.">		if (o == null) return nullValue;</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">		if(o instanceof Date)</span>
<span class="fc" id="L144">			return formatDateTime(((Date)o).getTime());</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">		if(o instanceof java.sql.Timestamp)</span>
<span class="nc" id="L146">			return formatDateTime(((java.sql.Timestamp)o).getTime());</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">		if(o instanceof java.sql.Date)</span>
<span class="nc" id="L148">			return formatDateTime(((java.sql.Date)o).getTime());</span>
<span class="nc" id="L149">		return nullValue;</span>
	}

	public static String formatDateTimeSeconds(long time)
	{
<span class="fc" id="L154">		return formatDateTimeSeconds(new Date(time));</span>
	}

	public static String formatDateTimeSeconds(Date time)
	{
<span class="fc bfc" id="L159" title="All 2 branches covered.">		if (time == null) return &quot;&quot;;</span>
<span class="fc" id="L160">		return simpleDateTimeFormat.format(time);</span>
	}

	/**
	 * povodne renameTo robilo problemy a to take ze niekedy sa stary subor nedal
	 * zmazat a preto nebol vytvoreny ani novy
	 * riesenie -&gt; najprv vytvorim novy subor a ak sa da potom zmazem ten stary
	 *
	 *@param  oldFilePath  Description of the Parameter
	 *@param  newFilePath  Description of the Parameter
	 *@return              Description of the Return Value
	 */
	public static boolean renameFile(String oldFilePath, String newFilePath)
	{
<span class="nc bnc" id="L174" title="All 2 branches missed.">		if (IwcmFsDB.useDBStorage(IwcmFsDB.getVirtualPath(oldFilePath)))</span>
		{
<span class="nc" id="L176">			new IwcmFile(oldFilePath).renameTo(new IwcmFile(newFilePath));</span>
<span class="nc" id="L177">			return true;</span>
		}
<span class="nc" id="L179">		boolean renamed = false;</span>

		try
		{
<span class="nc" id="L183">			File renameFile = new File(oldFilePath);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">			if (renameFile.exists()==false)</span>
			{
<span class="nc" id="L186">				 Logger.error(Tools.class, &quot;renameFile(): zdrojovy subor &quot;+renameFile.getAbsolutePath()+&quot; neexistuje!&quot;);</span>
<span class="nc" id="L187">				 return false;</span>
			}

<span class="nc" id="L190">			renamed = renameFile.renameTo(new File(newFilePath));</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">			if (renamed == false)</span>
			{
<span class="nc" id="L193">				File newFile = new File(newFilePath);</span>
<span class="nc" id="L194">				File oldFile = new File(oldFilePath);</span>
<span class="nc" id="L195">				boolean fileCreated = newFile.createNewFile();</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">				if (!fileCreated)</span>
<span class="nc" id="L197">					throw new IllegalStateException(newFilePath+&quot; could not be created&quot;);</span>
<span class="nc" id="L198">				FileInputStream inStream = new FileInputStream(oldFile);</span>
				try
				{
<span class="nc" id="L201">					FileOutputStream out = new FileOutputStream(newFile);</span>
					try
					{
						int c;
<span class="nc" id="L205">						byte[] buff = new byte[150000];</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">						while ((c = inStream.read(buff)) != -1)</span>
						{
<span class="nc" id="L208">							out.write(buff, 0, c);</span>
						}
					}
<span class="nc" id="L211">					finally { out.close(); }</span>
				}
<span class="nc" id="L213">				finally { inStream.close(); }</span>

<span class="nc" id="L215">				renamed = true;</span>

				try
				{
					//skus ho zmazat
<span class="nc bnc" id="L220" title="All 2 branches missed.">					if(oldFile.delete() == false)</span>
<span class="nc" id="L221">						 Logger.error(Tools.class, &quot;renameFile(): zdrojovy subor &quot;+oldFile.getAbsolutePath()+&quot; sa nepodarilo vymazat!&quot;);</span>
				}
<span class="nc" id="L223">				catch (Exception ex)</span>
				{

<span class="nc" id="L226">				}</span>
			}
		}
<span class="nc" id="L229">		catch (Exception ex)</span>
		{

<span class="nc" id="L232">		}</span>

<span class="nc" id="L234">		return renamed;</span>
	}

	/**
	 * Otestuje, ci zadany string je prazdny
	 * @param s
	 * @return - true ak s je null, alebo prazdny, inak false
	 */
	public static boolean isEmpty(String s)
	{
<span class="fc" id="L244">		return StringUtils.isBlank(s);</span>
	}

	/**
	 * Otestuje, ci zadany string nie je prazdny
	 * @param s
	 * @return
	 */
	public static boolean isNotEmpty(String s)
	{
<span class="fc bfc" id="L254" title="All 2 branches covered.">		if (s==null) return false;</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">		return(!isEmpty(s));</span>
	}

	/**
	 * Otestuje, ci zadany StringBuilder je prazdny
	 * @param sb
	 * @return - true ak sb je null, alebo prazdny, inak false
	 */
	public static boolean isEmpty(StringBuilder sb)
	{
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">		if(sb==null)</span>
<span class="nc" id="L266">			return true;</span>

<span class="fc" id="L268">		return isEmpty(sb.toString());</span>
	}

	/**
	 * Otestuje, ci zadana kolekcia je prazdna
	 *
	 * @param c kolekcia
	 * @return true ak je kolekcia null alebo prazdna, inak false
	 */
	public static boolean isEmpty(Collection&lt;?&gt; c)
	{
<span class="fc bfc" id="L279" title="All 2 branches covered.">		if (null == c)</span>
<span class="fc" id="L280">			return true;</span>
<span class="fc" id="L281">		return c.isEmpty();</span>
	}

	/**
	 * Otestuje, ci zadany StringBuilder nie je prazdny
	 * @param sb
	 * @return
	 */
	public static boolean isNotEmpty(StringBuilder sb)
	{
<span class="fc bfc" id="L291" title="All 2 branches covered.">		return !isEmpty(sb);</span>
	}

	/**
	 * Otestuje, ci su dane retazce rovnake, pricom empty a empty sa pocitaju za rovnake.
	 *
	 * @param a  retazec alebo null
	 * @param b  retazec alebo null
	 * @return   true ak sďż˝ oba empty, alebo oba non-empty a equal
	 */
	public static boolean areSame(String a, String b)
	{
<span class="nc bnc" id="L303" title="All 2 branches missed.">		return isEmpty(a) ? isEmpty(b) : a.equals(b);</span>
	}

	/**
	 *
	 * Otestuje, ci zadany parameter je email
	 * @param email
	 * @return
	 */
	public static boolean isEmail(String email)
	{
<span class="fc bfc" id="L314" title="All 2 branches covered.">		if (Tools.isEmpty(email)) return false;</span>
<span class="fc" id="L315">		return email.matches(&quot;^[a-zA-Z0-9]+[a-zA-Z0-9._\\-+=#$%&amp;]*[a-zA-Z0-9]+@[a-zA-Z0-9]+[a-zA-Z0-9._-]*[a-zA-Z0-9]+\\.[a-zA-Z]{2,16}$&quot;);</span>
	}

	/**
	 * Otestuje, ci zadany string je telefonne cislo
	 */
	public static boolean isPhoneNumber(String phoneNumber) {
<span class="nc bnc" id="L322" title="All 2 branches missed.">		if (Tools.isEmpty(phoneNumber))</span>
<span class="nc" id="L323">			return false;</span>

		try
        {
<span class="nc" id="L327">            String[] regexp = FormDB.getRegExpByType(&quot;phone&quot;);</span>
<span class="nc bnc" id="L328" title="All 6 branches missed.">            if (regexp != null &amp;&amp; regexp.length&gt;2 &amp;&amp; Tools.isNotEmpty(regexp[2]))</span>
            {
<span class="nc bnc" id="L330" title="All 2 branches missed.">                if (phoneNumber.matches(regexp[2])) return true;</span>
<span class="nc" id="L331">                else return false;</span>
            }
        }
<span class="nc" id="L334">		catch (Exception ex)</span>
        {
<span class="nc" id="L336">            sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L337">        }</span>

		//regexp nie je definovany vratime true, ze je validny
<span class="nc" id="L340">		return true;</span>
	}

	/**
	 * Vykona preklad URL na ine URL, pouziva sa ak je potrebne loopback data stahovat z ineho portu / nazvu
	 * @param url
	 * @return
	 */
	public static String natUrl(String url)
	{
<span class="fc" id="L350">		String natUrlTranslate = Constants.getString(&quot;natUrlTranslate&quot;);</span>
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">		if (Tools.isEmpty(natUrlTranslate)) return url;</span>

<span class="nc" id="L353">		String urlOriginal = url;</span>
<span class="nc" id="L354">		url = Tools.replaceStrings(url, &quot;natUrlTranslate&quot;, true);</span>

<span class="nc" id="L356">		Logger.debug(Tools.class, &quot;natUrl: &quot;+urlOriginal+&quot;-&gt;&quot;+url);</span>

<span class="nc" id="L358">		return url;</span>
	}

	/**
	 * Nahradi vyrazy v texte podla konf. premennej constantName, vyrazy musia byt na novom riadku vo formate stary|novy, pouziva sa ked potrebujem nahradit viacero vyrazov
	 * @param text
	 * @param constantName
	 * @param replaceWholeLine - ak je true nahradia sa len vyrazy zhodne na novom riadku
	 * @return
	 */
	public static String replaceStrings(String text, String constantName, boolean replaceWholeLine)
	{
<span class="fc" id="L370">		String replaces = Constants.getString(constantName);</span>
<span class="pc bpc" id="L371" title="1 of 2 branches missed.">		if (Tools.isEmpty(replaces)) return text;</span>

		try
		{
<span class="nc" id="L375">			String[] urls = Tools.getTokens(replaces, &quot;\n&quot;);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">			if (urls.length==0) return text;</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">			for (String pair : urls)</span>
			{
<span class="nc bnc" id="L379" title="All 2 branches missed.">				if (Tools.isEmpty(pair)) continue;</span>
<span class="nc" id="L380">				String[] pairArray = pair.split(&quot;\\|&quot;);</span>
<span class="nc bnc" id="L381" title="All 4 branches missed.">				if (pairArray==null || pairArray.length!=2) continue;</span>

<span class="nc bnc" id="L383" title="All 2 branches missed.">				if (replaceWholeLine)</span>
				{
<span class="nc bnc" id="L385" title="All 4 branches missed.">					if (text.startsWith(pairArray[0]) == true &amp;&amp; text.startsWith(pairArray[1]) == false)</span>
					{
<span class="nc" id="L387">						text = Tools.replace(text, pairArray[0], pairArray[1]);</span>
					}
				}
				else
				{
<span class="nc" id="L392">					text = Tools.replace(text, pairArray[0], pairArray[1]);</span>
				}
			}
		}
<span class="nc" id="L396">		catch (Exception ex)</span>
		{
<span class="nc" id="L398">		}</span>

<span class="nc" id="L400">		return text;</span>
	}

	/**
	 * Autorizuje sa pomozou tokenu, stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param token
	 * @return
	 */
	public static String authWithTokenAndDownloadUrl(String url, String token)
	{
<span class="nc" id="L411">		Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L412">		headers.put(&quot;Authorization&quot;, &quot;Bearer &quot; + token);</span>
<span class="nc" id="L413">		return downloadUrl( url,  SetCharacterEncodingFilter.getEncoding(),  null,0, headers);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @return
	 */
	public static String downloadUrl(String url)
	{
<span class="nc" id="L423">		return(downloadUrl(url, SetCharacterEncodingFilter.getEncoding(), null));</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url url
	 * @param characterEncoding encoding
	 * @return
	 */
	public static String downloadUrl(String url, String characterEncoding)
	{
<span class="fc" id="L434">		return(downloadUrl(url, characterEncoding, null));</span>
	}


	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @return
	 */
	public static String downloadUrl(String url, javax.servlet.http.Cookie [] cookies)
	{
<span class="nc" id="L445">		return(downloadUrl(url, SetCharacterEncodingFilter.getEncoding(), cookies));</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies)
	{
<span class="fc" id="L457">		return downloadUrl( url,  defaultEncoding,  cookies,0);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @param timeOutSeconds cas v sekundach po uplynuti ktorych sa spojenie prerusi.
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies,int timeOutSeconds)
	{
<span class="fc" id="L470">		return downloadUrl( url,  defaultEncoding,  cookies, timeOutSeconds, null);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @param timeOutSeconds cas v sekundach po uplynuti ktorych sa spojenie prerusi.
	 * @param headers dodatocne hlavicky ktore chceme requestu pridat
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies,int timeOutSeconds, Map&lt;String, String&gt; headers)
	{
<span class="fc" id="L484">		String body = null;</span>
<span class="pc bpc" id="L485" title="3 of 4 branches missed.">		if (url.startsWith(&quot;http://&quot;) || url.startsWith(&quot;https://&quot;))</span>
		{
			try
			{
<span class="pc bpc" id="L489" title="2 of 4 branches missed.">				if (timeOutSeconds &lt; 1 &amp;&amp; &quot;cloud&quot;.equals(Constants.getInstallName())) timeOutSeconds = 120;</span>

<span class="fc" id="L491">				url = Tools.natUrl(url);</span>

<span class="fc" id="L493">				Logger.debug(Tools.class,&quot;DownloadUrl: &quot; + url);</span>

				//body obsahuje URL adresu, ktoru je treba stiahnut
<span class="fc" id="L496">				URLConnection conn = null;</span>
<span class="fc" id="L497">				URL urlObj = new URL(url);</span>

<span class="pc bpc" id="L499" title="1 of 2 branches missed.">				if (url.startsWith(&quot;https://&quot;))</span>
				{
<span class="nc" id="L501">					doNotVerifyCertificates(urlObj.getHost());</span>
				}

<span class="fc" id="L504">				conn = urlObj.openConnection();</span>

<span class="pc bpc" id="L506" title="1 of 2 branches missed.">				if(timeOutSeconds &gt; 0)</span>
				{
<span class="nc" id="L508">					conn.setConnectTimeout(timeOutSeconds*1000);</span>
<span class="nc" id="L509">					conn.setReadTimeout(timeOutSeconds*1000);</span>
				}
				/*if (conn instanceof HttpURLConnection)
				{
					HttpURLConnection urlConn = (HttpURLConnection)conn;
				}*/
<span class="pc bpc" id="L515" title="1 of 2 branches missed.">				if(cookies != null)</span>
				{
<span class="nc bnc" id="L517" title="All 2 branches missed.">					for (javax.servlet.http.Cookie cookie : cookies) {</span>
<span class="nc" id="L518">					    conn.addRequestProperty(&quot;Cookie&quot;, cookie.getName() + &quot;=&quot; + cookie.getValue());</span>
					}
				}

<span class="pc bpc" id="L522" title="3 of 4 branches missed.">				if(headers != null &amp;&amp; headers.keySet().size() &gt; 0)</span>
				{
<span class="nc bnc" id="L524" title="All 2 branches missed.">					for(Map.Entry&lt;String, String&gt; entry : headers.entrySet())</span>
					{
<span class="nc" id="L526">						conn.setRequestProperty(entry.getKey(), entry.getValue());</span>
<span class="nc" id="L527">					}</span>
				}

<span class="fc" id="L530">				String ua = Constants.getString(&quot;downloadUrlUserAgent&quot;);</span>
<span class="pc bpc" id="L531" title="1 of 2 branches missed.">				if(Tools.isNotEmpty(ua)) conn.addRequestProperty(&quot;User-Agent&quot;, ua);</span>

<span class="fc" id="L533">				conn.setAllowUserInteraction(false);</span>
<span class="fc" id="L534">				conn.setDoInput(true);</span>
<span class="fc" id="L535">				conn.setDoOutput(false);</span>
<span class="fc" id="L536">				conn.connect();</span>
<span class="fc" id="L537">				String location = conn.getHeaderField(&quot;Location&quot;);</span>
<span class="fc" id="L538">				String encoding = conn.getHeaderField(&quot;Content-Type&quot;);</span>

<span class="pc bpc" id="L540" title="2 of 4 branches missed.">				if (encoding==null || encoding.indexOf(&quot;charset=&quot;)==-1)</span>
				{
<span class="nc" id="L542">					encoding = defaultEncoding;</span>
				}
				else
				{
<span class="fc" id="L546">					encoding = encoding.substring(encoding.indexOf(&quot;charset=&quot;)+8).trim();</span>
				}

<span class="fc" id="L549">				Logger.debug(Tools.class,&quot;---&gt; ENCODING: &quot; + encoding);</span>

<span class="fc" id="L551">				StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L552">				BufferedInputStream is = new BufferedInputStream(conn.getInputStream());</span>
<span class="fc" id="L553">				InputStreamReader in = new InputStreamReader(is, encoding);</span>
<span class="fc" id="L554">				char[] buffer = new char[8000];</span>
<span class="fc" id="L555">				int n = 0;</span>
				while (true)
				{
<span class="fc" id="L558">					 n = in.read(buffer);</span>
<span class="fc bfc" id="L559" title="All 2 branches covered.">					 if (n &lt; 1) break;</span>
<span class="fc" id="L560">					 sb.append(buffer, 0, n);</span>
				}
<span class="fc" id="L562">				in.close();</span>
<span class="fc" id="L563">				body = sb.toString();</span>

<span class="pc bpc" id="L565" title="1 of 2 branches missed.">				if (Tools.isNotEmpty(location))</span>
				{
<span class="nc" id="L567">					body = &quot;&lt;html&gt;&lt;body&gt;\n&quot; +</span>
							&quot;&lt;a href='&quot;+location+&quot;'&gt;&quot;+location+&quot;&lt;/a&gt;\n&quot; +
							&quot;&lt;script language='JavaScript'&gt;\n&quot; +
							&quot;window.location.href='&quot;+location+&quot;';\n&quot; +
							&quot;&lt;/script&gt;\n&quot; +
							&quot;&lt;/body&gt;&lt;/html&gt;&quot;;
				}

			}
<span class="nc" id="L576">			catch (Exception ex)</span>
			{
<span class="nc bnc" id="L578" title="All 4 branches missed.">			    if (url==null || url.contains(&quot;localconf.jsp&quot;)==false)</span>
                {
<span class="nc" id="L580">                    Logger.error(Tools.class, &quot;ERROR downloadUrl(&quot; + url + &quot;)&quot;);</span>
<span class="nc" id="L581">                    sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L582">                    body = null;</span>
                }
<span class="fc" id="L584">			}</span>
		}
<span class="fc" id="L586">		return(body);</span>
	}

	/**
	 * Stiahnutie stranky s vyuzitim Jakarta HTTP Client (zvlada POST aj GET)
	 * @param basePath
	 * @param req
	 * @return
	 */
	public static String downloadUrl(String basePath, HttpServletRequest req)
	{
<span class="nc" id="L597">		String data = null;</span>

		Request request;

<span class="nc" id="L601">		basePath = Tools.natUrl(basePath);</span>
		//WebJETProxySelector.setProxyForHttpClient(client, basePath);
<span class="nc" id="L603">		Logger.debug(Tools.class, &quot;downloadUrl: basePath=&quot;+basePath);</span>
		String name;
		String value;

<span class="nc bnc" id="L607" title="All 2 branches missed.">		if (&quot;GET&quot;.equalsIgnoreCase(req.getMethod()))</span>
		{
<span class="nc bnc" id="L609" title="All 6 branches missed.">			if (basePath.indexOf('?')==-1 &amp;&amp; req.getQueryString()!=null &amp;&amp; req.getQueryString().length()&gt;1)</span>
			{
<span class="nc" id="L611">				basePath = basePath + &quot;?&quot; + req.getQueryString();</span>
			}
<span class="nc" id="L613">			Logger.println(Tools.class,&quot;JE TO GET: &quot; + basePath);</span>
<span class="nc" id="L614">			request = Request.Get(basePath);</span>
		}
		else
		{
<span class="nc" id="L618">			Logger.println(Tools.class,&quot;JE TO POST: &quot; + basePath);</span>

<span class="nc" id="L620">			request = Request.Post(basePath);</span>
<span class="nc" id="L621">			Form form = Form.form();</span>
<span class="nc" id="L622">		   Enumeration&lt;String&gt; params = req.getParameterNames();</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">			while (params.hasMoreElements())</span>
			{
<span class="nc" id="L625">				name = params.nextElement();</span>
<span class="nc" id="L626">				value = req.getParameter(name);</span>
<span class="nc" id="L627">				Logger.println(Tools.class,&quot;param: &quot; + name+&quot;=&quot;+value);</span>
<span class="nc" id="L628">				form.add(name, value);</span>
			}
<span class="nc" id="L630">			request.bodyForm(form.build());</span>
		}

      //method.setFollowRedirects(true);
      //method.setStrictMode(false);

<span class="nc" id="L636">      Enumeration&lt;String&gt; e = req.getHeaderNames();</span>
<span class="nc bnc" id="L637" title="All 2 branches missed.">		while (e.hasMoreElements())</span>
		{
<span class="nc" id="L639">			name = e.nextElement();</span>
<span class="nc" id="L640">			value = req.getHeader(name);</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">			if (&quot;host&quot;.equalsIgnoreCase(name))</span>
			{
				//value = &quot;www2.ing.cz&quot;;
				try
				{
<span class="nc" id="L646">					URL url = new URL(basePath);</span>
<span class="nc" id="L647">					value = url.getHost();</span>
				}
<span class="nc" id="L649">				catch (Exception ex)</span>
				{

<span class="nc" id="L652">				}</span>
			}
<span class="nc" id="L654">			request.addHeader(name, value);</span>
<span class="nc" id="L655">			Logger.println(Tools.class,name+&quot;: &quot;+value);</span>
		}

<span class="nc" id="L658">		String contentType = req.getContentType()+&quot;; charset=&quot;+req.getCharacterEncoding();</span>
<span class="nc" id="L659">		request.setHeader(&quot;Content-Type&quot;, contentType);</span>
<span class="nc" id="L660">		Logger.println(Tools.class,&quot;header: Content-Type: &quot; + contentType);</span>

		try {
<span class="nc" id="L663">			Response response = request.execute();</span>
<span class="nc" id="L664">			HttpResponse httpResponse = response.returnResponse();</span>

			// write out the response headers
<span class="nc" id="L667">			Logger.println(Tools.class,&quot;*** Response ***&quot;);</span>
<span class="nc" id="L668">			Logger.println(Tools.class,&quot;Status Line: &quot; + httpResponse.getStatusLine().toString());</span>
<span class="nc" id="L669">			Logger.println(Tools.class,&quot;Status Code: &quot; + httpResponse.getStatusLine().getStatusCode());</span>
<span class="nc" id="L670">			Header[] responseHeaders = httpResponse.getAllHeaders();</span>
			Header h;
<span class="nc bnc" id="L672" title="All 2 branches missed.">			for (int i=0; i&lt;responseHeaders.length; i++)</span>
			{
<span class="nc" id="L674">				h = responseHeaders[i];</span>
				//Logger.print(this,responseHeaders[i]);
<span class="nc bnc" id="L676" title="All 4 branches missed.">				if (h.getName()!=null &amp;&amp; h.getValue() != null)</span>
				{
					//Logger.debug(Tools.class,&quot;Response headers: name=&quot;+h.getName()+&quot; value=&quot;+h.getValue());
					//res.setHeader(h.getName(), h.getValue());
				}
			}

<span class="nc" id="L683">			String encoding = null;</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">			if (httpResponse.getLastHeader(&quot;Content-Type&quot;)!=null) encoding = httpResponse.getLastHeader(&quot;Content-Type&quot;).getValue();</span>
<span class="nc bnc" id="L685" title="All 4 branches missed.">			if (encoding==null || encoding.indexOf(&quot;charset=&quot;)==-1)</span>
			{
<span class="nc" id="L687">				encoding = SetCharacterEncodingFilter.getEncoding();</span>
			}
			else
			{
<span class="nc" id="L691">				encoding = encoding.substring(encoding.indexOf(&quot;charset=&quot;)+8).trim();</span>
			}

<span class="nc" id="L694">			Logger.debug(Tools.class,&quot;---&gt; ENCODING: &quot; + encoding);</span>

<span class="nc" id="L696">			data = EntityUtils.toString(httpResponse.getEntity(), Charset.forName(encoding));</span>
		}
<span class="nc" id="L698">		catch (Exception ex) {</span>
<span class="nc" id="L699">			Logger.error(Tools.class, ex);</span>
<span class="nc" id="L700">		}</span>

<span class="nc" id="L702">		return(data);</span>
	}

	/**
	 * Rozparsuje retazec, najde tam pozadovany tag a v nom hodnotu atributu, napr v retazci
	 * &lt;topurl value=&quot;hodnota&quot;&gt;: tag=topurl, param=value, navratova hodnota je hodnota
	 * @param data
	 * @param tag
	 * @param param
	 * @return
	 */
	public static String parseTagValue(String data, String tag, String param)
	{
<span class="nc bnc" id="L715" title="All 6 branches missed.">		if (data == null || tag == null || param == null)</span>
		{
<span class="nc" id="L717">			return(null);</span>
		}
<span class="nc" id="L719">		String ret = null;</span>
		try
		{
			//najdi tag
<span class="nc" id="L723">			int startIndex = data.indexOf(&quot;&lt;&quot;+tag);</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">			if (startIndex != -1)</span>
			{
				//najdi param
<span class="nc" id="L727">				startIndex = data.indexOf(&quot; &quot;+param+&quot;=&quot;, startIndex);</span>
				//najdi uvodzovky
<span class="nc" id="L729">				startIndex = data.indexOf(&quot;\&quot;&quot;, startIndex);</span>
				//najdi koncove uvodzovky
<span class="nc" id="L731">				int endIndex = data.indexOf(&quot;\&quot;&quot;, startIndex+1);</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">				if (endIndex &gt; startIndex)</span>
				{
<span class="nc" id="L734">					ret =  data.substring(startIndex+1, endIndex);</span>
				}
			}
		}
<span class="nc" id="L738">		catch (Exception ex)</span>
		{
<span class="nc" id="L740">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L741">		}</span>
<span class="nc" id="L742">		return(ret);</span>
	}

	public static String join(String[] array)
	{
<span class="nc" id="L747">		return join(array, &quot;,&quot;);</span>
	}

	public static String join(String[] array, String glue)
	{
<span class="nc" id="L752">		StringBuilder result = new StringBuilder();</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">		for(int i = 0; i &lt; array.length; i++)</span>
		{
<span class="nc" id="L755">			result.append(array[i]);</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">			if (i &lt; array.length - 1) result.append(glue);</span>
		}

<span class="nc" id="L759">		return result.toString();</span>
	}

	public static &lt;T&gt; String join(List&lt;T&gt; array)
	{
<span class="nc" id="L764">		return join(array, &quot;,&quot;);</span>
	}

	public static &lt;T&gt; String join(List&lt;T&gt; array, String glue) {
<span class="fc" id="L768">		StringBuilder result = new StringBuilder();</span>
<span class="pc bpc" id="L769" title="1 of 4 branches missed.">		if (array == null || array.size()&lt;1) return &quot;&quot;;</span>
<span class="fc bfc" id="L770" title="All 2 branches covered.">		for(int i = 0; i &lt; array.size(); i++)</span>
		{
<span class="fc" id="L772">			result.append(array.get(i));</span>
<span class="fc bfc" id="L773" title="All 2 branches covered.">			if (i &lt; array.size() - 1) result.append(glue);</span>
		}

<span class="fc" id="L776">		return result.toString();</span>
	}

	/**
	 * Naformatuje velkost suboru ako 1,45 KB
	 * @param lengthLong
	 * @return
	 */
	public static String formatFileSize(long lengthLong)
	{
<span class="fc" id="L786">		String length = &quot;&quot;;</span>
<span class="pc bpc" id="L787" title="1 of 2 branches missed.">		if (lengthLong &gt; (1024 * 1024))</span>
		{
<span class="nc" id="L789">			length = decimalFormat.format((lengthLong / (1024D * 1024D))) + &quot; MB&quot;;</span>
		}
<span class="pc bpc" id="L791" title="1 of 2 branches missed.">		else if (lengthLong &gt; 1024)</span>
		{
<span class="nc" id="L793">			length = decimalFormat.format((lengthLong / 1024D)) + &quot; kB&quot;;</span>
		}
		else
		{
<span class="fc" id="L797">			length = decimalFormat.format(lengthLong) + &quot; B&quot;;</span>
		}
<span class="fc" id="L799">		return(length);</span>
	}

	/**
	 * Vrati timestamp aktualneho casu
	 * @return
	 */
	public static long getNow()
	{
<span class="fc" id="L808">		return System.currentTimeMillis();</span>
	}

	/**
	 * @deprecated - use Password.generatePassword
	 * @param len
	 * @return
	 */
	@Deprecated
	public static String generatePassword(int len)
	{
<span class="nc" id="L819">		return Password.generatePassword(len);</span>
	}

	/**
	 * skonvertuje String na int, vratane vsetkych kontrol. Ak sa nepodari, vrati defaultValue
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static int getIntValue(String value, int defaultValue)
	{
<span class="fc" id="L830">		int ret = defaultValue;</span>
		try
		{
<span class="fc bfc" id="L833" title="All 2 branches covered.">			if (value!=null)</span>
			{
<span class="fc" id="L835">				ret = Integer.parseInt(value.trim());</span>
			}
		}
<span class="fc" id="L838">		catch (Exception ex)</span>
		{

<span class="fc" id="L841">		}</span>
<span class="fc" id="L842">		return(ret);</span>
	}

	public static int getIntValue(Integer value)
	{
<span class="fc" id="L847">		return(getIntValue(value, 0));</span>
	}

	/**
	 * Ziska int hodnotu z Integera, alebo vrati defaultValue (ak je null)
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static int getIntValue(Integer value, int defaultValue)
	{
<span class="fc bfc" id="L858" title="All 2 branches covered.">		if (value==null)</span>
		{
<span class="fc" id="L860">			return(defaultValue);</span>
		}
<span class="fc" id="L862">		return(value.intValue());</span>
	}

	/**
	 * ziska integer hodnoty z pola stringov a ak je null, tak prazdny zoznam
	 *
	 * @param value
	 * @return
	 */
	public static List&lt;Integer&gt; getIntegerListValue(String[] value) {
<span class="nc" id="L872">		List&lt;Integer&gt; ret = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L873" title="All 2 branches missed.">		if (null != value)</span>
		{
<span class="nc bnc" id="L875" title="All 2 branches missed.">			for (String v : value)</span>
			{
<span class="nc" id="L877">				Integer i = Integer.valueOf(v);</span>
<span class="nc bnc" id="L878" title="All 2 branches missed.">				if (null != i)</span>
				{
<span class="nc" id="L880">					ret.add(i);</span>
				}
			}
		}
<span class="nc" id="L884">		return ret;</span>
	}

	public static double getDoubleValue(String value, double defaultValue)
	{
<span class="fc" id="L889">		double ret = defaultValue;</span>
		try
		{
<span class="pc bpc" id="L892" title="1 of 2 branches missed.">			if (value!=null)</span>
			{
<span class="fc" id="L894">				ret = Double.parseDouble(value.replace(',', '.').trim());</span>
			}
		}
<span class="fc" id="L897">		catch (Exception ex)</span>
		{

<span class="fc" id="L900">		}</span>
<span class="fc" id="L901">		return(ret);</span>
	}

	public static double getDoubleValue(Object value, double defaultValue)
	{
<span class="nc" id="L906">		double ret = defaultValue;</span>
		try
		{
<span class="nc bnc" id="L909" title="All 2 branches missed.">			if (value!=null)</span>
			{
<span class="nc" id="L911">				ret = ((Double)value).doubleValue();</span>
			}
		}
<span class="nc" id="L914">		catch (Exception ex)</span>
		{

<span class="nc" id="L917">		}</span>
<span class="nc" id="L918">		return(ret);</span>
	}

	/**
	 * Ziska BigDecimal hodnotu zo Stringu alebo z defaultValue ak je value null.
	 * Ak &lt;code&gt;value&lt;/code&gt; alebo &lt;code&gt;defaultValue&lt;/code&gt; nie je platnou reprezentaciou BigDecimal-u vrati BigDecimal s hodnotou 0.
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static BigDecimal getBigDecimalValue(String value,String defaultValue)
	{
<span class="fc" id="L930">		BigDecimal ret = null;</span>
		try
		{
<span class="pc bpc" id="L933" title="1 of 2 branches missed.">			if (value!=null)</span>
			{
<span class="fc" id="L935">				ret = new BigDecimal(value.replace(',', '.').replace(&quot; &quot;,&quot;&quot;).trim());</span>
			}
			else
			{
<span class="nc" id="L939">				ret = new BigDecimal(defaultValue);</span>
			}
		}
<span class="nc" id="L942">		catch (Exception ex)</span>
		{
<span class="nc" id="L944">			ret = BigDecimal.valueOf(0);</span>
<span class="fc" id="L945">		}</span>
<span class="fc" id="L946">		return ret;</span>

	}

	/**
	 * Ziska BigDecimal hodnotu zo Stringu, ak je null, alebo ak &lt;code&gt;value&lt;/code&gt; nie je platnou reprezentaciou BigDecimal-u
	 * vrati BigDecimal s hodnotou 0.
	 * @param value
	 * @return
	 */
	public static BigDecimal getBigDecimalValue(String value)
	{
<span class="nc" id="L958">		return getBigDecimalValue(value, &quot;0&quot;);</span>
	}

	public static long getLongValue(String value, long defaultValue)
	{
<span class="fc" id="L963">		long ret = defaultValue;</span>
		try
		{
<span class="pc bpc" id="L966" title="1 of 2 branches missed.">			if (value!=null)</span>
			{
<span class="fc" id="L968">				ret = Long.parseLong(value.replace(',', '.').trim());</span>
			}
		}
<span class="fc" id="L971">		catch (Exception ex)</span>
		{

<span class="fc" id="L974">		}</span>
<span class="fc" id="L975">		return(ret);</span>
	}

	/**
	 * Vrati hodnotu parametra z requestu, v Tomcate je bug, ak je URL ...?docid=3#kotva, tak to vrati
	 * vratane tej kotvy.
	 * EDIT 13.8.2014 : navratova hodnota je osetrena na XSS
	 * @param request
	 * @param name
	 * @return
	 */
	public static String getParameter(HttpServletRequest request, String name)
	{
<span class="fc" id="L988">		String ret = request.getParameter(name);</span>
<span class="pc bpc" id="L989" title="1 of 4 branches missed.">		if (ret!=null &amp;&amp; ret.indexOf('#')!=-1)</span>
		{
<span class="nc" id="L991">			ret = ret.substring(0, ret.indexOf('#'));</span>
		}
<span class="fc" id="L993">		return org.apache.struts.util.ResponseUtils.filter(ret);</span>
	}

	/**
	 * Ziska string hodnotu z request objektu podla mena, ak neexistuje alebo je prazdne vrati defaultValue
	 * @param request
	 * @param name
	 * @param defaultValue
	 * @return
	 */
	public static String getRequestAttribute(HttpServletRequest request, String name, String defaultValue)
	{
<span class="nc bnc" id="L1005" title="All 6 branches missed.">		if (request !=null &amp;&amp; request.getAttribute(name)!=null &amp;&amp; Tools.isNotEmpty((String)request.getAttribute(name)))</span>
		{
<span class="nc" id="L1007">			return (String)request.getAttribute(name);</span>
		}
<span class="nc" id="L1009">		return defaultValue;</span>
	}

	/**
	 *  Replace stringu na string
	 *
	 *@param  src     zdrojovy string
	 *@param  oldStr  co sa ma nahradit
	 *@param  newStr  za co sa ma nahradit
	 *@return         string src v ktorom je nahradene oldStr za newStr
	 */
	public static String replace(String src, String oldStr, String newStr)
	{
<span class="fc bfc" id="L1022" title="All 2 branches covered.">		if (src == null)</span>
		{
<span class="fc" id="L1024">			return (null);</span>
		}

		//nemozeme pouzit Tools.isEmpty, pretoze to nam trimne medzery aj crlf a podmienka bude zla
<span class="pc bpc" id="L1028" title="1 of 4 branches missed.">		if (oldStr == null || oldStr.length()==0) return src;</span>

<span class="fc bfc" id="L1030" title="All 2 branches covered.">		if (src.indexOf(oldStr) == -1)</span>
		{
<span class="fc" id="L1032">			return (src);</span>
		}

<span class="fc" id="L1035">		StringBuilder result = new StringBuilder(src.length() + 50);</span>
<span class="fc" id="L1036">		int startIndex = 0;</span>
<span class="fc" id="L1037">		int endIndex = src.indexOf(oldStr);</span>
<span class="fc" id="L1038">		int failsafe = 0;</span>
<span class="pc bpc" id="L1039" title="1 of 4 branches missed.">		while (endIndex != -1 &amp;&amp; failsafe++&lt;2000)</span>
		{
<span class="fc" id="L1041">			result.append(src.substring(startIndex, endIndex));</span>
<span class="fc" id="L1042">			result.append(newStr);</span>
<span class="fc" id="L1043">			startIndex = endIndex + oldStr.length();</span>
<span class="fc" id="L1044">			endIndex = src.indexOf(oldStr, startIndex);</span>
		}
<span class="fc" id="L1046">		result.append(src.substring(startIndex, src.length()));</span>
<span class="fc" id="L1047">		return result.toString();</span>
	}

	/**
	 *  Replace stringu na string
	 *
	 *@param  src     zdrojovy string
	 *@param  oldStr  co sa ma nahradit
	 *@param  newStr  za co sa ma nahradit
	 *@return         string src v ktorom je nahradene oldStr za newStr
	 */
	public static StringBuilder replace(StringBuilder src, String oldStr, String newStr)
	{
<span class="pc bpc" id="L1060" title="1 of 2 branches missed.">		if (src == null)</span>
		{
<span class="nc" id="L1062">			return (null);</span>
		}
<span class="pc bpc" id="L1064" title="1 of 4 branches missed.">		if (src.indexOf(oldStr) == -1 || newStr == null)</span>
		{
<span class="fc" id="L1066">			return (src);</span>
		}
<span class="fc" id="L1068">		int replaceIndex = src.indexOf(oldStr);</span>
<span class="fc" id="L1069">		int failsafe = 0;</span>
<span class="pc bpc" id="L1070" title="1 of 4 branches missed.">		while (replaceIndex != -1 &amp;&amp; failsafe++&lt;300)</span>
		{
<span class="fc" id="L1072">			src.replace(replaceIndex, replaceIndex+oldStr.length(), newStr);</span>
<span class="fc" id="L1073">			replaceIndex = src.indexOf(oldStr, replaceIndex+newStr.length());</span>
		}

<span class="fc" id="L1076">		return src;</span>
	}

	/**
	 *  Funkcia, ktora zisti pocet vyskytov vstupneho substringu v retazci
	 *
	 *	@author kmarton
	 *
	 *	@param  src     	retazec, v ktorom chceme zistit pocet vyskytov
	 *	@param  subString  co sa ma nahradit
	 *
	 *	@return         	pocet vyskytov substring v src, ak je vstupny string null vrati -1, inak stale pocet vyskytov
	 */
	public static int getNumberSubstring(String src, String subString)
	{
<span class="pc bpc" id="L1091" title="1 of 2 branches missed.">		if (src == null)</span>
<span class="nc" id="L1092">			return (-1);</span>

<span class="pc bpc" id="L1094" title="3 of 6 branches missed.">		if (src.indexOf(subString) == -1 || src.isEmpty() || subString.isEmpty())</span>
<span class="nc" id="L1095">			return (0);</span>

<span class="fc" id="L1097">	   int counter = 0;</span>
<span class="fc" id="L1098">	   Pattern p = Pattern.compile(&quot;\\b&quot; + subString + &quot;\\b&quot;); // co sa ma matchovat, \\b oznacuje hranicu slova, 'medzibankovy' nezapocita, 'iban:' zapocita</span>
<span class="fc" id="L1099">	   Matcher m = p.matcher(src); // v com sa to ma matchovat</span>

<span class="fc bfc" id="L1101" title="All 2 branches covered.">	   while(m.find())</span>
<span class="fc" id="L1102">	   	counter++;</span>

<span class="fc" id="L1104">		return (counter);</span>
	}

	/**
	 * Nahradenie retazca oldStr retazcom newStr bez ohladu na velkost pismen
	 * @param src
	 * @param oldStr
	 * @param newStr
	 * @return
	 */
	public static String replaceIgnoreCase(String src, String oldStr, String newStr)
	{
<span class="pc bpc" id="L1116" title="1 of 2 branches missed.">		if (src == null)</span>
		{
<span class="nc" id="L1118">			return (null);</span>
		}
<span class="fc" id="L1120">		String srcLC = src.toLowerCase();</span>
<span class="fc" id="L1121">		oldStr = oldStr.toLowerCase();</span>
<span class="pc bpc" id="L1122" title="1 of 2 branches missed.">		if (srcLC.indexOf(oldStr) == -1)</span>
		{
<span class="fc" id="L1124">			return (src);</span>
		}
<span class="nc" id="L1126">		StringBuilder result = new StringBuilder(src.length() + 50);</span>
<span class="nc" id="L1127">		int startIndex = 0;</span>
<span class="nc" id="L1128">		int endIndex = srcLC.indexOf(oldStr);</span>
<span class="nc bnc" id="L1129" title="All 2 branches missed.">		while (endIndex != -1)</span>
		{
<span class="nc" id="L1131">			result.append(src.substring(startIndex, endIndex));</span>
<span class="nc" id="L1132">			result.append(newStr);</span>
<span class="nc" id="L1133">			startIndex = endIndex + oldStr.length();</span>
<span class="nc" id="L1134">			endIndex = srcLC.indexOf(oldStr, startIndex);</span>
		}
<span class="nc" id="L1136">		result.append(src.substring(startIndex, src.length()));</span>
<span class="nc" id="L1137">		return result.toString();</span>
	}

	public static String URLEncode(String text) { //NOSONAR
<span class="pc bpc" id="L1141" title="1 of 2 branches missed.">		if (text == null)</span>
<span class="nc" id="L1142">			return (&quot;&quot;);</span>
		try {
<span class="fc" id="L1144">			text = java.net.URLEncoder.encode(text, SetCharacterEncodingFilter.getEncoding());</span>
<span class="fc" id="L1145">			text = sk.iway.iwcm.Tools.replace(text, &quot;+&quot;, &quot;%20&quot;);</span>
<span class="nc" id="L1146">		} catch (UnsupportedEncodingException ex) {</span>
<span class="nc" id="L1147">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L1148">		}</span>
<span class="fc" id="L1149">		return (text);</span>
	}

	public static String URLDecode(String text) { //NOSONAR
		try {
<span class="fc" id="L1154">			text = java.net.URLDecoder.decode(text, SetCharacterEncodingFilter.getEncoding());</span>
<span class="nc" id="L1155">		} catch (UnsupportedEncodingException|IllegalArgumentException ex) {</span>
<span class="nc" id="L1156">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L1157">		}</span>
<span class="fc" id="L1158">		return (text);</span>
	}

	/**
	 * Opravuje moznu chybu HTTP response splitting
	 * http://en.wikipedia.org/wiki/HTTP_response_splitting
	 * @param headerParam
	 * @return
	 */
	public static String sanitizeHttpHeaderParam(String headerParam)
	{
<span class="fc bfc" id="L1169" title="All 2 branches covered.">		if (headerParam == null) return null;</span>
<span class="fc" id="L1170">		headerParam = headerParam.replace('\n', ' ');</span>
<span class="fc" id="L1171">		headerParam = headerParam.replace('\r', ' ');</span>
<span class="fc" id="L1172">		return headerParam;</span>
	}

	/**
	 * Vrati IP adresu vzdialeneho pocitaca, vie spracovat aj poziadavky za proxy
	 * @param request
	 * @return
	 */
	public static String getRemoteIP(HttpServletRequest request)
	{
<span class="fc" id="L1182">		String ip = request.getRemoteAddr();</span>
		//priklad: x-forwarded-for: unknown, 195.168.35.4
<span class="fc" id="L1184">		String xForwardedFor = request.getHeader(&quot;x-forwarded-for&quot;);</span>
<span class="pc bpc" id="L1185" title="2 of 6 branches missed.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; xForwardedFor != null &amp;&amp; xForwardedFor.length()&gt;4)</span>
		{
<span class="pc bpc" id="L1187" title="2 of 4 branches missed.">			if (&quot;unknown&quot;.equals(xForwardedFor)==false &amp;&amp; xForwardedFor.indexOf(&quot;.&quot;)!=-1)</span>
			{
<span class="fc" id="L1189">				String[] values = Tools.getTokens(xForwardedFor, &quot;,&quot;, true);</span>
<span class="pc bpc" id="L1190" title="1 of 2 branches missed.">				for (String value : values)</span>
                {
                    //ak tam nie je bodka, je to asi unknown a to ignorujeme
<span class="pc bpc" id="L1193" title="1 of 2 branches missed.">                    if (value.indexOf(&quot;.&quot;)&lt;1) continue;</span>
                    //bereme prvu hodnotu v poradi
<span class="fc" id="L1195">                    ip = value.trim();</span>
<span class="fc" id="L1196">                    break;</span>
                }
			}
		}

<span class="fc" id="L1201">		return(ip);</span>
	}

	/**
	 * Vrati DNS meno vzdialeneho pocitaca, vie spracovat aj poziadavky za proxy
	 * @param request
	 * @return
	 */
	public static String getRemoteHost(HttpServletRequest request)
	{
<span class="fc" id="L1211">		String ip = getRemoteIP(request);</span>

<span class="pc bpc" id="L1213" title="1 of 2 branches missed.">		if (Constants.getBoolean(&quot;disableReverseDns&quot;)==true) return ip;</span>

<span class="fc" id="L1215">		String host = null;</span>

		try
		{
<span class="fc" id="L1219">			request.getSession().setAttribute(StatDB.REMOTE_IP, ip);</span>
<span class="fc" id="L1220">			host = (String) request.getSession().getAttribute(sk.iway.iwcm.stat.StatDB.REMOTE_HOST);</span>
		}
<span class="nc" id="L1222">		catch (Exception e)</span>
		{
			//uz nie je platna session
<span class="fc" id="L1225">		}</span>

<span class="fc bfc" id="L1227" title="All 2 branches covered.">		if (host == null)</span>
		{
<span class="fc" id="L1229">			host = ip;</span>

			//ip z privatnych rozsahov nepouzijem
<span class="pc bpc" id="L1232" title="2 of 4 branches missed.">			if (ip.startsWith(&quot;192.168.&quot;) || ip.startsWith(&quot;10.&quot;)) return host;</span>

			//skus zdetekovat ci je to IP adresa, alebo meno
			try
			{
<span class="pc bpc" id="L1237" title="1 of 2 branches missed.">				if (host.indexOf(',')!=-1)</span>
				{
<span class="nc" id="L1239">					host = host.substring(0, host.indexOf(',')).trim();</span>
				}
<span class="fc" id="L1241">				String domain = host.substring(host.lastIndexOf('.') + 1);</span>
<span class="fc" id="L1242">				Integer.parseInt(domain);</span>
				//ok je to cislo, inak by sa to zdrbalo
<span class="fc" id="L1244">				host = InetAddress.getByName(ip).getHostName();</span>

<span class="fc" id="L1246">				request.getSession().setAttribute(sk.iway.iwcm.stat.StatDB.REMOTE_HOST, host);</span>
			}
<span class="nc" id="L1248">			catch (Exception ex)</span>
			{

<span class="fc" id="L1251">			}</span>
		}
<span class="fc" id="L1253">		return(host);</span>
	}

	/**
	 * Vrati DNS meno vzdialeneho pocitaca na zaklade IP adresy
	 * @param ip
	 * @return
	 */
	public static String getRemoteHost(String ip)
	{
<span class="fc" id="L1263">		String host = ip;</span>
		try
		{
<span class="fc" id="L1266">			host = InetAddress.getByName(ip).getHostName();</span>
		}
<span class="nc" id="L1268">		catch (Exception e)</span>
		{

<span class="fc" id="L1271">		}</span>
<span class="fc" id="L1272">		return host;</span>
	}

	/**
	 * Vrati true, ak sa jedna o HTTPS pripojenie
	 * @param request
	 * @return
	 */
	public static boolean isSecure(HttpServletRequest request)
	{
		//tu je mozne dorobit ine detekcie, na zaklade nejakej hlavicky (ak SSL nie je riesene Tomcatom)
<span class="fc" id="L1283">		String headerName = Constants.getString(&quot;requestIsSecureHeaderName&quot;);</span>
<span class="pc bpc" id="L1284" title="2 of 4 branches missed.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; Tools.isNotEmpty(headerName))</span>
		{
<span class="fc" id="L1286">			String secureHeaderValue = request.getHeader(headerName);</span>
			//pre rezim kde je priamo http alebo https
<span class="pc bpc" id="L1288" title="1 of 2 branches missed.">			if (&quot;https&quot;.equalsIgnoreCase(secureHeaderValue)) return true;</span>
		}

<span class="fc" id="L1291">		return request.isSecure();</span>
	}

	/**
	 * Ziska hodnotu cookie daneho mena
	 * @param cookies
	 * @param name
	 * @param defaultValue
	 * @return
	 */
	public static String getCookieValue(javax.servlet.http.Cookie[] cookies, String name, String defaultValue)
	{
<span class="fc bfc" id="L1303" title="All 2 branches covered.">		if (cookies == null) return defaultValue;</span>

		int i;
<span class="fc" id="L1306">		int len = cookies.length;</span>
<span class="fc bfc" id="L1307" title="All 2 branches covered.">		for (i=0; i&lt;len; i++)</span>
		{
<span class="fc bfc" id="L1309" title="All 2 branches covered.">			if (name.equals(cookies[i].getName()))</span>
			{
<span class="fc" id="L1311">				return(cookies[i].getValue());</span>
			}
		}
<span class="fc" id="L1314">		return(defaultValue);</span>
	}


	/**
	 * Vrati pole typu String, s jednotlivymi polozkami v retazci, ak sa retazec neda rozdelit, vrati prazdne pole
	 * @param groups 	- retazec, ktory sa ma rozparsovat
	 * @param delimiter
	 * @return
	 */
	public static String[] getTokens(String groups, String delimiter)
	{
<span class="fc" id="L1326">		return(getTokens(groups, delimiter, true));</span>
	}

	/**
	 * Vrati pole typu String, s jednotlivymi polozkami v retazci, ak sa retazec neda rozdelit, vrati prazdne pole
	 * @param groups
	 * @param delimiter
	 * @param doTrim
	 * @return
	 */
	public static String[] getTokens(String groups, String delimiter, boolean doTrim)
	{
<span class="fc" id="L1338">		String[] ret = new String[0];</span>
		StringTokenizer st;
<span class="fc" id="L1340">		int i = 0;</span>
		String s;
		try
		{
<span class="fc bfc" id="L1344" title="All 2 branches covered.">			if (Tools.isNotEmpty(groups))</span>
			{
<span class="fc" id="L1346">				st = new StringTokenizer(groups, delimiter);</span>
<span class="fc" id="L1347">				ret = new String[st.countTokens()];</span>
<span class="fc bfc" id="L1348" title="All 2 branches covered.">				while (st.hasMoreTokens())</span>
				{
<span class="fc" id="L1350">					s = st.nextToken();</span>
<span class="pc bpc" id="L1351" title="1 of 2 branches missed.">					if (doTrim) s = s.trim();</span>
<span class="fc" id="L1352">					ret[i++] = s;</span>
				}
			}
		}
<span class="nc" id="L1356">		catch (Exception e)</span>
		{
<span class="nc" id="L1358">			sk.iway.iwcm.Logger.error(e);</span>
<span class="fc" id="L1359">		}</span>
<span class="fc" id="L1360">		return(ret);</span>

	}

	public String[] split(String groups, String delimiter) {
<span class="nc" id="L1365">		return split(groups, delimiter, true);</span>
	}

	public String[] split(String groups, String delimiter, boolean doTrim) {
<span class="nc" id="L1369">		return getTokens(groups, delimiter, doTrim);</span>
	}

	/**
	 * Vrati pole typu int s jednotlivymi polozkami v retazci
	 * @param groups
	 * @param delimiter
	 * @return
	 */
	public static int[] getTokensInt(String groups, String delimiter)
	{
<span class="fc bfc" id="L1380" title="All 2 branches covered.">		if (Tools.isEmpty(groups)) return new int[0];</span>
<span class="fc" id="L1381">		String[] retStr = getTokens(groups, delimiter, true);</span>
<span class="fc" id="L1382">		int[] retInt = new int[retStr.length];</span>
<span class="fc bfc" id="L1383" title="All 2 branches covered.">		for (int i=0; i&lt;retInt.length; i++)</span>
		{
<span class="fc" id="L1385">			retInt[i] = Tools.getIntValue(retStr[i], 0);</span>

		}
<span class="fc" id="L1388">		return(retInt);</span>

	}

	/**
	 * Vrati docId stranky, pouzije docDetails v requeste a ked nie je
	 * pouzije docid parameter z requestu
	 * Nutne pouzit ked je nejake remapovanie stranky (cize parameter
	 * je iny ako skutocne zobrazena stranka)
	 * @param request
	 * @return
	 */
	public static int getDocId(HttpServletRequest request)
	{
<span class="fc" id="L1402">		int docId = Tools.getIntValue(request.getParameter(&quot;docid&quot;), -1);</span>
<span class="fc" id="L1403">      DocDetails docDetails = (DocDetails)request.getAttribute(&quot;docDetails&quot;);</span>
<span class="fc bfc" id="L1404" title="All 2 branches covered.">      if (docDetails != null)</span>
      {
      	//Logger.println(Tools.class, &quot;JSP REMAP DOC docId=&quot;+docDetails.getDocId());
<span class="fc" id="L1407">      	docId = docDetails.getDocId();</span>
      }
<span class="fc" id="L1409">      return(docId);</span>
	}

	/**
	 * Ziska hodnotu parametra zo zadaneho URL
	 * @param url
	 * @param paramName
	 * @return
	 */
	public static String getParameterFromUrl(String url, String paramName)
	{
		try
		{
<span class="nc" id="L1422">			int start = url.indexOf(paramName);</span>
<span class="nc" id="L1423">			StringTokenizer st = new StringTokenizer(url.substring(start+paramName.length()+1), &quot; &amp;#&quot;);</span>
<span class="nc bnc" id="L1424" title="All 2 branches missed.">			if (st.hasMoreTokens())</span>
			{
<span class="nc" id="L1426">				return(st.nextToken().trim());</span>
			}
		}
<span class="nc" id="L1429">		catch (Exception ex)</span>
		{
<span class="nc" id="L1431">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L1432">		}</span>
<span class="nc" id="L1433">		return(null);</span>
	}

	/**
	 * Prida parameter k zadanemu URL
	 * @param url
	 * @param paramName
	 * @param paramValue
	 * @return
	 */
	public static String addParameterToUrl(String url, String paramName, String paramValue)
	{
<span class="pc bpc" id="L1445" title="2 of 4 branches missed.">		if(paramName == null || paramValue == null) return url;</span>

<span class="fc" id="L1447">		paramName = Tools.URLEncode(paramName);</span>

<span class="pc bpc" id="L1449" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramName+&quot;=&quot;+Tools.URLEncode(paramValue));</span>

<span class="pc bpc" id="L1451" title="3 of 6 branches missed.">		if (url.indexOf(&quot;?&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;amp;&quot;+paramName+&quot;=&quot;)!=-1)</span>
		{
<span class="nc" id="L1453">			return(url);</span>
		}

<span class="fc bfc" id="L1456" title="All 2 branches covered.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1458">			return(url + &quot;?&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
		}
<span class="fc" id="L1460">		return(url + &quot;&amp;amp;&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
	}

	public static String addParameterToUrlNoAmp(String url, String paramName, String paramValue)
	{
<span class="pc bpc" id="L1465" title="2 of 4 branches missed.">		if(paramName == null || paramValue == null) return url;</span>

<span class="fc" id="L1467">		paramName = Tools.URLEncode(paramName);</span>

<span class="pc bpc" id="L1469" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramName+&quot;=&quot;+Tools.URLEncode(paramValue));</span>

<span class="pc bpc" id="L1471" title="3 of 6 branches missed.">		if (url.indexOf(&quot;?&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;amp;&quot;+paramName+&quot;=&quot;)!=-1)</span>
		{
<span class="nc" id="L1473">			return(url);</span>
		}

<span class="fc bfc" id="L1476" title="All 2 branches covered.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1478">			return(url + &quot;?&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
		}
<span class="fc" id="L1480">		return(url + &quot;&amp;&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
	}

	public static String addParametersToUrl(String url, String paramNameValue)
	{
<span class="pc bpc" id="L1485" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramNameValue);</span>

<span class="pc bpc" id="L1487" title="1 of 2 branches missed.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1489">			return(url + &quot;?&quot; + paramNameValue);</span>
		}
<span class="nc" id="L1491">		return(url + &quot;&amp;amp;&quot; + paramNameValue);</span>
	}

	public static String addParametersToUrlNoAmp(String url, String paramNameValue)
	{
<span class="pc bpc" id="L1496" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramNameValue);</span>

<span class="pc bpc" id="L1498" title="1 of 2 branches missed.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1500">			return(url + &quot;?&quot; + paramNameValue);</span>
		}
<span class="nc" id="L1502">		return(url + &quot;&amp;&quot; + paramNameValue);</span>
	}

	/**
	 * Vrati URL vratane pripadnych parametrov (okrem docid)
	 * @param request
	 * @return
	 */
	public static String getBaseLink(HttpServletRequest request, String[] skipNames)
	{
<span class="nc" id="L1512">		String baseLink = PathFilter.getOrigPath(request);</span>
<span class="nc" id="L1513">		Enumeration&lt;String&gt; parameters = request.getParameterNames();</span>
<span class="nc bnc" id="L1514" title="All 2 branches missed.">		while (parameters.hasMoreElements())</span>
		{
<span class="nc" id="L1516">		   String name = parameters.nextElement();</span>
<span class="nc bnc" id="L1517" title="All 2 branches missed.">		   if (&quot;docid&quot;.equals(name)) continue;</span>

<span class="nc" id="L1519">		   boolean skipParam = false;</span>
<span class="nc bnc" id="L1520" title="All 4 branches missed.">		   if (skipNames!=null &amp;&amp; skipNames.length&gt;0)</span>
		   {
<span class="nc bnc" id="L1522" title="All 2 branches missed.">		   	for (int s=0; s&lt;skipNames.length; s++)</span>
		   	{
<span class="nc bnc" id="L1524" title="All 2 branches missed.">		   		if (skipNames[s].equals(name))</span>
		   		{
<span class="nc" id="L1526">		   			skipParam = true;</span>
<span class="nc" id="L1527">		   			break;</span>
		   		}
		   	}
		   }
<span class="nc bnc" id="L1531" title="All 2 branches missed.">		   if (skipParam) continue;</span>

<span class="nc" id="L1533">		   String[] values = request.getParameterValues(name);</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">		   for (int i=0; i&lt;values.length; i++)</span>
		   {
<span class="nc" id="L1536">			   String value = org.apache.struts.util.ResponseUtils.filter(values[i]);</span>
<span class="nc" id="L1537">			   baseLink = addParameterToUrl(baseLink, name, value);</span>
		   }
<span class="nc" id="L1539">		}</span>
<span class="nc" id="L1540">		return baseLink;</span>
	}

	/**
	 * Oreze z HTML kodu vsetko za start a pred end, start a end sa tam nebude nachadzat
	 * @param data - HTML kod
	 * @param start - zaciatocny text orezu
	 * @param end - koncovy text orezu
	 * @return
	 */
	public static String getCleanBody(String data, String start, String end)
	{
		//odstran vsetko pred &lt;body&gt; a po &lt;/body&gt;
<span class="nc" id="L1553">		String data_lcase = data.toLowerCase();</span>
<span class="nc" id="L1554">		start = start.toLowerCase();</span>
<span class="nc" id="L1555">		end = end.toLowerCase();</span>
<span class="nc" id="L1556">		int index = data_lcase.indexOf(start);</span>
<span class="nc bnc" id="L1557" title="All 2 branches missed.">		if (index != -1)</span>
		{
<span class="nc bnc" id="L1559" title="All 2 branches missed.">			if (index &gt; 0)</span>
			{
<span class="nc" id="L1561">				int index2 = data_lcase.indexOf(&quot;&gt;&quot;, index + 1);</span>
<span class="nc bnc" id="L1562" title="All 4 branches missed.">				if (index2 &gt; index &amp;&amp; index2 &lt; data_lcase.length())</span>
				{
<span class="nc" id="L1564">					data = data.substring(index2 + 1);</span>
				}
			}

<span class="nc" id="L1568">			index = data.toLowerCase().indexOf(end);</span>
<span class="nc bnc" id="L1569" title="All 2 branches missed.">			if (index &gt; 0)</span>
			{
<span class="nc" id="L1571">				data = data.substring(0, index);</span>
			}
		}
<span class="nc" id="L1574">		return (data);</span>
	}
	/**
	 * vrati String a ak je null tak defaultValue
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static String getStringValue(String value, String defaultValue)
	{
<span class="fc" id="L1584">		String ret = defaultValue;</span>
<span class="fc bfc" id="L1585" title="All 2 branches covered.">		if(value != null) ret = value;</span>
<span class="fc" id="L1586">		return(ret);</span>
	}

	/**
	 * vrati read-only zoznam stringov a ak je null, tak prazdny zoznam
	 *
	 * @param value
	 * @return
	 */
	public static List&lt;String&gt; getStringListValue(String[] value)
	{
<span class="pc bpc" id="L1597" title="1 of 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L1598">			return Collections.emptyList();</span>
		}
<span class="fc" id="L1600">		return Arrays.asList(value);</span>
	}

	public static void doNotVerifyCertificates()
	{
<span class="nc" id="L1605">		doNotVerifyCertificates(null); //NOSONAR</span>
<span class="nc" id="L1606">	}</span>

	/**
	 * Nastavi neverifikaciu certifikatov pre SSL spojenie
	 */
	public static void doNotVerifyCertificates(String host)
	{
		try
		{
			// Create a trust manager that does not validate certificate chains
<span class="nc" id="L1616">			TrustManager[] trustAllCerts = new TrustManager[]{new X509TrustManager()</span>
<span class="nc" id="L1617">			{</span>
				@Override
				public void checkClientTrusted(X509Certificate[] certs, String authType) throws CertificateException //NOSONAR
				{
					//
<span class="nc" id="L1622">				}</span>
				@Override
				public void checkServerTrusted(X509Certificate[] certs, String authType) //NOSONAR
				{
					//
<span class="nc" id="L1627">				}</span>
				@Override
				public X509Certificate[] getAcceptedIssuers()
				{
<span class="nc" id="L1631">					return null;</span>
				}
			}};
			// Install the all-trusting trust manager
<span class="nc" id="L1635">			SSLContext sc = SSLContext.getInstance(&quot;SSL&quot;); //NOSONAR</span>
<span class="nc" id="L1636">			sc.init(null, trustAllCerts, null);</span>
<span class="nc" id="L1637">			HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());</span>

			/**
			 * pri httpS preskakuje kontrolu na verifikaciu hostname s SSL certifikatom
			 * riesenie chyby javax.net.ssl.SSLHandshakeException: No subject alternative DNS name matching 'moja.domena' found.
			 * vynimku je mozne zadat cez konf. premennu httpsDnsNameMatchingExceptions
			 */
<span class="nc" id="L1644">			String httpsDnsNameMatchingExceptions = Constants.getString(&quot;httpsDnsNameMatchingExceptions&quot;);</span>
<span class="nc bnc" id="L1645" title="All 2 branches missed.">			if (Tools.isNotEmpty(httpsDnsNameMatchingExceptions))</span>
			{
<span class="nc bnc" id="L1647" title="All 2 branches missed.">				if(Tools.isAnyEmpty(host, httpsDnsNameMatchingExceptions) == false)</span>
				{
<span class="nc" id="L1649">					Logger.debug(Tools.class, &quot;HttpsDnsNameMatchingExceptions: Checking: &quot;+host+&quot; vs &quot;+httpsDnsNameMatchingExceptions);</span>
<span class="nc bnc" id="L1650" title="All 2 branches missed.">					for(String hostException : Tools.getTokens(httpsDnsNameMatchingExceptions, &quot;,&quot;, true))</span>
					{
<span class="nc bnc" id="L1652" title="All 6 branches missed.">						if(hostException != null &amp;&amp; hostException.length() &gt; 2 &amp;&amp; host.endsWith(hostException))</span>
						{
<span class="nc" id="L1654">							HttpsURLConnection.setDefaultHostnameVerifier((s, sslSession) -&gt; true); //NOSONAR</span>
<span class="nc" id="L1655">							break;</span>
						}
					}
				}
			}
		}
<span class="nc" id="L1661">		catch (Exception ex)</span>
		{
<span class="nc" id="L1663">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L1664">		}</span>
<span class="nc" id="L1665">	}</span>

	/**
	 * Vrati kod dna podla cisla dna z kalendara (Calendar.DAY_OF_WEEK), vrati
	 * su, mo, tu, we, th, fr, sa
	 * @param dayOfWeek
	 * @return
	 */
	public static String getDayCode(int dayOfWeek)
	{
<span class="nc bnc" id="L1675" title="All 2 branches missed.">		if (dayOfWeek==Calendar.SUNDAY) return(&quot;su&quot;);</span>
<span class="nc bnc" id="L1676" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.MONDAY) return(&quot;mo&quot;);</span>
<span class="nc bnc" id="L1677" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.TUESDAY) return(&quot;tu&quot;);</span>
<span class="nc bnc" id="L1678" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.WEDNESDAY) return(&quot;we&quot;);</span>
<span class="nc bnc" id="L1679" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.THURSDAY) return(&quot;th&quot;);</span>
<span class="nc bnc" id="L1680" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.FRIDAY) return(&quot;fr&quot;);</span>
<span class="nc" id="L1681">		else return(&quot;sa&quot;);</span>
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param request
	 * @return String
	 */
	public static String insertJQuery(HttpServletRequest request)
	{
<span class="fc" id="L1691">		boolean alreadyInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryInserted&quot;)) );</span>
<span class="fc" id="L1692">		request.setAttribute(&quot;jQueryInserted&quot;, &quot;true&quot;);</span>
<span class="fc bfc" id="L1693" title="All 4 branches covered.">		if (alreadyInserted || &quot;true&quot;.equals(request.getParameter(&quot;isDmail&quot;)))</span>
<span class="fc" id="L1694">			return &quot;&quot;;</span>
		else
		{
<span class="fc" id="L1697">			StringBuilder htmlCode = new StringBuilder();</span>
<span class="pc bpc" id="L1698" title="3 of 4 branches missed.">			if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()) || &quot;iwcm.iway.sk&quot;.equals(request.getServerName())) htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jquery.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
<span class="nc" id="L1699">			else htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jquery.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>

<span class="pc bpc" id="L1701" title="2 of 6 branches missed.">			if (request.getAttribute(&quot;docDetails&quot;)!=null &amp;&amp; request.getAttribute(&quot;pageGroupDetails&quot;)!=null &amp;&amp; request.getAttribute(&quot;commonPageFunctionsInserted&quot;)==null)</span>
			{
<span class="fc" id="L1703">				request.setAttribute(&quot;commonPageFunctionsInserted&quot;, &quot;true&quot;);</span>
<span class="fc" id="L1704">				request.setAttribute(&quot;mailProtection&quot;, true);</span>
<span class="fc" id="L1705">				htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/page_functions.js.jsp?language=&quot;).append(PageLng.getUserLng(request)).append(&quot;\&quot; &gt;&lt;/script&gt;&quot;);</span>
<span class="fc" id="L1706">				htmlCode.append(&quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; media=\&quot;screen\&quot; href=\&quot;/components/form/check_form.css\&quot; /&gt; &quot;);</span>
			}

<span class="fc" id="L1709">			return htmlCode.toString();</span>
		}
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param pageContext
	 * @return String
	 */
	public static String insertJQueryUI(PageContext pageContext, String... modules)
	{
<span class="fc" id="L1720">		HttpServletRequest request = (HttpServletRequest)pageContext.getRequest();</span>
<span class="fc" id="L1721">		return insertJQueryUI(request, modules);</span>
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param request
	 * @return String
	 */
	public static String insertJQueryUI(HttpServletRequest request, String... modules)
	{
<span class="fc" id="L1731">		StringBuilder returnCode = new StringBuilder(insertJQuery(request));</span>
<span class="fc" id="L1732">		boolean coreInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-core-Inserted&quot;)) );</span>
<span class="fc" id="L1733">		request.setAttribute(&quot;jQueryUI-core-Inserted&quot;, &quot;true&quot;);</span>
<span class="fc bfc" id="L1734" title="All 2 branches covered.">		if(!coreInserted)</span>
		{
<span class="pc bpc" id="L1736" title="1 of 2 branches missed.">			if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()))</span>
<span class="fc" id="L1737">				returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-core.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
			else
<span class="nc" id="L1739">				returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-core.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
		}

<span class="fc bfc" id="L1742" title="All 2 branches covered.">		if(modules == null)</span>
<span class="fc" id="L1743">			return returnCode.toString();</span>

<span class="fc bfc" id="L1745" title="All 2 branches covered.">		for (String module : modules)</span>
		{
<span class="fc" id="L1747">			boolean moduleInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-&quot;+module+&quot;-Inserted&quot;)) );</span>
<span class="pc bpc" id="L1748" title="1 of 2 branches missed.">			if (moduleInserted==false)</span>
			{
<span class="fc" id="L1750">				moduleInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-all-Inserted&quot;)) );</span>
			}
<span class="fc" id="L1752">			request.setAttribute(&quot;jQueryUI-&quot;+module+&quot;-Inserted&quot;, &quot;true&quot;);</span>
<span class="pc bpc" id="L1753" title="1 of 2 branches missed.">			if(!moduleInserted)</span>
			{
<span class="pc bpc" id="L1755" title="1 of 2 branches missed.">				if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()))</span>
<span class="fc" id="L1756">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-&quot;).append(module).append(&quot;.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
				else
<span class="nc" id="L1758">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-&quot;).append(module).append(&quot;.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>

<span class="pc bpc" id="L1760" title="1 of 2 branches missed.">				if(&quot;datepicker&quot;.equals(module))</span>
				{
<span class="nc" id="L1762">					String lng = &quot;&quot;;</span>
<span class="nc bnc" id="L1763" title="All 2 branches missed.">					if (request.getAttribute(&quot;PageLng&quot;)!=null)</span>
					{
<span class="nc" id="L1765">						lng = (String)request.getAttribute(&quot;PageLng&quot;);</span>
					}
					else
					{
<span class="nc" id="L1769">						lng = ResponseUtils.filter(request.getParameter(&quot;language&quot;));</span>
<span class="nc bnc" id="L1770" title="All 2 branches missed.">						if (lng != null) request.getSession().setAttribute(Prop.SESSION_I18N_PROP_LNG, lng);</span>
<span class="nc bnc" id="L1771" title="All 2 branches missed.">						if (lng==null)</span>
						{
<span class="nc" id="L1773">							lng = (String)request.getSession().getAttribute(Prop.SESSION_I18N_PROP_LNG);</span>
						}
<span class="nc bnc" id="L1775" title="All 2 branches missed.">						if (lng == null)</span>
						{
<span class="nc" id="L1777">							lng = PageLng.getUserLng(request);</span>
						}
					}
<span class="nc bnc" id="L1780" title="All 2 branches missed.">					if(Tools.isEmpty(lng))</span>
<span class="nc" id="L1781">						lng = &quot;sk&quot;;</span>

<span class="nc" id="L1783">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/i18n/jqui-datepicker-&quot;).append(lng).append(&quot;.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
				}
			}
		}

<span class="fc" id="L1788">		return returnCode.toString();</span>
	}

	public static String insertAngular2(HttpServletRequest request) {
<span class="nc" id="L1792">		return insertAngular2(request, true, true);</span>
	}

	public static String insertAngular2(HttpServletRequest request, boolean minified, boolean insertBaseHref)
	{
<span class="nc" id="L1797">		boolean alreadyInserted = Tools.getBooleanValue((String) request.getAttribute(&quot;angular2Inserted&quot;), false);</span>
<span class="nc" id="L1798">		request.setAttribute(&quot;angular2Inserted&quot;, &quot;true&quot;);</span>

<span class="nc bnc" id="L1800" title="All 2 branches missed.">		if (!alreadyInserted)</span>
		{
<span class="nc" id="L1802">			StringBuilder htmlCode = new StringBuilder();</span>

<span class="nc bnc" id="L1804" title="All 2 branches missed.">			if (insertBaseHref) {</span>
<span class="nc" id="L1805">				DocDetails docDetails = new RequestHelper(request).getDocument();</span>
<span class="nc bnc" id="L1806" title="All 2 branches missed.">				if (docDetails != null) {</span>
<span class="nc" id="L1807">					htmlCode.append(&quot;&lt;base href=\&quot;&quot;).append(Tools.getBaseHref(request)).append(docDetails.getDocLink()).append(&quot;/\&quot;&gt;&quot;);</span>
				}
			}

<span class="nc" id="L1811">			String version = Constants.getString(&quot;AngularCDNVersion&quot;);</span>

<span class="nc" id="L1813">			htmlCode.append(&quot;&lt;script src=\&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/&quot;).append(version).append(&quot;/angular2-polyfills&quot;);</span>

<span class="nc bnc" id="L1815" title="All 2 branches missed.">			if (minified) {</span>
<span class="nc" id="L1816">				htmlCode.append(&quot;.min&quot;);</span>
			}

<span class="nc" id="L1819">			htmlCode.append(&quot;.js\&quot;&gt;&lt;/script&gt;&quot;);</span>

<span class="nc" id="L1821">			return htmlCode.toString();</span>
		}

<span class="nc" id="L1824">		return &quot;&quot;;</span>
	}

	public static String getDomainBaseHref(HttpServletRequest request) {

<span class="fc" id="L1829">		StringBuilder sb = new StringBuilder();</span>

<span class="fc" id="L1831">		sb.append(&quot;http&quot;);</span>

<span class="pc bpc" id="L1833" title="1 of 2 branches missed.">		if (Tools.isSecure(request)) {</span>
<span class="nc" id="L1834">			sb.append(&quot;s&quot;);</span>
		}

<span class="fc" id="L1837">		sb.append(&quot;://&quot;);</span>
<span class="fc" id="L1838">		sb.append(DocDB.getDomain(request));</span>

<span class="fc" id="L1840">		return sb.toString();</span>
	}

	/**
	 * Vrati base HTTP adresu servera, cize nieco ako http://www.interway.sk
	 * vie si poradit aj s portami a umiestnenim za reverzne proxy
	 * @param request
	 * @return
	 */
	public static String getBaseHref(HttpServletRequest request)
	{
<span class="fc" id="L1851">		String httpServerName = Constants.getString(&quot;httpServerName&quot;);</span>

<span class="fc bfc" id="L1853" title="All 2 branches covered.">		if (request == null)</span>
		{
<span class="pc bpc" id="L1855" title="1 of 2 branches missed.">			if (httpServerName.startsWith(&quot;http&quot;)==false) httpServerName = &quot;http://&quot;+httpServerName;</span>

<span class="pc bpc" id="L1857" title="1 of 2 branches missed.">			if (Tools.isEmpty(httpServerName)) {</span>
				//skus vydedukovat podla requestBeanu
<span class="nc" id="L1859">				RequestBean rb = SetCharacterEncodingFilter.getCurrentRequestBean();</span>
<span class="nc bnc" id="L1860" title="All 2 branches missed.">				if (rb!=null) return rb.getBaseHref();</span>
<span class="nc" id="L1861">				return null;</span>
			}

<span class="fc" id="L1864">			StringBuilder baseHref = new StringBuilder(httpServerName);</span>

<span class="pc bpc" id="L1866" title="1 of 2 branches missed.">			if (Constants.getInt(&quot;httpServerPort&quot;) != 80)</span>
			{
<span class="nc" id="L1868">				baseHref.append(':').append(Constants.getInt(&quot;httpServerPort&quot;));</span>
			}

<span class="fc" id="L1871">			return baseHref.toString();</span>
		}

<span class="fc" id="L1874">		StringBuilder baseHref = new StringBuilder();</span>
<span class="pc bpc" id="L1875" title="1 of 2 branches missed.">		if (Tools.isSecure(request)) baseHref.append(&quot;https&quot;);</span>
<span class="fc" id="L1876">		else baseHref.append(&quot;http&quot;);</span>
<span class="fc" id="L1877">		baseHref.append(&quot;://&quot;);</span>

<span class="pc bpc" id="L1879" title="1 of 2 branches missed.">		if (Tools.isNotEmpty(httpServerName))</span>
		{
<span class="nc" id="L1881">			baseHref = new StringBuilder(httpServerName);</span>
		}
<span class="pc bpc" id="L1883" title="2 of 4 branches missed.">		else if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; Tools.isNotEmpty(request.getHeader(&quot;x-forwarded-host&quot;)))</span>
		{
<span class="nc" id="L1885">			baseHref.append(request.getHeader(&quot;x-forwarded-host&quot;));</span>
		}
		else
		{
<span class="fc" id="L1889">			baseHref.append(Tools.getServerName(request, false));</span>
		}

<span class="pc bpc" id="L1892" title="1 of 2 branches missed.">        if (Constants.getInt(&quot;httpServerPort&quot;) == -1)</span>
        {
            //ak je httpServerPort nastavene na -1 pridame do URL priamo jeho hodnotu (pouziva sa, ked server bezi na viacerych portoch a nie je maskovany navonok)
<span class="nc bnc" id="L1895" title="All 4 branches missed.">            if (request.getServerPort()!=80 &amp;&amp; request.getServerPort()!=443)</span>
            {
<span class="nc" id="L1897">                baseHref.append(':').append(request.getServerPort());</span>
            }
        }
<span class="pc bpc" id="L1900" title="1 of 2 branches missed.">		else if (Constants.getInt(&quot;httpServerPort&quot;) != 80)</span>
		{
<span class="nc" id="L1902">			baseHref.append(':').append(Constants.getInt(&quot;httpServerPort&quot;));</span>
		}

<span class="pc bpc" id="L1905" title="1 of 2 branches missed.">		if (Tools.isEmpty(httpServerName))</span>
		{
<span class="pc bpc" id="L1907" title="3 of 4 branches missed.">			if (Tools.isNotEmpty(request.getContextPath()) &amp;&amp; request.getContextPath().equals(&quot;/&quot;)==false)</span>
			{
<span class="nc" id="L1909">				baseHref.append(request.getContextPath());</span>
			}
		}

<span class="fc" id="L1913">		return baseHref.toString();</span>
	}

	/**
	 * Vrati base HTTP adresu servera pre loopback HTTP spojenie, cize nieco ako http://localhost:8080/
	 * @param request
	 * @return
	 */
	public static String getBaseHrefLoopback(HttpServletRequest request)
	{
<span class="nc" id="L1923">		String baseHref = Constants.getString(&quot;baseHrefLoopback&quot;);</span>
<span class="nc bnc" id="L1924" title="All 2 branches missed.">		if (Tools.isEmpty(baseHref)) baseHref = getBaseHref(request);</span>
<span class="nc" id="L1925">		else baseHref = Tools.replace(baseHref, &quot;SERVER_NAME&quot;, Tools.getServerName(request));</span>

<span class="nc" id="L1927">		return baseHref;</span>
	}

	public static boolean isInteger(String possibleNumber)
	{
<span class="fc bfc" id="L1932" title="All 2 branches covered.">		if (possibleNumber == null)</span>
<span class="fc" id="L1933">			return false;</span>
<span class="fc" id="L1934">		return possibleNumber.trim().matches(&quot;^-?[0-9]+$&quot;); //NOSONAR</span>
	}

	/**
	 * Vrati Calendar z rodneho cisla. Tento Calendar
	 * obsahuje vek cloveka s tymto rodnych cislom.
	 *
	 * pocet rokov si potom zistime jednoduchym zavolanim:
	 * 	extractFromAge(rodneCislo).get(Calendar.YEAR)
	 *
	 * Pri priestupnych rokoch ma odchylku +- jeden den.
	 *
	 * @param birthId - rodne cislo
	 * @return {@link Calendar}
	 */
	public static Calendar extractAgeFrom(String birthId)
	{
<span class="nc bnc" id="L1951" title="All 4 branches missed.">		if (birthId == null || birthId.length() &lt; 6)</span>
<span class="nc" id="L1952">			throw new IllegalArgumentException(&quot;Neplatne rodne cislo: &quot;+birthId);</span>
<span class="nc" id="L1953">		Calendar now = Calendar.getInstance();</span>
		//calendar pocita mesiace od 0, ale rodne cislo od 1
<span class="nc" id="L1955">		now.add(Calendar.MONTH, 1);</span>
		//pretekajuci kalendar...
<span class="nc" id="L1957">		now.setLenient(true);</span>
		//zistime a odpocitame roky
<span class="nc bnc" id="L1959" title="All 2 branches missed.">		int birthYear = Integer.parseInt(birthId.substring(0,2)) &gt; (now.get(Calendar.YEAR) - 2000) ?</span>
<span class="nc" id="L1960">					Integer.parseInt(birthId.substring(0,2)) + 1900 :</span>
<span class="nc" id="L1961">					Integer.parseInt(birthId.substring(0,2)) + 2000;</span>
<span class="nc" id="L1962">		now.add(Calendar.YEAR, -birthYear );</span>
		//to iste s mesiacmi a dnami
<span class="nc bnc" id="L1964" title="All 2 branches missed.">		int birthMonth = Integer.parseInt(birthId.substring(2,4)) &gt; 50 ?</span>
<span class="nc" id="L1965">					Integer.parseInt(birthId.substring(2,4)) - 50:</span>
<span class="nc" id="L1966">					Integer.parseInt(birthId.substring(2,4));</span>
<span class="nc" id="L1967">		now.add(Calendar.MONTH,-birthMonth);</span>
<span class="nc" id="L1968">		now.add(Calendar.DAY_OF_MONTH, - Integer.parseInt(birthId.substring(4,6)));</span>
<span class="nc" id="L1969">		return now;</span>
	}

	/**
	 * Vracia id prihlaseneho pouzivatela. Identicka metoda je aj v {@link BasketDB},
	 * kde nema co robit
	 *
	 * @param request
	 * @return {@link Integer} userId
	 */
	public static int getUserId(HttpServletRequest request)
	{
<span class="fc" id="L1981">		int userId = -1;</span>
<span class="fc" id="L1982">		HttpSession session = request.getSession();</span>
<span class="fc" id="L1983">		Identity user = (Identity)session.getAttribute(Constants.USER_KEY);</span>
<span class="pc bpc" id="L1984" title="1 of 2 branches missed.">		if (user != null) userId = user.getUserId();</span>
<span class="fc" id="L1985">		return(userId);</span>
	}

	/**
	 * Otestuje, ci pole arrOne obsahuje aspon jeden prvok z pola arrTwo
	 * @param arrOne
	 * @param arrTwo
	 * @return
	 */
	public static boolean containsOneItem(int[] arrOne, int[] arrTwo)
	{
<span class="nc bnc" id="L1996" title="All 8 branches missed.">		if (arrOne==null || arrOne.length==0 || arrTwo==null || arrTwo.length==0) return false;</span>

<span class="nc bnc" id="L1998" title="All 2 branches missed.">		for (int one : arrOne)</span>
		{
<span class="nc bnc" id="L2000" title="All 2 branches missed.">			for (int two : arrTwo)</span>
			{
<span class="nc bnc" id="L2002" title="All 2 branches missed.">				if (one == two) return true;</span>
			}
		}
<span class="nc" id="L2005">		return false;</span>
	}

	/**
	 * Otestuje, ci pole arrOne obsahuje aspon jeden prvok z pola arrTwo
	 * @param arrOne
	 * @param arrTwo
	 * @return
	 */
	public static boolean containsOneItem(String[] arrOne, String[] arrTwo)
	{
<span class="nc bnc" id="L2016" title="All 8 branches missed.">		if (arrOne==null || arrOne.length==0 || arrTwo==null || arrTwo.length==0) return false;</span>

<span class="nc bnc" id="L2018" title="All 2 branches missed.">		for (String one : arrOne)</span>
		{
<span class="nc bnc" id="L2020" title="All 2 branches missed.">			for (String two : arrTwo)</span>
			{
<span class="nc bnc" id="L2022" title="All 2 branches missed.">				if (one.equals(two)) return true;</span>
			}
		}
<span class="nc" id="L2025">		return false;</span>
	}

    /**
     * Otestuje, ci pole arrOne obsahuje two
     * @param arrOne
     * @param two
     * @return
     */
    public static boolean containsOneItem(String[] arrOne, String two)
    {
<span class="pc bpc" id="L2036" title="3 of 6 branches missed.">        if (arrOne==null || arrOne.length==0 || two==null) return false;</span>

<span class="fc bfc" id="L2038" title="All 2 branches covered.">        for (String one : arrOne)</span>
        {
<span class="fc bfc" id="L2040" title="All 2 branches covered.">           if (one.equals(two)) return true;</span>
        }
<span class="fc" id="L2042">        return false;</span>
    }

	/**
	 * Vrati, ci je rozdiel medzi dvomi double cislami mensi ako zadana odchylka
	 */
	public static boolean doubleEquals(double firstNumber,double secondNumber,double eps)
	{
<span class="nc bnc" id="L2050" title="All 2 branches missed.">		return Math.abs( firstNumber - secondNumber ) &lt; eps;</span>
	}

	/**
	 * Vrati, ci sa dve cisla rovnaju v signifikantnych bitoch -
	 * reprezentacia dvoch cisiel v JVM v double formate sa moze lisit
	 * na poslednych 8 bitoch - preto == nemusi fungovat.
	 * Skuste System.out.println((1.0d / 49)*49)
	 */
	public static boolean doubleEquals(double firstNumber,double secondNumber)
	{
<span class="nc" id="L2061">		return doubleEquals(firstNumber, secondNumber,1e-7);</span>
	}

	public static boolean isAnyNotEmpty(String... values)
	{
<span class="nc bnc" id="L2066" title="All 2 branches missed.">		for (String value : values)</span>
<span class="nc bnc" id="L2067" title="All 2 branches missed.">			if (isNotEmpty(value))</span>
<span class="nc" id="L2068">				return true;</span>
<span class="nc" id="L2069">		return false;</span>
	}


	public static boolean isAnyEmpty(String... values)
	{
<span class="fc bfc" id="L2075" title="All 2 branches covered.">		for (String value : values)</span>
<span class="fc bfc" id="L2076" title="All 2 branches covered.">			if (isEmpty(value))</span>
<span class="fc" id="L2077">				return true;</span>
<span class="fc" id="L2078">		return false;</span>
	}

	public static boolean areNotEmpty(String... values)
	{
<span class="nc bnc" id="L2083" title="All 2 branches missed.">		return !isAnyEmpty(values);</span>
	}

	/**
	 * Vrati novy zoznam, ktory pozostava z prvkov povodneho zoznamu,
	 * ktore splnaju zadanu podmienku.
	 */
	public static &lt;T&gt; List&lt;T&gt; filter( List&lt;? extends T&gt; originalList,SelectionFilter&lt;? super T&gt; filter)
	{
<span class="nc" id="L2092">		List&lt;T&gt; list = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L2093" title="All 2 branches missed.">		for (T element : originalList)</span>
<span class="nc bnc" id="L2094" title="All 2 branches missed.">			if (filter.fullfilsConditions(element))</span>
<span class="nc" id="L2095">				list.add(element);</span>
<span class="nc" id="L2096">		return list;</span>
	}

	/**
	 * Vrati serverName z poziadavky aj ked je za proxy.
	 *
	 * @param request
	 * @return
	 */
	public static String getServerName(HttpServletRequest request)
	{
<span class="fc" id="L2107">		return getServerName(request, true);</span>
	}

	/**
	 * Vrati server name aj ked je za proxy
	 * @param request
	 * @param useAlias - ak je true robi sa aj serverAlias, false treba len pri tvorbe presmerovani
	 * @return
	 */
	public static String getServerName(HttpServletRequest request, boolean useAlias)
	{
<span class="pc bpc" id="L2118" title="1 of 2 branches missed.">		if (request == null) return null;</span>

<span class="fc" id="L2120">		String serverName = request.getServerName();</span>
<span class="pc bpc" id="L2121" title="1 of 2 branches missed.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;))</span>
        {
<span class="fc" id="L2123">			String forwardHost = Tools.sanitizeHttpHeaderParam(request.getHeader(&quot;x-forwarded-host&quot;));</span>
<span class="pc bpc" id="L2124" title="1 of 2 branches missed.">			if (Tools.isNotEmpty(forwardHost))</span>
			{
<span class="nc bnc" id="L2126" title="All 8 branches missed.">				if (forwardHost.contains(&quot;&lt;&quot;)==false &amp;&amp; forwardHost.contains(&quot;&gt;&quot;)==false &amp;&amp; forwardHost.contains(&quot;\&quot;&quot;)==false &amp;&amp; forwardHost.contains(&quot;'&quot;)==false)</span>
				{
<span class="nc" id="L2128">					serverName = forwardHost;</span>
				}
			}
        }

<span class="fc bfc" id="L2133" title="All 2 branches covered.">		if (useAlias)</span>
		{
<span class="fc" id="L2135">			String domainName = DomainRedirectDB.getDomainFromAlias(serverName);</span>
<span class="pc bpc" id="L2136" title="1 of 2 branches missed.">			if (Tools.isNotEmpty(domainName)) serverName = domainName;</span>
		}

<span class="fc" id="L2139">		return (serverName);</span>
	}

	/**
	 * Vracia cely String, ktory pouzivatel uvidi v adresnej liste v prehliadaci,
	 * URL + queryString
	 *
	 * nieco ako:
	 * http://www.google.sk/search?q=something&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:sk:official&amp;client=firefox-a
	 */
	public static String getRequestedLink(HttpServletRequest request)
	{
<span class="nc" id="L2151">		StringBuilder link = new StringBuilder();</span>
<span class="nc bnc" id="L2152" title="All 2 branches missed.">		link.append( Tools.isSecure(request) ? &quot;https&quot; : &quot;http&quot; );</span>
<span class="nc" id="L2153">		link.append(&quot;://&quot;);</span>
<span class="nc" id="L2154">		link.append(Tools.getServerName(request));</span>
<span class="nc" id="L2155">		String path = PathFilter.getOrigPath(request);</span>
<span class="nc bnc" id="L2156" title="All 2 branches missed.">		if (path == null) path = request.getRequestURI();</span>
<span class="nc" id="L2157">		link.append(path);</span>
<span class="nc bnc" id="L2158" title="All 2 branches missed.">		if (Tools.isNotEmpty(request.getQueryString()))</span>
		{
<span class="nc" id="L2160">			link.append('?');</span>
<span class="nc" id="L2161">			link.append(request.getQueryString());</span>
		}
<span class="nc" id="L2163">		return link.toString();</span>
	}

	public static String getRealPath(String virtualPathParam) {
<span class="fc" id="L2167">		String virtualPath = virtualPathParam;</span>

		// JDK 8 + Tomcat 8 nezvladaju url cast v ceste k suboru
<span class="fc bfc" id="L2170" title="All 2 branches covered.">		if (Tools.isNotEmpty(virtualPath)) {</span>
<span class="fc" id="L2171">			int index = virtualPath.indexOf(&quot;?&quot;);</span>
<span class="fc bfc" id="L2172" title="All 2 branches covered.">			if (index &gt; 0) {</span>
<span class="fc" id="L2173">				virtualPath = virtualPath.substring(0, index);</span>
			}

<span class="fc bfc" id="L2176" title="All 2 branches covered.">			if (virtualPath.contains(&quot;:&quot;)) {</span>
<span class="fc" id="L2177">				virtualPath = Tools.replace(virtualPath, &quot;:&quot;, &quot;-&quot;);</span>
			}

<span class="pc bpc" id="L2180" title="1 of 2 branches missed.">			if (virtualPath.contains(&quot;*&quot;)) {</span>
<span class="nc" id="L2181">				virtualPath = Tools.replace(virtualPath, &quot;*&quot;, &quot;&quot;);</span>
			}

<span class="fc" id="L2184">			virtualPath = virtualPath.trim();</span>

<span class="pc bpc" id="L2186" title="1 of 2 branches missed.">			if (virtualPath.contains(&quot;%&quot;)) {</span>
<span class="nc" id="L2187">				virtualPath = Tools.URLDecode(virtualPath);</span>
			}
		}
<span class="fc bfc" id="L2190" title="All 2 branches covered.">		if (virtualPath.startsWith(&quot;/&quot;) == false)</span>
<span class="fc" id="L2191">			virtualPath = &quot;/&quot; + virtualPath; // NOSONAR</span>

		// pre cloud WebJET posielame inu cestu k suborom
<span class="pc bpc" id="L2194" title="1 of 2 branches missed.">		if (FilePathTools.isExternalDir(virtualPath)) {</span>
			File file;
<span class="nc bnc" id="L2196" title="All 2 branches missed.">			if (virtualPath.startsWith(&quot;/shared&quot;)</span>
<span class="nc bnc" id="L2197" title="All 2 branches missed.">					|| virtualPath.startsWith(Constants.getString(&quot;thumbServletCacheDir&quot;) + &quot;shared&quot;)) {</span>
				// ziskaj cestu pre akoby shared domenu
<span class="nc" id="L2199">				file = new File(FilePathTools.getDomainBaseFolder(&quot;shared&quot;), virtualPath);</span>
<span class="nc bnc" id="L2200" title="All 4 branches missed.">				if (virtualPath.equals(&quot;/shared&quot;) || virtualPath.equals(&quot;/shared/&quot;)) {</span>
					try {
						// vytvor hlavnu strukturu pre shared adresar na sietovom disku, domenove sa
						// robia automaticky, toto je komplikovanejsie
<span class="nc bnc" id="L2204" title="All 2 branches missed.">						if (file.exists() == false)</span>
<span class="nc" id="L2205">							file.mkdirs();</span>
<span class="nc" id="L2206">					} catch (Exception ex) {</span>
<span class="nc" id="L2207">					}</span>
				}
			} else {
<span class="nc" id="L2210">				file = new File(FilePathTools.getDomainBaseFolder(), virtualPath);</span>
			}
			// Logger.debug(Tools.class, &quot;getRealPath, return=&quot;+file.getAbsolutePath()+&quot;
			// virtualPath=&quot;+virtualPath);

<span class="nc" id="L2215">			String path = file.getAbsolutePath();</span>
<span class="nc bnc" id="L2216" title="All 4 branches missed.">			if (virtualPath.endsWith(&quot;/&quot;) &amp;&amp; path.endsWith(File.separator) == false)</span>
<span class="nc" id="L2217">				path += File.separator;</span>
<span class="nc" id="L2218">			return (path);</span>
		}

		// String path = Constants.getServletContext().getRealPath(virtualPath);
<span class="fc" id="L2222">		String path = null;</span>
		try {
			// kvoli Tomcat 8.5 a symlinkam to potrebujeme takto
<span class="fc" id="L2225">			File f = new File(Constants.getServletContext().getRealPath(&quot;/&quot;));</span>
			// to musi ist CanonicalPath aby nam nevracalo
			// /www/tomcat_au2/webapps2/../webapps/iway_2016
<span class="fc" id="L2228">			String rootPath = f.getCanonicalPath();</span>
<span class="pc bpc" id="L2229" title="1 of 4 branches missed.">			if (Tools.isEmpty(virtualPath) || &quot;/&quot;.equals(virtualPath))</span>
<span class="fc" id="L2230">				path = rootPath;</span>
			else {
				// pridavame cestu k root adresaru, to nema zacinat na lomitko
<span class="fc" id="L2233">				String addPath = Tools.replace(virtualPath, &quot;/&quot;, &quot;&quot; + File.separatorChar).substring(1);</span>
<span class="fc" id="L2234">				f = new File(rootPath, addPath);</span>
				// tu musi ist getAbsolutePath aby neprelozilo symlink
<span class="fc" id="L2236">				path = f.getAbsolutePath();</span>
			}
<span class="nc" id="L2238">		} catch (Exception ex) {</span>
<span class="nc" id="L2239">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L2240">		}</span>

<span class="pc bpc" id="L2242" title="1 of 2 branches missed.">		if (path == null) {</span>
<span class="nc" id="L2243">			path = Constants.getServletContext().getRealPath(&quot;/&quot;) + Tools.replace(virtualPath, &quot;/&quot;, &quot;&quot; + File.separatorChar);</span>
<span class="nc" id="L2244">			path = Tools.replace(path, &quot;&quot; + File.separatorChar + File.separatorChar, &quot;&quot; + File.separatorChar);</span>
		}

		// podpora /admin/generate.jsp kde sa volaju subory z ../support/generators
		// adresara
<span class="pc bpc" id="L2249" title="3 of 4 branches missed.">		if (Tools.isNotEmpty(PathFilter.getCustomPath()) &amp;&amp; virtualPath.startsWith(&quot;..&quot;)</span>
<span class="nc bnc" id="L2250" title="All 2 branches missed.">				&amp;&amp; virtualPath.indexOf(&quot;/WebContent/&quot;) == -1) {</span>
<span class="nc" id="L2251">			String myPath = Constants.getServletContext().getRealPath(&quot;/&quot;) + &quot;/&quot; + virtualPath; // NOSONAR</span>
<span class="nc bnc" id="L2252" title="All 2 branches missed.">			if (myPath.indexOf(&quot;/WebContent/..&quot;) != -1) {</span>
<span class="nc" id="L2253">				path = Tools.replace(myPath, &quot;/WebContent/..&quot;, &quot;&quot;);</span>
			}
		}

		// JDK9 + Tomcat 8 - root path by mala koncit lomitkom (tak to bolo doteraz)
<span class="pc bpc" id="L2258" title="1 of 4 branches missed.">		if (&quot;/&quot;.equals(virtualPath) &amp;&amp; path.endsWith(File.separator) == false)</span>
<span class="fc" id="L2259">			path = path + File.separator;</span>

<span class="pc bpc" id="L2261" title="1 of 2 branches missed.">		if (path.contains(&quot;..&quot;))</span>
<span class="nc" id="L2262">			path = Tools.replace(path, &quot;/webapps2/../webapps/&quot;, &quot;/webapps/&quot;);</span>

<span class="fc" id="L2264">		path = FileTools.symlinkReplaceToRootPath(path);</span>

		//add last slash if it's on virutal path (to directly combine with file name)
<span class="fc bfc" id="L2267" title="All 4 branches covered.">		if (virtualPath.endsWith(&quot;/&quot;) &amp;&amp; path.endsWith(File.separator) == false) path += File.separator;</span>

<span class="fc" id="L2269">		return path;</span>
	}

	/**
	 *  capitalize(&quot;nieco Nieco nIeCo&quot;) =&gt; &quot;Nieco Nieco Nieco&quot;
	 */
	public static String capitalize(String source)
	{
<span class="nc bnc" id="L2277" title="All 2 branches missed.">		if (isEmpty(source))</span>
<span class="nc" id="L2278">			return source;</span>

<span class="nc" id="L2280">		Matcher matcher = Pattern.compile(&quot;(\\b)(.)(.*?)(\\b)&quot;).matcher(source); //NOSONAR</span>

<span class="nc bnc" id="L2282" title="All 2 branches missed.">		while (matcher.find())</span>
		{
<span class="nc" id="L2284">			String whole = matcher.group(0);</span>
<span class="nc" id="L2285">			String spaceBefore = matcher.group(1);</span>
<span class="nc" id="L2286">			String firstLetter = matcher.group(2).toUpperCase();</span>
<span class="nc" id="L2287">			String remainder = matcher.group(3).toLowerCase();</span>
<span class="nc" id="L2288">			String spaceAfter = matcher.group(4);</span>
<span class="nc" id="L2289">			source = source.replace(whole, spaceBefore+firstLetter+remainder+spaceAfter);</span>
<span class="nc" id="L2290">		}</span>

<span class="nc" id="L2292">		return source;</span>
	}

	/**
	 * Funkcia vrati objekt typu Date zo vstupneho retazca dateString na zaklade formatu uvedeneho v parametri formatString.
	 * Napr. Tools.getDateFromString(&quot;20091231 235959&quot;, &quot;yyyyMMdd HHmmss&quot;) vrati objekt Date s nastavenymi hodnotami ako 31.12.2009 23:59:59
    *
	 * @author kmarton
	 *
	 * @param dateString		vstupny retazec, z ktoreho chceme ziskat objekt Date, napr. &quot;20091231 235959&quot;
	 * @param formatString	formatovaci retazec, podla ktoreho sa bude formatovat vstupny retazec dateString, napr. &quot;yyyyMMdd HHmmss&quot;
	 *
	 * @return vrati objekt typu Date s nastavenymi hodnotami podla vstupnych parametrov, ak sa vyskytne nejaka parsovacia chyba, vrati null
	 */
	public static Date getDateFromString(String dateString, String formatString)
	{
<span class="nc" id="L2308">		Date date = null;</span>
   	try
   	{
<span class="nc" id="L2311">   		DateFormat formatter = new SimpleDateFormat(formatString);</span>
<span class="nc" id="L2312">   		date = formatter.parse(dateString);</span>
   	}
<span class="nc" id="L2314">   	catch (ParseException e)</span>
   	{
<span class="nc" id="L2316">   		sk.iway.iwcm.Logger.error(e);</span>
<span class="nc" id="L2317">   	}</span>

<span class="nc" id="L2319">   	return date;</span>

	}

	/**
	 * Funkcia vrati lokalizovane meno mesiaca z properties, pouzitim pozadovaneho jazyka
	 * @param month - cislo mesiaca v konvencii triedy &lt;code&gt;Calendar&lt;/code&gt; (tj. januar = 0, februar = 1 ... december = 11)
	 * @param lng - pozadovany jazyk, ak je &lt;code&gt;null&lt;/code&gt;, pouzije sa defaultLanguage z Constants
	 * @return - lokalizovany nazov mesiaca
	 */
	public static String getMonthNameLocalized(int month, String lng)
	{
<span class="nc" id="L2331">		String localizedMonth = &quot;&quot;;</span>
		Prop prop;
<span class="nc bnc" id="L2333" title="All 2 branches missed.">		if(lng == null)</span>
<span class="nc" id="L2334">			prop = Prop.getInstance();</span>
		else
<span class="nc" id="L2336">			prop = Prop.getInstance(lng);</span>
<span class="nc bnc" id="L2337" title="All 13 branches missed.">		switch(month) //NOSONAR</span>
		{
<span class="nc" id="L2339">			case 0: localizedMonth = prop.getText(&quot;component.calendar.january&quot;);break;</span>
<span class="nc" id="L2340">			case 1: localizedMonth = prop.getText(&quot;component.calendar.february&quot;);break;</span>
<span class="nc" id="L2341">			case 2: localizedMonth = prop.getText(&quot;component.calendar.march&quot;);break;</span>
<span class="nc" id="L2342">			case 3: localizedMonth = prop.getText(&quot;component.calendar.april&quot;);break;</span>
<span class="nc" id="L2343">			case 4: localizedMonth = prop.getText(&quot;component.calendar.may&quot;);break;</span>
<span class="nc" id="L2344">			case 5: localizedMonth = prop.getText(&quot;component.calendar.june&quot;);break;</span>
<span class="nc" id="L2345">			case 6: localizedMonth = prop.getText(&quot;component.calendar.july&quot;);break;</span>
<span class="nc" id="L2346">			case 7: localizedMonth = prop.getText(&quot;component.calendar.august&quot;);break;</span>
<span class="nc" id="L2347">			case 8: localizedMonth = prop.getText(&quot;component.calendar.september&quot;);break;</span>
<span class="nc" id="L2348">			case 9: localizedMonth = prop.getText(&quot;component.calendar.october&quot;);break;</span>
<span class="nc" id="L2349">			case 10: localizedMonth = prop.getText(&quot;component.calendar.november&quot;);break;</span>
<span class="nc" id="L2350">			case 11: localizedMonth = prop.getText(&quot;component.calendar.december&quot;);break;</span>
		}
<span class="nc" id="L2352">		return localizedMonth;</span>
	}

	/**
	 * Funkcia vrati lokalizovane meno mesiaca z properties, pouzitim predvoleneho jazyka (parameter defaultLanguage z Constants)
	 * @param month - cislo mesiaca v konvencii triedy &lt;code&gt;Calendar&lt;/code&gt; (tj. januar = 0, februar = 1 ... december = 11)
	 * @return - lokalizovany nazov mesiaca
	 */
	public static String getMonthNameLocalized(int month)
	{
<span class="nc" id="L2362">		return getMonthNameLocalized(month, null);</span>
	}

		// This method returns a buffered image with the contents of an image
	public static BufferedImage toBufferedImage(Image image) {
<span class="nc bnc" id="L2367" title="All 2 branches missed.">	    if (image instanceof BufferedImage) {</span>
<span class="nc" id="L2368">	        return (BufferedImage)image;</span>
	    }

	    // This code ensures that all the pixels in the image are loaded
<span class="nc" id="L2372">	    image = new ImageIcon(image).getImage();</span>

	    // Determine if the image has transparent pixels; for this method's
	    // implementation, see Determining If an Image Has Transparent Pixels
	    //boolean hasAlpha = hasAlpha(image);

	    // Create a buffered image with a format that's compatible with the screen
<span class="nc" id="L2379">	    BufferedImage bimage = null;</span>
<span class="nc" id="L2380">	    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
	    try {
	        // Determine the type of transparency of the new buffered image
<span class="nc" id="L2383">	        int transparency = Transparency.OPAQUE;</span>
//	        if (hasAlpha) {
//	            transparency = Transparency.BITMASK;
//	        }

	        // Create the buffered image
<span class="nc" id="L2389">	        GraphicsDevice gs = ge.getDefaultScreenDevice();</span>
<span class="nc" id="L2390">	        GraphicsConfiguration gc = gs.getDefaultConfiguration();</span>
<span class="nc" id="L2391">	        bimage = gc.createCompatibleImage(</span>
<span class="nc" id="L2392">	            image.getWidth(null), image.getHeight(null), transparency);</span>
<span class="nc" id="L2393">	    } catch (HeadlessException e) {</span>
	        // The system does not have a screen
<span class="nc" id="L2395">	    }</span>

<span class="nc bnc" id="L2397" title="All 2 branches missed.">	    if (bimage == null) {</span>
	        // Create a buffered image using the default color model
<span class="nc" id="L2399">	        int type = BufferedImage.TYPE_INT_RGB;</span>
//	        if (hasAlpha) {
//	            type = BufferedImage.TYPE_INT_ARGB;
//	        }
<span class="nc" id="L2403">	        bimage = new BufferedImage(image.getWidth(null), image.getHeight(null), type);</span>
	    }

	    // Copy image to buffered image
<span class="nc" id="L2407">	    Graphics g = bimage.createGraphics();</span>

	    // Paint the image onto the buffered image
<span class="nc" id="L2410">	    g.drawImage(image, 0, 0, null);</span>
<span class="nc" id="L2411">	    g.dispose();</span>

<span class="nc" id="L2413">	    return bimage;</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	public static &lt;T&gt; T firstNonNull(T...possibilities)
	{
<span class="pc bpc" id="L2419" title="1 of 2 branches missed.">		if (possibilities.length == 0)</span>
<span class="nc" id="L2420">			return null;</span>
<span class="fc" id="L2421">		T lastOne = possibilities[possibilities.length - 1];</span>
<span class="pc bpc" id="L2422" title="1 of 2 branches missed.">		for (T t : possibilities)</span>
<span class="pc bpc" id="L2423" title="1 of 2 branches missed.">			if (t != null)</span>
<span class="fc" id="L2424">				return t;</span>

<span class="nc" id="L2426">		return lastOne;</span>
	}

	/**
	 * Ziskanie hodnoty ako boolean
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static boolean getBooleanValue(String value, boolean defaultValue)
	{
<span class="fc bfc" id="L2437" title="All 2 branches covered.">		if (value==null)</span>
		{
<span class="fc" id="L2439">			return(defaultValue);</span>
		}
<span class="pc bpc" id="L2441" title="2 of 6 branches missed.">		return value.equalsIgnoreCase(&quot;yes&quot;) || value.equalsIgnoreCase(&quot;true&quot;) || value.equalsIgnoreCase(&quot;1&quot;);</span>
	}

	/**
	 * deeply clones a Map by cloning all the values.
	 */
	public static Map&lt;String,String&gt; deepCopy(Map&lt;String, String&gt; original) {
<span class="fc" id="L2448">	    Map&lt;String, String&gt; copy = new HashMap&lt;&gt;(original.size());</span>
<span class="fc bfc" id="L2449" title="All 2 branches covered.">	    for(Map.Entry&lt;String, String&gt; entry : original.entrySet()) {</span>
<span class="fc" id="L2450">	        copy.put(entry.getKey(), entry.getValue());</span>
<span class="fc" id="L2451">	    }</span>
<span class="fc" id="L2452">	    return copy;</span>
	}


	public static boolean addCookie(javax.servlet.http.Cookie cookie, HttpServletResponse response, HttpServletRequest request)
	{

<span class="pc bpc" id="L2459" title="3 of 6 branches missed.">		if (response == null || cookie == null || request == null)</span>
		{
<span class="nc" id="L2461">			Logger.debug(Tools.class,&quot;response or cookie or request is null cookie wasn't add&quot;);</span>
<span class="nc" id="L2462">			return false;</span>
		}

<span class="fc" id="L2465">		String cookieName = cookie.getName();</span>
<span class="pc bpc" id="L2466" title="1 of 2 branches missed.">		if (&quot;statBrowserIdNew&quot;.equals(cookieName))</span>
		{
<span class="nc bnc" id="L2468" title="All 2 branches missed.">			if (canSetCookie(&quot;statisticke&quot;, request.getCookies())==false)</span>
			{
<span class="nc" id="L2470">				Logger.debug(Tools.class,&quot;Nemozem nastavit statBrowserIdNew pretoze nie je povolena skupina statisticke&quot;);</span>
<span class="nc" id="L2471">				return false;</span>
			}
		}

<span class="pc bpc" id="L2475" title="3 of 4 branches missed.">		if(canSetAnyCookie(request.getCookies()) || cookie.getName().equalsIgnoreCase(&quot;JSESSIONID&quot;))</span>
		{
<span class="pc bpc" id="L2477" title="3 of 4 branches missed.">			if (Tools.isSecure(request) &amp;&amp; Tools.isNotEmpty(Constants.getString(&quot;strictTransportSecurity&quot;)))</span>
			{
<span class="nc" id="L2479">				cookie.setSecure(true);</span>
			}

<span class="fc" id="L2482">			response.addCookie(cookie);</span>
<span class="fc" id="L2483">			return true;</span>
		}
		else
		{
<span class="nc" id="L2487">			Logger.debug(Tools.class,&quot;adding cookies is denied  &quot; + cookie.getName());</span>
<span class="nc" id="L2488">			return false;</span>
		}
	}

	public static boolean canSetCookie(String classification, javax.servlet.http.Cookie[] cookies)
	{
<span class="pc bpc" id="L2494" title="1 of 2 branches missed.">		if (Constants.getBoolean(&quot;gdprAllowAllCookies&quot;)) return true;</span>

<span class="pc bpc" id="L2496" title="1 of 6 branches missed.">		if(Tools.isEmpty(classification) || &quot;ALWAYS&quot;.equals(classification) || &quot;nutne&quot;.equals(classification))</span>
		{
<span class="fc" id="L2498">			return true;</span>
		}

<span class="fc" id="L2501">		boolean gdprInsertAllScriptsBeforeConsent = Constants.getBoolean(&quot;gdprInsertAllScriptsBeforeAccept&quot;);</span>
<span class="fc" id="L2502">		String cookieName = Constants.getString(&quot;gdprCookieName&quot;);</span>
<span class="fc" id="L2503">		String[] enableCookiesClass = Tools.getTokens(Tools.getCookieValue(cookies, cookieName, &quot;&quot;), &quot;_&quot;);</span>

		// LPA https://intra.iway.sk/helpdesk/tickets/detail/32155?comment=2267668
<span class="pc bpc" id="L2506" title="3 of 4 branches missed.">		if (gdprInsertAllScriptsBeforeConsent &amp;&amp; enableCookiesClass.length == 0) {</span>
<span class="nc" id="L2507">			return true;</span>
		}

<span class="pc bpc" id="L2510" title="1 of 2 branches missed.">		for(String enableCookie: enableCookiesClass)</span>
		{
<span class="nc bnc" id="L2512" title="All 2 branches missed.">			if(classification.equals(enableCookie))</span>
<span class="nc" id="L2513">				return true;</span>
		}

<span class="fc" id="L2516">		return false;</span>
	}

	/**
	 * Toto umoznuje uplne vypnut vkladanie cookies, staci nastavit cookie s nazvom cc_cookie_decline (Constants.disableCookiesCookieName) s hodnotu cc_cookie_decline (Constants.disableCookiesCookieValue)
	 * @param actualCookies
	 * @return
	 */
	private static boolean canSetAnyCookie(javax.servlet.http.Cookie[] actualCookies)
	{
<span class="pc bpc" id="L2526" title="2 of 6 branches missed.">		if(actualCookies == null || Tools.isEmpty(Constants.getString(&quot;disableCookiesCookieName&quot;)) || Tools.isEmpty(Constants.getString(&quot;disableCookiesCookieValue&quot;)) )</span>
<span class="fc" id="L2527">			return true;</span>

<span class="pc bpc" id="L2529" title="1 of 2 branches missed.">		if(actualCookies.length &gt; 0 )</span>
		{
<span class="fc bfc" id="L2531" title="All 2 branches covered.">			for (int i = 0; i &lt; actualCookies.length; i++)</span>
			{
<span class="pc bpc" id="L2533" title="1 of 2 branches missed.">				if (actualCookies[i].getName().equals (Constants.getString(&quot;disableCookiesCookieName&quot;))</span>
<span class="nc bnc" id="L2534" title="All 2 branches missed.">							&amp;&amp; Constants.getString(&quot;disableCookiesCookieValue&quot;).equals(actualCookies[i].getValue()))</span>
<span class="nc" id="L2535">					return false;</span>
			}
		}
<span class="fc" id="L2538">		return true;</span>
	}

	/**
	 * Vycisti html od znaciek a pod, vrati cisty text, odstrani viacnasobne whitespaces a newlines
	 * pre viac info : &lt;a href=&quot;http://jsoup.org/apidocs/&quot;&gt;http://jsoup.org/apidocs/ &lt;/a&gt;
	 * @param html
	 * @return
	 */
	public static String html2text(String html)
	{
<span class="fc bfc" id="L2549" title="All 2 branches covered.">		return isNotEmpty(html)?Jsoup.parse(html).text():&quot;&quot;;</span>
	}

	/**
	 * Vrati hodnotu parametra, alebo attributu (ak je parameter null). Ak je aj atribut null, vrati null.
	 *
	 * @param name
	 * @param request
	 * @return
	 */
	public static String getParamAttribute(String name, HttpServletRequest request)
	{
<span class="nc" id="L2561">		String ret = request.getParameter(name);</span>
<span class="nc bnc" id="L2562" title="All 2 branches missed.">		if (ret == null)</span>
		{
<span class="nc" id="L2564">			ret = (String) request.getAttribute(name);</span>
		}
<span class="nc" id="L2566">		return (ret);</span>
	}

	/**
	 * deep copy of list
	 * @param source
	 * @return
	 */
	public static &lt;T&gt; List&lt;T&gt; copyList(List&lt;T&gt; source)
	{
<span class="nc" id="L2576">		List&lt;T&gt; dest = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L2577" title="All 2 branches missed.">		for (T item : source)</span>
		{
<span class="nc" id="L2579">			dest.add(item);</span>
<span class="nc" id="L2580">		}</span>
<span class="nc" id="L2581">		return dest;</span>
	}

	/**
	 * performs save conversion from long to int
	 * if long value isn't convertable to int without change of value
	 * exception is thrown
	 * @param l
	 * @return int representation of longsomhow to
	 * @author mhalas
	 */
	public static int safeLongToInt(long l) {
<span class="nc bnc" id="L2593" title="All 4 branches missed.">	    if (l &lt; Integer.MIN_VALUE || l &gt; Integer.MAX_VALUE) {</span>
<span class="nc" id="L2594">	        throw new IllegalArgumentException</span>
	            (l + &quot; cannot be cast to int without changing its value.&quot;);
	    }
<span class="nc" id="L2597">	    return (int) l;</span>
	}


	/**
	 * Zmaze duplikaty z dlheho stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 *
	 * @param txt
	 * @param splitterRegex
	 * @return
	 */
	public static String removeDuplicates(String txt, String splitterRegex)
	{
<span class="nc" id="L2610">		List&lt;String&gt; values = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L2611">		String[] splitted = txt.split(splitterRegex);</span>
<span class="nc" id="L2612">		StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L2613" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2615" title="All 2 branches missed.">			if (!values.contains(splitted[i]))</span>
			{
<span class="nc" id="L2617">				values.add(splitted[i]);</span>
<span class="nc" id="L2618">				sb.append(splitterRegex);</span>
<span class="nc" id="L2619">				sb.append(splitted[i]);</span>
			}
		}
<span class="nc" id="L2622">		return sb.substring(1) + &quot;,&quot;;</span>
	}

	/**
	 * V dlhem stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 * skontroluje ci cele casti medzi oddelovacmi sa nenachodzaju v comparableText-e
	 *
	 * @param allText
	 * @param splitterRegex
	 * @param comparableText
	 * @return
	 */
	public static boolean containsWholePartInString(String allText, String splitterRegex, String comparableText)
	{
<span class="nc" id="L2636">		boolean ret = false;</span>
<span class="nc" id="L2637">		String[] splitted = allText.split(splitterRegex);</span>
<span class="nc bnc" id="L2638" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2640" title="All 2 branches missed.">			if (comparableText.equals(splitted[i]))</span>
			{
<span class="nc" id="L2642">				ret = true;</span>
			}
		}
<span class="nc" id="L2645">		return ret;</span>
	}

	/**
	 * Z dlheho stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 * prida na zaciatok kazdej hodnoty predponu z parametra &quot;addStringStart&quot;
	 *
	 * @param txt
	 * @param splitterRegex
	 * @param addStringStart
	 * @return
	 */
	public static String parseStringAddOnStart(String txt, String splitterRegex, String addStringStart)
	{
<span class="nc" id="L2659">		List&lt;String&gt; values = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L2660">		String[] splitted = txt.split(splitterRegex);</span>
<span class="nc" id="L2661">		StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L2662" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2664" title="All 2 branches missed.">			if (!values.contains(splitted[i]))</span>
			{
<span class="nc" id="L2666">				values.add(addStringStart + splitted[i]);</span>
<span class="nc" id="L2667">				sb.append(splitterRegex);</span>
<span class="nc" id="L2668">				sb.append(addStringStart + splitted[i]);</span>
			}
		}
<span class="nc" id="L2671">		return sb.substring(1) + &quot;,&quot;;</span>
	}

	/**
	 *
	 * @param string
	 * @param delimiter
	 * @return
	 */
	public List&lt;String&gt; stringToList(String string, String delimiter)
	{
<span class="nc" id="L2682">		return new ArrayList&lt;&gt;(Arrays.asList(string.split(delimiter)));</span>
	}

	/**
	 * prida k ceste parameter time s timestampom (aby sa znovunacitavalo ce es es ko)
	 * @param virtualPath
	 * @return
	 */
	public static String getPathWithTimestamp(String virtualPath)
	{
<span class="nc" id="L2692">		String realPath = PathFilter.getRealPath(virtualPath);</span>
<span class="nc" id="L2693">		File file = new File(realPath);</span>
<span class="nc bnc" id="L2694" title="All 2 branches missed.">		if (file.exists())</span>
		{
<span class="nc" id="L2696">			return addParameterToUrl(virtualPath,&quot;time&quot;,String.valueOf(file.lastModified()));</span>
		}
<span class="nc" id="L2698">		return virtualPath;</span>
	}


	/**
	 * checks if remote IP of requestis listed in allowed IPs constant ( comma separated string )
	 * @param request
	 * @param constantName - meno konfiguracnej premennej (ta je nastavena na znak * alebo zoznam ZACIATKOV povolenych ip adries oddelenych ciarkou)
	 * @return
	 */
	public static boolean checkIpAccess(HttpServletRequest request,String constantName){
<span class="fc" id="L2709">		String enabledIPs = Constants.getString(constantName);</span>

<span class="pc bpc" id="L2711" title="1 of 2 branches missed.">		if (&quot;*&quot;.equals(enabledIPs)) return true;</span>

<span class="pc bpc" id="L2713" title="1 of 2 branches missed.">		if (Tools.isEmpty(enabledIPs))</span>
		{
			//[#44392 - Vystavenie rest služby pre konkrétny formulár] - uloha #15 =&gt;
			//iba tieto 2 premenne mozu byt prazdne a je to povazovane za OK, ostatne musia mat nastavene * aby sa nestalo, ze kvoli preklepu v nazve premennej sa sluzba otvori navonok
<span class="nc bnc" id="L2717" title="All 4 branches missed.">			if (&quot;webEnableIPs&quot;.equals(constantName) || &quot;adminEnableIPs&quot;.equals(constantName)) return true;</span>
		}

<span class="pc bpc" id="L2720" title="2 of 4 branches missed.">		if (enabledIPs != null &amp;&amp; enabledIPs.length() &gt; 1)</span>
		{
<span class="fc" id="L2722">			StringTokenizer st = new StringTokenizer(enabledIPs, &quot;,&quot;);</span>
			String ip;
<span class="fc" id="L2724">			String myIP = Tools.getRemoteIP(request);</span>
<span class="fc" id="L2725">			Logger.debug(PathFilter.class,&quot;Checking: &quot; + myIP + &quot; vs &quot; + enabledIPs);</span>
<span class="pc bpc" id="L2726" title="1 of 2 branches missed.">			while (st.hasMoreTokens())</span>
			{
<span class="fc" id="L2728">				ip = st.nextToken();</span>
<span class="pc bpc" id="L2729" title="1 of 2 branches missed.">				if (myIP.startsWith(ip.trim()))</span>
				{
<span class="fc" id="L2731">					return true;</span>
				}
			}
		}
<span class="nc" id="L2735">		return false;</span>

	}


	/**
	 * Vrati request.getUserPrincipal aj pre spring owrapovanie (pouzivane pri integracii na IIS)
	 * @param request
	 * @return
	 */
	public static Principal getUserPrincipal(HttpServletRequest request)
	{
<span class="nc" id="L2747">		ServletRequestAttributes attr = (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes();</span>
		//Logger.debug(Tools.class, &quot;getUserPrincipal() attr: &quot;+attr);
<span class="nc" id="L2749">		Principal p = attr.getRequest().getUserPrincipal();</span>
		//Logger.debug(Tools.class, &quot;PRINCIPAL attr: &quot; + p);
<span class="nc bnc" id="L2751" title="All 2 branches missed.">		if (p != null) return p;</span>

<span class="nc" id="L2753">		return request.getUserPrincipal();</span>
	}

	public static String fixURL(String url)
	{
<span class="nc bnc" id="L2758" title="All 2 branches missed.">		if (url==null) return(&quot;&quot;);</span>

<span class="nc" id="L2760">		url = DocTools.removeCharsDir(url).toLowerCase();</span>

<span class="nc" id="L2762">		url = Tools.replace(url, &quot;//&quot;, &quot;/&quot;);</span>
<span class="nc" id="L2763">		url = Tools.replace(url, &quot;=&quot;, &quot;-&quot;);</span>
<span class="nc" id="L2764">		url = Tools.replace(url, &quot;_-_&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2765">		url = Tools.replace(url, &quot;__&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2766">		url = Tools.replace(url, &quot;___&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2767">		url = Tools.replace(url, &quot;._&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2768">		url = Tools.replace(url, &quot;_.html&quot;, &quot;.html&quot;);</span>
<span class="nc" id="L2769">		url = Tools.replace(url, &quot;.html.html&quot;, &quot;.html&quot;);</span>
		//ak mame nahradu spojok a bodiek v URL toto treba
<span class="nc" id="L2771">		url = Tools.replace(url, &quot;-html.html&quot;, &quot;.html&quot;);</span>
		//htm je tu kvoli importu web stranok zo zip archivu
<span class="nc" id="L2773">		url = Tools.replace(url, &quot;.htm.html&quot;, &quot;.htm&quot;);</span>
<span class="nc" id="L2774">		url = Tools.replace(url, &quot;-htm.html&quot;, &quot;.htm&quot;);</span>
<span class="nc" id="L2775">		return(url);</span>
	}

	/**
	 * Vrati orezany text po najblizsie slovo
	 */
	public static String truncateText(String text, int length){

<span class="nc bnc" id="L2783" title="All 2 branches missed.">		if(text.length() &gt; length){</span>
<span class="nc" id="L2784">			int index = text.lastIndexOf(&quot; &quot;, length);</span>
<span class="nc bnc" id="L2785" title="All 2 branches missed.">			if (index &gt; 0) text = text.substring(0, index);</span>
<span class="nc" id="L2786">			else text = text.substring(0, length);</span>
		}
<span class="nc" id="L2788">		return text;</span>
	}

	/**
	 * Skonvertuje |* tagy na html tagy
	 * @param text
	 * @return
	 */
	public static String convertToHtmlTags(String text){

<span class="pc bpc" id="L2798" title="1 of 2 branches missed.">		if (text.contains(&quot;*||&quot;)) text = Tools.replace(text, &quot;*||&quot;, &quot;&lt;/&quot;);</span>
<span class="pc bpc" id="L2799" title="1 of 2 branches missed.">		if (text.contains(&quot;*|&quot;)) text = Tools.replace(text, &quot;*|&quot;, &quot;&lt;&quot;);</span>
<span class="pc bpc" id="L2800" title="1 of 2 branches missed.">		if (text.contains(&quot;|*&quot;)) text = Tools.replace(text, &quot;|*&quot;, &quot;&gt;&quot;);</span>
<span class="fc bfc" id="L2801" title="All 2 branches covered.">		if (text.contains(&quot;&amp;amp;#47;&quot;)) text = Tools.replace(text, &quot;&amp;amp;#47;&quot;, &quot;&amp;#47;&quot;);</span>

<span class="fc" id="L2803">		return  text;</span>
	}

	public static boolean isNumeric(String str)
	{
<span class="fc bfc" id="L2808" title="All 2 branches covered.">		if (Tools.isEmpty(str)) return false;</span>
		try
		{
<span class="nc" id="L2811">			Double.parseDouble(str);</span>
		}
<span class="fc" id="L2813">		catch(NumberFormatException nfe)</span>
		{
<span class="fc" id="L2815">			return false;</span>
<span class="nc" id="L2816">		}</span>
<span class="nc" id="L2817">		return true;</span>
	}

	/**
	 * Funkcia podobna JS kodu setTimeout pre asynchronne spustenie ulohy (vid InitServlet volanie localconf.jsp)
	 * @param runnable
	 * @param delay
	 */
	public static void setTimeout(Runnable runnable, int delay){
<span class="fc" id="L2826">		new Thread(() -&gt; {</span>
			try {
<span class="fc" id="L2828">				Thread.sleep(delay);</span>
<span class="fc" id="L2829">				runnable.run();</span>
			}
<span class="nc" id="L2831">			catch (Exception e){</span>
<span class="nc" id="L2832">				Logger.error(Tools.class, e);</span>
<span class="fc" id="L2833">			}</span>
<span class="fc" id="L2834">		}).start();</span>
<span class="fc" id="L2835">	}</span>

	public static String prepositionsAppendNbsp(String text) {
<span class="nc" id="L2838">		String result = text;</span>
<span class="nc" id="L2839">		String[] prepositions = Tools.getTokens(Constants.getString(&quot;prepositions&quot;), &quot;,&quot;);</span>

<span class="nc bnc" id="L2841" title="All 2 branches missed.">		for (String preposition : prepositions) {</span>
<span class="nc" id="L2842">			preposition = preposition.trim();</span>
<span class="nc" id="L2843">			result = Tools.replace(result, &quot; &quot; + preposition + &quot; &quot;, &quot; &quot; + preposition + &quot;&amp;nbsp;&quot;);</span>
		}

<span class="nc" id="L2846">		return result;</span>
	}

	/**
	 * Odescapuje HTML kod, napr. z &amp;lt; spravi &lt;, je to potrebne napr. pri exporte do Excelu a podobne
	 * @param text
	 * @return
	 */
	public static String unescapeHtmlEntities(String text)
	{
<span class="nc" id="L2856">		String returnString = text;</span>
<span class="nc" id="L2857">		returnString = Tools.replace(returnString, &quot;&amp;lt;&quot;, &quot;&lt;&quot;);</span>
<span class="nc" id="L2858">		returnString = Tools.replace(returnString, &quot;&amp;gt;&quot;, &quot;&gt;&quot;);</span>
<span class="nc" id="L2859">		returnString = Tools.replace(returnString, &quot;&amp;amp;&quot;, &quot;&amp;&quot;);</span>
<span class="nc" id="L2860">		returnString = Tools.replace(returnString, &quot;&amp;quot;&quot;, &quot;\&quot;&quot;);</span>

<span class="nc" id="L2862">		return returnString;</span>
	}

	public static String escapeHtml(String text) {
<span class="fc bfc" id="L2866" title="All 2 branches covered.">		if(text != null) {</span>
//			return StringEscapeUtils.escapeHtml(text);
<span class="fc" id="L2868">			return ResponseUtils.filter(text).replace(&quot;&amp;amp;&quot;, &quot;&amp;&quot;);</span>
		} else {
<span class="fc" id="L2870">			return null;</span>
		}
	}

    public static String getJsonUnsafe(String json) {
<span class="fc" id="L2875">	    return json;</span>
    }

    /**
     * RequestParameterNames
     */

    /**
     *
     * @param request HttpServletRequest
     * @return unescaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNamesUnsafe(HttpServletRequest request) {
<span class="nc" id="L2888">        return getRequestParameterNames(request, false);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @return escaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNames(HttpServletRequest request) {
<span class="nc" id="L2897">        return getRequestParameterNames(request, true);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @param sanitize escape request parameter names if it's true
     * @return escaped/unescaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNames(HttpServletRequest request, boolean sanitize) {
<span class="nc" id="L2907">        Enumeration&lt;String&gt; e = request.getParameterNames();</span>

<span class="nc bnc" id="L2909" title="All 2 branches missed.">        if(sanitize) {</span>
<span class="nc" id="L2910">            List&lt;String&gt; names = Collections.list(e);</span>

<span class="nc bnc" id="L2912" title="All 2 branches missed.">            for(int i = 0; i &lt; names.size(); i++) {</span>
<span class="nc" id="L2913">                names.set(i, escapeHtml(names.get(i)));</span>
            }

<span class="nc" id="L2916">            e = Collections.enumeration(names);</span>
        }

<span class="nc" id="L2919">        return e;</span>
    }

    /**
     * RequestParameterValues
     */

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return escaped request parameter values
     */
	public static String[] getRequestParameterValues(HttpServletRequest request, String param) {
<span class="nc" id="L2933">		return getRequestParameterValues(request, param, true);</span>
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @param sanitize escape request parameter values if it's true
     * @return escaped/unescaped request parameter values
     */
	public static String[] getRequestParameterValues(HttpServletRequest request, String param, boolean sanitize) {
<span class="nc bnc" id="L2944" title="All 2 branches missed.">		if(sanitize) {</span>
<span class="nc" id="L2945">			String[] values = request.getParameterValues(param);</span>
<span class="nc bnc" id="L2946" title="All 2 branches missed.">			if (values == null) return null;</span>

<span class="nc bnc" id="L2948" title="All 2 branches missed.">			for(int i = 0; i &lt; values.length; i++) {</span>
<span class="nc" id="L2949">				values[i] = escapeHtml(values[i]);</span>
			}
<span class="nc" id="L2951">			return values;</span>
		} else {
<span class="nc" id="L2953">			return request.getParameterValues(param);</span>
		}
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return unescaped request parameter values
     */
	public static String[] getRequestParameterValuesUnsafe(HttpServletRequest request, String param) {
<span class="nc" id="L2964">		return getRequestParameterValues(request, param, false);</span>
	}

    /**
     * RequestParameter
     */

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return escaped request parameter value
     */
	public static String getRequestParameter(HttpServletRequest request, String param) {
<span class="fc" id="L2978">		return getRequestParameter(request, param, true);</span>
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @@return unescaped request parameter value
     */
    public static String getRequestParameterUnsafe(HttpServletRequest request, String param) {
<span class="fc" id="L2988">        return getRequestParameter(request, param, false);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @param sanitize escape request parameter value if it's true
     * @return escaped/unescaped request parameter value
     */
	public static String getRequestParameter(HttpServletRequest request, String param, boolean sanitize) {
<span class="fc bfc" id="L2999" title="All 2 branches covered.">		if(sanitize) {</span>
<span class="fc" id="L3000">			return escapeHtml(request.getParameter(param));</span>
		} else {
<span class="fc" id="L3002">			return request.getParameter(param);</span>
		}
	}

	/**
	 *
	 * @param out JspWriter
	 * @param json JSONArray with news
	 * @param callback name of callback you want to call with json as a parameter
	 * @throws JSONException
	 * @throws IOException
	 */
	public static void printJSON(JspWriter out, JSONArray json, String callback) throws JSONException, IOException {
<span class="pc bpc" id="L3015" title="1 of 2 branches missed.">		if (callback == null) {</span>
<span class="fc" id="L3016">			out.println(Tools.getJsonUnsafe(json.toString(4)));</span>
		} else {
<span class="nc" id="L3018">			out.println(callback + &quot;(&quot; + Tools.getJsonUnsafe(json.toString(4)) + &quot;);&quot;);</span>
		}
<span class="fc" id="L3020">	}</span>

    /**
     *
     * @param out JspWriter
     * @param json JSONArray with news
     * @throws JSONException
     * @throws IOException
     */
    public static void printJSON(JspWriter out, JSONArray json) throws JSONException, IOException {
<span class="fc" id="L3030">        printJSON(out, json, null);</span>
<span class="fc" id="L3031">    }</span>

    public static String getRequestURI(HttpServletRequest request) {
<span class="fc" id="L3034">        return Tools.escapeHtml(request.getRequestURI());</span>
    }

    public static String getRequestQueryString(HttpServletRequest request) {
<span class="nc" id="L3038">        return Tools.escapeHtml(request.getQueryString());</span>
    }

	public static Calendar nextWorkingDay(Calendar calendar) {
		do {
<span class="nc" id="L3043">			calendar.add(Calendar.DAY_OF_YEAR , 1);</span>
<span class="nc bnc" id="L3044" title="All 2 branches missed.">		} while (!isWorkingDay(calendar));</span>
<span class="nc" id="L3045">		return calendar;</span>
	}

	public static boolean isWorkingDay(Calendar cal) {
<span class="nc bnc" id="L3049" title="All 4 branches missed.">		if (cal.get(Calendar.DAY_OF_WEEK) == Calendar.SATURDAY || cal.get(Calendar.DAY_OF_WEEK) == Calendar.SUNDAY) {</span>
<span class="nc" id="L3050">			return false;</span>
		}
<span class="nc" id="L3052">		int result = new SimpleQuery().forInt(&quot;SELECT holiday_id FROM holidays WHERE hday=? AND hmonth = ? AND (hyear = ? OR hyear is NULL or hyear = '')&quot;, cal.get(Calendar.DAY_OF_MONTH), cal.get(Calendar.MONTH)+1, cal.get(Calendar.YEAR));</span>
<span class="nc bnc" id="L3053" title="All 2 branches missed.">		if (result &gt; 0)</span>
<span class="nc" id="L3054">			return false;</span>
<span class="nc" id="L3055">		return true;</span>
	}

	public static String trim(String value) {
<span class="pc bpc" id="L3059" title="1 of 2 branches missed.">		if (value == null) return value;</span>

<span class="fc" id="L3061">		return value.trim();</span>
	}

	/**
	 * Returns toString value of StringBuilder OR null if StringBuilder is NULL
	 * @param builder
	 * @return
	 */
	public static String toString(StringBuilder builder) {
<span class="pc bpc" id="L3070" title="1 of 2 branches missed.">		if (builder == null) return null;</span>
<span class="nc" id="L3071">		return builder.toString();</span>
	}

	/**
	 * @deprecated use DomainRedirectDB.getDomainFromAlias
	 * @param aliasedDomainName
	 * @return
	 */
	@Deprecated
	public static String getDomainFromAlias(String aliasedDomainName) {
<span class="nc" id="L3081">		return DomainRedirectDB.getDomainFromAlias(aliasedDomainName);</span>
	}

	/**
	 * Returns Spring ApplicationContext to access spring beans from not spring classes
	 * @return
	 */
	public static ApplicationContext getSpringContext() {
<span class="fc" id="L3089">		RequestBean requestBean = SetCharacterEncodingFilter.getCurrentRequestBean();</span>
		ApplicationContext context;
<span class="pc bpc" id="L3091" title="1 of 2 branches missed.">      	if (requestBean == null) context = (ApplicationContext) Constants.getServletContext().getAttribute(&quot;springContext&quot;);</span>
<span class="fc" id="L3092">		else context = requestBean.getSpringContext();</span>

<span class="fc" id="L3094">		return context;</span>
	}

	/**
	 * Returns Spring Bean, you can get the SpringBean from not spring classes
	 * @param &lt;T&gt;
	 * @param name
	 * @param clazz
	 * @return
	 */
	public static &lt;T&gt; T getSpringBean(String name, Class&lt;T&gt; clazz) {
<span class="fc" id="L3105">		ApplicationContext springContext = getSpringContext();</span>
<span class="pc bpc" id="L3106" title="2 of 4 branches missed.">        if (springContext == null || !springContext.containsBean(name)) {</span>
<span class="nc" id="L3107">            return null;</span>
        }

<span class="fc" id="L3110">        return springContext.getBean(name, clazz);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>