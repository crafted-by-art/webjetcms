<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DB.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjet8v9</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm</a> &gt; <span class="el_source">DB.java</span></div><h1>DB.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm;

import java.io.Writer;
import java.math.BigDecimal;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Date;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.StringTokenizer;

import org.apache.commons.beanutils.DynaBean;
import org.apache.commons.beanutils.RowSetDynaClass;
import org.apache.commons.dbcp.DelegatingConnection;
import org.apache.struts.util.ResponseUtils;

import oracle.jdbc.driver.OracleConnection;
import oracle.sql.CLOB;
import sk.iway.iwcm.common.CloudToolsForCore;
import sk.iway.iwcm.database.SimpleQuery;
import sk.iway.iwcm.doc.GroupDetails;
import sk.iway.iwcm.doc.GroupsDB;

/**
 *  nadtrieda DB tried, ma zakladne uzitocne funkcie
 *
 *@Title        Interway Content Management
 *@Company      Interway s.r.o. (www.interway.sk)
 *@Copyright    Interway s.r.o. (c) 2001-2002
 *@author       $Author: jeeff $
 *@version      $Revision: 1.14 $
 *@created      $Date: 2004/03/23 20:50:49 $
 *@modified     $Date: 2004/03/23 20:50:49 $
 */
@SuppressWarnings({&quot;deprecation&quot;, &quot;java:S1118&quot;})
<span class="fc" id="L44">public class DB</span>
{
	//zoznam stlpcov ktore mozu obsahovat HTML kod
<span class="fc" id="L47">	private static Set&lt;String&gt; htmlAllowedFields = null;</span>

	/**
	 * Overi, ci je mozne v danom DB stlpci pouzit HTML kod, ak nie, tak sa pri citani rovno escapnu specialne znaky
	 * ako &lt; alebo &gt; aby nebolo mozne vykonat XSS utok
	 * https://thoughts-on-java.org/jpa-21-how-to-implement-type-converter/
	 * @param fieldName
	 * @return
	 */
	public static boolean isHtmlAllowed(String fieldName)
	{
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">		if (fieldName==null) return false;</span>
<span class="fc bfc" id="L59" title="All 2 branches covered.">		if (fieldName.contains(&quot;html&quot;)) return true;</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">		if (fieldName.contains(&quot;data&quot;)) return true;</span>
		//fotogaleria
<span class="fc bfc" id="L62" title="All 2 branches covered.">		if (fieldName.contains(&quot;_description_&quot;)) return true;</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">		if (fieldName.startsWith(&quot;field_&quot;)) return true;</span>

<span class="fc bfc" id="L65" title="All 2 branches covered.">		if (htmlAllowedFields == null)</span>
		{
			//systemove stlpce
<span class="fc" id="L68">			String[] fields = Tools.getTokens(Constants.getString(&quot;xssHtmlAllowedFieldsSystem&quot;), &quot;,&quot;, true);</span>
<span class="fc" id="L69">			Set&lt;String&gt; fieldsSet = new HashSet&lt;&gt;(Arrays.asList(fields));</span>
			//zakaznicke stlpce
<span class="fc" id="L71">			fields = Tools.getTokens(Constants.getString(&quot;xssHtmlAllowedFields&quot;), &quot;,&quot;, true);</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">			for (String field : fields) {</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">				if (fieldsSet.contains(field)) continue;</span>
<span class="nc" id="L74">				fieldsSet.add(field);</span>
			}
<span class="fc" id="L76">			htmlAllowedFields = fieldsSet;</span>
		}

<span class="fc bfc" id="L79" title="All 2 branches covered.">		if (htmlAllowedFields.contains(fieldName)) return true;</span>

<span class="fc" id="L81">		return false;</span>
	}

	public static void resetHtmlAllowedFields()
	{
<span class="fc" id="L86">		htmlAllowedFields = null;</span>
<span class="fc" id="L87">	}</span>


	/**
	 * vrati prekodovany a trimnuty string z result setu (povodne sa pouzivalo kvoli Oracle), ak je filter true vykona aj ResponseUtils.filter
	 * @param db_result
	 * @param fieldName
	 * @param filter
	 * @return
	 * @throws SQLException
	 */
	public static String getDbString(java.sql.ResultSet db_result, String fieldName, boolean filter) throws SQLException
	{
<span class="fc" id="L100">		String ret = getDbStringImpl(db_result, fieldName);</span>

<span class="pc bpc" id="L102" title="1 of 2 branches missed.">		if (filter) return filterHtml(ret);</span>

<span class="fc" id="L104">		return ret;</span>
	}

	/**
	 *  vrati prekodovany a trimnuty string z result setu (povodne sa pouzivalo kvoli Oracle)
	 *
	 *@param  db_result      result set
	 *@param  fieldName      meno fieldu v databaze
	 *@return                prekodovany a trimnuty string
	 *@exception  Exception  Description of the Exception
	 */
	public static String getDbString(java.sql.ResultSet db_result, String fieldName) throws SQLException
	{
<span class="fc" id="L117">		String data = null;</span>

<span class="fc" id="L119">		data = getDbStringImpl(db_result, fieldName);</span>

<span class="fc bfc" id="L121" title="All 2 branches covered.">		if (isHtmlAllowed(fieldName)==false)</span>
		{
<span class="pc bpc" id="L123" title="1 of 4 branches missed.">			if (data.contains(&quot;&lt;&quot;) || data.contains(&quot;&gt;&quot;))</span>
			{
<span class="fc" id="L125">				data = filterHtml(data);</span>
			}
		}

		//ak su sifrovane skus desifrovat
<span class="fc" id="L130">		data = CryptoFactory.decrypt(data);</span>
<span class="fc" id="L131">		return (data);</span>
	}

	/**
	 * Nahradi nebezpecne HTML znaky za entity
	 * @param data
	 * @return
	 */
	public static String filterHtml(String data)
	{
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">		if (data == null) return null;</span>

<span class="fc bfc" id="L143" title="All 4 branches covered.">		if (data.contains(&quot;&lt;&quot;) || data.contains(&quot;&gt;&quot;))</span>
		{
<span class="fc" id="L145">			return ResponseUtils.filter(data);</span>
		}
<span class="fc" id="L147">		return data;</span>
	}

	private static String getDbStringImpl(java.sql.ResultSet db_result, String fieldName) throws SQLException
	{
<span class="fc" id="L152">		String data = null;</span>

<span class="fc" id="L154">		data = db_result.getString(fieldName);</span>

<span class="fc bfc" id="L156" title="All 4 branches covered.">		if (data != null &amp;&amp; data.length()&gt;0)</span>
		{
			//ochrana pred vykonanim prikazu v Exceli
<span class="fc bfc" id="L159" title="All 2 branches covered.">			if (data.length()&gt;5)</span>
			{
<span class="fc" id="L161">				String retLC = data.substring(0, 4).toLowerCase();</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">				if (retLC.toLowerCase().startsWith(&quot;=cmd&quot;)) data = &quot;-&quot; + data.substring(1);</span>
			}

<span class="fc" id="L165">			return (data.trim());</span>
		}
		else
		{
<span class="fc" id="L169">			return (&quot;&quot;);</span>
		}
	}

	/**
	 * Vrati long hodnotu Timestampu (ak nie je null), inak vrati 0
	 * @param rs
	 * @param fieldName
	 * @return
	 * @throws Exception
	 */
	public static long getDbTimestamp(java.sql.ResultSet rs, String fieldName)
	{
		try
		{
<span class="fc" id="L184">			java.sql.Timestamp data = rs.getTimestamp(fieldName);</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">			if (data != null)</span>
			{
<span class="fc" id="L187">				return (data.getTime());</span>
			}
		}
<span class="nc" id="L190">		catch (SQLException ex)</span>
		{

<span class="fc" id="L193">		}</span>
<span class="fc" id="L194">		return (0);</span>
	}

	public static Timestamp getDbTimestamp(long time)
	{
<span class="fc bfc" id="L199" title="All 2 branches covered.">		if (time == 0)</span>
		{
<span class="fc" id="L201">			return(null);</span>
		}
<span class="fc" id="L203">		return(new Timestamp(time));</span>
	}

	/**
	 *  vrati naformatovany datum z databazy
	 *
	 *@param  db_result      result set
	 *@param  fieldName      meno fieldu v databaze
	 *@return                naformatovany datum z databazy
	 *@exception  Exception  Description of the Exception
	 */
	public static String getDbDate(java.sql.ResultSet db_result, String fieldName) throws SQLException
	{
		try
		{
<span class="fc bfc" id="L218" title="All 2 branches covered.">			if (db_result.getDate(fieldName) != null)</span>
			{
<span class="fc" id="L220">				java.sql.Date dbDate = db_result.getDate(fieldName);</span>
<span class="fc" id="L221">				java.text.SimpleDateFormat formatter = new java.text.SimpleDateFormat(Constants.getString(&quot;dateFormat&quot;));</span>
<span class="fc" id="L222">				return (formatter.format(dbDate));</span>
			}
		}
<span class="nc" id="L225">		catch (Exception ex)</span>
		{
<span class="nc" id="L227">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L228">		}</span>
<span class="fc" id="L229">		return(&quot;&quot;);</span>
	}

	public static Date getDate(java.sql.ResultSet db_result, String fieldName) throws SQLException
	{
		try
		{
<span class="fc bfc" id="L236" title="All 2 branches covered.">			if (db_result.getDate(fieldName) != null)</span>
			{
<span class="fc" id="L238">				return new Date(db_result.getTimestamp(fieldName).getTime());</span>
			}
		}
<span class="nc" id="L241">		catch (Exception ex)</span>
		{
<span class="nc" id="L243">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L244">		}</span>
<span class="fc" id="L245">		return null;</span>
	}

	/**
	 *  vrati naformatovany cas z databazy
	 *
	 *@param  db_result      result set
	 *@param  fieldName      meno fieldu v databaze
	 *@return                naformatovany cas z databazy
	 *@exception  Exception  Description of the Exception
	 */
	public static String getDbTime(java.sql.ResultSet db_result, String fieldName) throws Exception
	{
<span class="nc bnc" id="L258" title="All 2 branches missed.">		if (db_result.getDate(fieldName) != null)</span>
		{
<span class="nc" id="L260">			java.sql.Timestamp dbDate = db_result.getTimestamp(fieldName);</span>
<span class="nc" id="L261">			java.text.SimpleDateFormat formatter = new java.text.SimpleDateFormat(Constants.getString(&quot;timeFormat&quot;));</span>
<span class="nc" id="L262">			return (formatter.format(dbDate));</span>
		}
		else
		{
<span class="nc" id="L266">			return (&quot;&quot;);</span>
		}
	}

	/**
	 *  Gets the dbDateTime attribute of the DB class
	 *
	 *@param  db_result      Description of the Parameter
	 *@param  fieldName      Description of the Parameter
	 *@return                The dbDateTime value
	 *@exception  Exception  Description of the Exception
	 */
	public static String getDbDateTime(java.sql.ResultSet db_result, String fieldName) throws SQLException
	{
<span class="fc" id="L280">		return (getDbDateTime(db_result, fieldName, &quot;iwcm&quot;));</span>
	}

	/**
	 *  Gets the dbDateTime attribute of the DB class
	 *
	 *@param  db_result      Description of the Parameter
	 *@param  fieldName      Description of the Parameter
	 *@param  serverName     Description of the Parameter
	 *@return                The dbDateTime value
	 *@exception  Exception  Description of the Exception
	 */
	public static String getDbDateTime(java.sql.ResultSet db_result, String fieldName, String serverName) throws SQLException
	{
<span class="fc" id="L294">		String ret = &quot;&quot;;</span>

		try
		{
<span class="fc bfc" id="L298" title="All 2 branches covered.">			if (db_result.getTimestamp(fieldName) != null)</span>
			{
<span class="fc" id="L300">				java.sql.Timestamp dbDate = db_result.getTimestamp(fieldName);</span>
<span class="fc" id="L301">				java.text.SimpleDateFormat formatter = new java.text.SimpleDateFormat(Constants.getString(&quot;dateTimeFormat&quot;));</span>
<span class="fc" id="L302">				ret =  formatter.format(dbDate);</span>
			}
		}
<span class="nc" id="L305">		catch (SQLException ex)</span>
		{
<span class="nc" id="L307">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L308">		}</span>
<span class="fc" id="L309">		return (ret);</span>
	}


	public static long getTimestamp(String date, String time, String serverName)
	{
<span class="nc" id="L315">		return(getTimestamp(date, time));</span>
	}

	public static long getTimestamp(String dateTime)
	{
<span class="fc" id="L320">		long timestamp = 0;</span>
		try
		{
<span class="fc bfc" id="L323" title="All 2 branches covered.">			if (Tools.isNotEmpty(dateTime))</span>
			{
				//ak je datum vo formate 1. 5. 2005 14:30
<span class="fc" id="L326">				dateTime = Tools.replace(dateTime, &quot;. &quot;, &quot;.&quot;);</span>

				//ak je to zadane ako 26112009 uprav na lepsi format
<span class="pc bpc" id="L329" title="1 of 4 branches missed.">				if (dateTime.length()==8 &amp;&amp; dateTime.indexOf('.')==-1)</span>
				{
<span class="nc" id="L331">					dateTime = dateTime.substring(0, 2)+&quot;.&quot;+dateTime.substring(2,4)+&quot;.&quot;+dateTime.substring(4);</span>
				}

<span class="fc" id="L334">				StringTokenizer st = new StringTokenizer(dateTime);</span>
<span class="pc bpc" id="L335" title="2 of 4 branches missed.">				if(st.hasMoreTokens() &amp;&amp; st.countTokens() == 4)</span>
				{
<span class="nc" id="L337">					timestamp = DB.getTimestamp(st.nextToken()+&quot;.&quot;+st.nextToken()+&quot;.&quot;+st.nextToken(), st.nextToken());</span>
				}
<span class="pc bpc" id="L339" title="2 of 4 branches missed.">				else if(st.hasMoreTokens() &amp;&amp; st.countTokens() == 3)</span>
				{
<span class="nc" id="L341">					timestamp = DB.getTimestamp(st.nextToken()+&quot;.&quot;+st.nextToken()+&quot;.&quot;+st.nextToken(), &quot;0:00&quot;);</span>
				}
<span class="pc bpc" id="L343" title="1 of 4 branches missed.">				else if(st.hasMoreTokens() &amp;&amp; st.countTokens() == 2)</span>
				{
<span class="fc" id="L345">					timestamp = DB.getTimestamp(st.nextToken(), st.nextToken());</span>
				}
<span class="pc bpc" id="L347" title="2 of 4 branches missed.">				else if (st.hasMoreTokens() &amp;&amp; st.countTokens() == 1)</span>
				{
<span class="fc" id="L349">					timestamp = DB.getTimestamp(st.nextToken(), &quot;0:00&quot;);</span>
				}


				//Calendar cal = Calendar.getInstance();
				//cal.setTimeInMillis(timestamp);
				//Logger.println(this,&quot;Timestamp: &quot; +cal.getTime());
			}
		}
<span class="nc" id="L358">		catch (Exception ex)</span>
		{
<span class="nc" id="L360">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L361">		}</span>
<span class="fc" id="L362">		return timestamp;</span>
	}


	/**
	 *  return sql timestamp from given date and time
	 *
	 *@param  date        datum
	 *@param  time        cas
	 *@return             The timestamp value
	 */
	public static long getTimestamp(String date, String time)
	{
<span class="fc bfc" id="L375" title="All 2 branches covered.">		if (Tools.isEmpty(date))</span>
		{
<span class="fc" id="L377">			return (0);</span>
		}

<span class="pc bpc" id="L380" title="1 of 2 branches missed.">		if (Tools.isEmpty(time))</span>
		{
<span class="nc" id="L382">			time = &quot;00:00:00&quot;;</span>
		}

<span class="fc" id="L385">		Calendar tmpCalendar = Calendar.getInstance();</span>
<span class="fc" id="L386">		tmpCalendar.clear();</span>
		int day;
		int month;
		int year;
		int hour;
		int minute;
		int second;

		//try to parse date
<span class="fc" id="L395">		date = date.trim();</span>
<span class="fc" id="L396">		date = date.replace('/', '.');</span>
<span class="fc" id="L397">		date = date.replace(' ', '.');</span>
<span class="fc" id="L398">		date = date.replace('-', '.');</span>
<span class="fc" id="L399">		date = date.replace(',', '.');</span>

		//ak je to zadane ako 26112009 uprav na lepsi format
<span class="pc bpc" id="L402" title="1 of 4 branches missed.">		if (date.length()==8 &amp;&amp; date.indexOf('.')==-1)</span>
		{
<span class="nc" id="L404">			date = date.substring(0, 2)+&quot;.&quot;+date.substring(2,4)+&quot;.&quot;+date.substring(4);</span>
		}

<span class="fc" id="L407">		boolean usFormat = false;</span>
<span class="pc bpc" id="L408" title="1 of 2 branches missed.">		if (Constants.getString(&quot;dateFormat&quot;).equalsIgnoreCase(&quot;mm-dd-yyyy&quot;))</span>
		{
<span class="nc" id="L410">			usFormat = true;</span>
		}

<span class="fc" id="L413">		StringTokenizer st = new StringTokenizer(date, &quot;.&quot;);</span>
<span class="pc bpc" id="L414" title="1 of 2 branches missed.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L418">				day = Integer.parseInt(st.nextToken());</span>
<span class="pc bpc" id="L419" title="1 of 2 branches missed.">				if (usFormat)</span>
				{
<span class="nc" id="L421">					tmpCalendar.set(Calendar.MONTH, day - 1);</span>
				}
				else
				{
<span class="fc" id="L425">					tmpCalendar.set(Calendar.DAY_OF_MONTH, day);</span>
				}
			}
<span class="fc" id="L428">			catch (Exception ex)</span>
			{
<span class="fc" id="L430">			}</span>
		}
<span class="fc bfc" id="L432" title="All 2 branches covered.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L436">				month = Integer.parseInt(st.nextToken());</span>
<span class="pc bpc" id="L437" title="1 of 2 branches missed.">				if (usFormat)</span>
				{
<span class="nc" id="L439">					tmpCalendar.set(Calendar.DAY_OF_MONTH, month);</span>
				}
				else
				{
					//if you dont know why, RTFM
<span class="fc" id="L444">					month = month - 1;</span>
<span class="fc" id="L445">					tmpCalendar.set(Calendar.MONTH, month);</span>
				}
			}
<span class="nc" id="L448">			catch (Exception ex)</span>
			{
<span class="fc" id="L450">			}</span>
		}
<span class="fc bfc" id="L452" title="All 2 branches covered.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L456">				year = Integer.parseInt(st.nextToken());</span>
<span class="pc bpc" id="L457" title="1 of 2 branches missed.">				if (year &lt; 20)</span>
				{
<span class="nc" id="L459">					year = 2000 + year;</span>
				}
<span class="fc" id="L461">				tmpCalendar.set(Calendar.YEAR, year);</span>
			}
<span class="nc" id="L463">			catch (Exception ex)</span>
			{
<span class="fc" id="L465">			}</span>
		}

<span class="fc" id="L468">		time = time.trim();</span>
<span class="pc bpc" id="L469" title="1 of 2 branches missed.">		if (time.length() &lt; 3)</span>
		{
<span class="nc" id="L471">			time = &quot;00:00:00&quot;;</span>
		}
<span class="fc" id="L473">		time = time.replace('.', ':');</span>
<span class="fc" id="L474">		time = time.replace(',', ':');</span>
<span class="fc" id="L475">		time = time.replace(' ', ':');</span>
<span class="fc" id="L476">		time = time.replace('-', ':');</span>

<span class="fc" id="L478">		st = new StringTokenizer(time, &quot;:&quot;);</span>
<span class="pc bpc" id="L479" title="1 of 2 branches missed.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L483">				hour = Integer.parseInt(st.nextToken());</span>
<span class="fc" id="L484">				tmpCalendar.set(Calendar.HOUR_OF_DAY, hour);</span>
			}
<span class="nc" id="L486">			catch (Exception ex)</span>
			{
<span class="fc" id="L488">			}</span>
		}
<span class="pc bpc" id="L490" title="1 of 2 branches missed.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L494">				minute = Integer.parseInt(st.nextToken());</span>
<span class="fc" id="L495">				tmpCalendar.set(Calendar.MINUTE, minute);</span>
<span class="fc bfc" id="L496" title="All 2 branches covered.">				if (minute &gt; 30)</span>
				{
<span class="fc" id="L498">					tmpCalendar.set(Calendar.SECOND, 59);</span>
<span class="fc" id="L499">					tmpCalendar.set(Calendar.MILLISECOND, 999);</span>
				}
				else
				{
<span class="fc" id="L503">					tmpCalendar.set(Calendar.SECOND, 0);</span>
<span class="fc" id="L504">					tmpCalendar.set(Calendar.MILLISECOND, 0);</span>
				}
			}
<span class="nc" id="L507">			catch (Exception ex)</span>
			{
<span class="fc" id="L509">			}</span>
		}
<span class="fc bfc" id="L511" title="All 2 branches covered.">		if (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L515">				second = Integer.parseInt(st.nextToken());</span>
<span class="fc" id="L516">				tmpCalendar.set(Calendar.SECOND, second);</span>
<span class="fc bfc" id="L517" title="All 2 branches covered.">				if (second &gt; 30)</span>
				{
<span class="fc" id="L519">					tmpCalendar.set(Calendar.MILLISECOND, 999);</span>
				}
				else
				{
<span class="fc" id="L523">					tmpCalendar.set(Calendar.MILLISECOND, 0);</span>
				}
			}
<span class="nc" id="L526">			catch (Exception ex)</span>
			{
<span class="pc" id="L528">			}</span>
		}
		else
		{
<span class="fc" id="L532">			tmpCalendar.set(Calendar.SECOND, 0);</span>
		}
<span class="fc" id="L534">		tmpCalendar.set(Calendar.MILLISECOND, 0);</span>
<span class="fc" id="L535">		return (tmpCalendar.getTime().getTime());</span>
	}

	private static final String TAB00C0 =
			&quot;AAAAAAACEEEEIIII&quot; +
					&quot;DNOOOOO\u00d7\u00d8UUUUYI\u00df&quot; +
					&quot;aaaaaaaceeeeiiii&quot; +
					&quot;\u00f0nooooo\u00f7\u00f8uuuuy\u00fey&quot; +
					&quot;AaAaAaCcCcCcCcDd&quot; +
					&quot;DdEeEeEeEeEeGgGg&quot; +
					&quot;GgGgHhHhIiIiIiIi&quot; +
					&quot;IiJjJjKkkLlLlLlL&quot; +
					&quot;lLlNnNnNnnNnOoOo&quot; +
					&quot;OoOoRrRrRrSsSsSs&quot; +
					&quot;SsTtTtTtUuUuUuUu&quot; +
					&quot;UuUuWwYyYZzZzZzF&quot;;
<span class="fc" id="L551">	private static final String[] TAB00C1 = &quot;A,B,V,G,D,E,Zh,Z,I,J,K,L,M,N,O,P,R,S,T,U,F,H,C,Ch,Sh,Shh,\&quot;\&quot;,Y,'',Je,Ju,Ja,a,b,v,g,d,e,zh,z,i,j,k,l,m,n,o,p,r,s,t,u,f,h,c,ch,sh,shh,\&quot;,y,',je,ju,ja,eh,jo&quot;.split(&quot;,&quot;);</span>

	/**
	 *  prekoduje diakritiku a azbuku do cisteho ascii
	 *
	 *@param  source  Description of the Parameter
	 *@return         Description of the Return Value
	 */
	public static String internationalToEnglish(String source)
	{
<span class="pc bpc" id="L561" title="1 of 2 branches missed.">		if (source == null)</span>
		{
			//pozor, toto sa casto pouziva, nesmie to vratit null
<span class="nc" id="L564">			return (&quot;&quot;);</span>
		}

<span class="fc" id="L567">		char[] vysl = new char[source.length()*2];</span>
		char one;
<span class="fc" id="L569">		int k = 0;</span>
<span class="fc bfc" id="L570" title="All 2 branches covered.">		for (int i = 0; i &lt; source.length(); i++)</span>
		{
<span class="fc" id="L572">			one = source.charAt(i);</span>
<span class="fc bfc" id="L573" title="All 6 branches covered.">			if (one &gt;= '\u00c0' &amp; one &lt;= '\u017f') //NOSONAR</span>
			{
<span class="fc" id="L575">				one = TAB00C0.charAt(one - '\u00c0');</span>
			}
<span class="pc bpc" id="L577" title="1 of 6 branches missed.">			if(one &gt;= '\u0410' &amp; one &lt;= '\u0451') //NOSONAR azbuka</span>
			{
<span class="nc" id="L579">				String tmp = TAB00C1[(one - '\u0410')];</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">				for (int j = 0; j &lt; tmp.length(); j++)</span>
				{
<span class="nc" id="L582">					vysl[k++] = tmp.charAt(j);</span>
				}
<span class="nc" id="L584">				continue;</span>
			}
<span class="fc" id="L586">			vysl[k++] = one;</span>
		}
<span class="fc" id="L588">		return new String(vysl).trim();</span>
	}

	/**
	 * Replace stringu na string
	 *
	 * @param src    zdrojovy string
	 * @param oldStr co sa ma nahradit
	 * @param newStr za co sa ma nahradit
	 * @return string src v ktorom je nahradene oldStr za newStr
	 * @deprecated replaced by {@link Tools#replace(String, String, String)}
	 */
	@Deprecated
	public static String replace(String src, String oldStr, String newStr)
	{
<span class="fc" id="L603">		return(Tools.replace(src, oldStr, newStr));</span>
	}

	/**
	 *  nastavi pole text, alebo clob v preparedStatemente
	 *
	 *@param  ps             The new clob value
	 *@param  pos            The new clob value
	 *@param  data           The new clob value
	 *@exception  Exception  Description of the Exception
	 */
	public static void setClob(java.sql.PreparedStatement ps, int pos, String data) throws Exception
	{
<span class="pc bpc" id="L616" title="1 of 2 branches missed.">		if (Constants.DB_TYPE == Constants.DB_ORACLE)</span>
		{
			//ps.setString(pos, &quot;&amp;nbsp;&quot;);
<span class="nc bnc" id="L619" title="All 2 branches missed.">			if(data!=null)</span>
			{

				try
				{
<span class="nc" id="L624">					Connection db_conn = ps.getConnection();</span>

<span class="nc" id="L626">					Connection nativeConn = null;</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">					if (db_conn instanceof DelegatingConnection)</span>
					{
<span class="nc" id="L629">						nativeConn = ((DelegatingConnection)db_conn).getInnermostDelegate();</span>
					}
<span class="nc bnc" id="L631" title="All 2 branches missed.">					else if (db_conn instanceof OracleConnection)</span>
					{
<span class="nc" id="L633">						nativeConn = db_conn;</span>
					}
					//toto treba pre JBoss odkomentovat, ja v libkach nemam WrappedConnection
				   /*
				   else if (db_conn instanceof WrappedConnection)
				   {
					nativeConn = ((WrappedConnection)db_conn).getUnderlyingConnection();
				   }
				   */
<span class="nc bnc" id="L642" title="All 2 branches missed.">					if (nativeConn != null)</span>
					{
<span class="nc" id="L644">						Connection nativeCon = ((DelegatingConnection) db_conn).getInnermostDelegate();</span>

<span class="nc" id="L646">						CLOB tempClob = CLOB.createTemporary(nativeCon, true, CLOB.DURATION_SESSION);</span>
						// Open the temporary CLOB in readwrite mode to enable writing
<span class="nc" id="L648">						tempClob.open(CLOB.MODE_READWRITE);</span>
						// Get the output stream to write
<span class="nc" id="L650">						Writer tempClobWriter = tempClob.getCharacterOutputStream();</span>
						// Write the data into the temporary CLOB
<span class="nc" id="L652">						tempClobWriter.write(data);</span>
						// Flush and close the stream
<span class="nc" id="L654">						tempClobWriter.flush();</span>
<span class="nc" id="L655">						tempClobWriter.close();</span>
						// Close the temporary CLOB
<span class="nc" id="L657">						tempClob.close();</span>
<span class="nc" id="L658">						ps.setObject(pos, tempClob);</span>
<span class="nc" id="L659">					}</span>
					else
					{
<span class="nc" id="L662">						ps.setString(pos, data);</span>
					}
				}
<span class="nc" id="L665">				catch (Exception e)</span>
				{
<span class="nc" id="L667">					sk.iway.iwcm.Logger.error(e);</span>
<span class="nc" id="L668">				}</span>

				//StringReader reader = new StringReader(data);
				//ps.setCharacterStream(pos, reader, data.length());
			}
			else
			{
<span class="nc" id="L675">				ps.setNull(pos, java.sql.Types.CLOB);</span>
			}

		}
		else
		{
<span class="fc" id="L681">			ps.setString(pos, data);</span>
		}
<span class="fc" id="L683">	}</span>

	/**
	 *  Nastavi hodnotu do Clobu (pre Oracle)
	 *
	 *@param  data           Description of the Parameter
	 *@param  rs             Description of the Parameter
	 *@param  index          Description of the Parameter
	 *@exception  Exception  Description of the Exception
	 */
	/*public static void fillClob(java.sql.ResultSet rs, int index, String data)
			 throws Exception
	{
		Logger.println(this,&quot;fill clob - rs: &quot; + rs);
		CLOB clob = ((oracle.jdbc.OracleResultSet) rs).getCLOB(index);
		Writer outstream = clob.getCharacterOutputStream();
		outstream.write(data);
		outstream.close();
	}*/

	/**
	 *  odstrani apostrofy zo stringu, treba volat vzdy, ked sa nejaky parameter dava priamo do SQL prikazu
	 *
	 *@param  sqlParam
	 *@return
	 */
	public static String removeSlashes(String sqlParam)
	{
<span class="pc bpc" id="L711" title="1 of 2 branches missed.">		if (sqlParam == null) return(sqlParam);</span>

<span class="fc" id="L713">		sqlParam = sqlParam.replace('\'', ' ');</span>
<span class="fc" id="L714">		return (sqlParam);</span>
	}

	/**
	 *  Produces a string representation of a complete result set
	 *
	 *@param  rs             The ResultSet to be displayed
	 *@return                The string representation
	 *@throws  SQLException  to indicate a problem with the ResultSet
	 */
	public static String dumpResultSet(ResultSet rs) throws SQLException
	{
<span class="nc" id="L726">		StringBuilder buf = new StringBuilder();</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">		if (rs != null)</span>
		{
<span class="nc" id="L729">			ResultSetMetaData rsmd = rs.getMetaData();</span>
<span class="nc" id="L730">			int columnCount = rsmd.getColumnCount() + 1;</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">			for (int i = 1; i &lt; columnCount; i++)</span>
			{
<span class="nc" id="L733">				buf.append(rsmd.getColumnLabel(i));</span>
<span class="nc" id="L734">				buf.append(&quot;  &quot;);</span>
			}
<span class="nc" id="L736">			buf.append(&quot;\n===========================================\n&quot;);</span>

<span class="nc bnc" id="L738" title="All 2 branches missed.">			while (rs.next())</span>
			{
<span class="nc bnc" id="L740" title="All 2 branches missed.">				for (int i = 1; i &lt; columnCount; i++)</span>
				{
<span class="nc" id="L742">					buf.append(rs.getObject(i));</span>
<span class="nc" id="L743">					buf.append(&quot;  &quot;);</span>
				}
<span class="nc" id="L745">				buf.append('\n');</span>
			}
		}
<span class="nc" id="L748">		return buf.toString();</span>
	}

	public static String getFullName(ResultSet rs) throws Exception
	{
<span class="fc" id="L753">		return(DB.getFullName(rs, &quot;u_title&quot;));</span>
	}

	/**
	 *  Gets the fullName attribute of the DB object
	 *
	 *@param  rs  Description of the Parameter
	 *@return     The fullName value
	 */
	public static String getFullName(ResultSet rs, String titleName) throws Exception
	{
<span class="fc" id="L764">		StringBuilder ret = new StringBuilder();</span>
<span class="fc" id="L765">		String title = getDbString(rs, titleName);</span>
<span class="fc" id="L766">		String firstName = getDbString(rs, &quot;first_name&quot;);</span>
<span class="fc" id="L767">		String lastName = getDbString(rs, &quot;last_name&quot;);</span>

<span class="pc bpc" id="L769" title="2 of 4 branches missed.">		if (title != null &amp;&amp; title.length()&gt;0)</span>
		{
<span class="nc" id="L771">			ret.append(title).append(' ');</span>
		}
<span class="pc bpc" id="L773" title="2 of 4 branches missed.">		if (firstName != null &amp;&amp; firstName.length()&gt;0)</span>
		{
<span class="fc" id="L775">			ret.append(firstName).append(' ');</span>
		}
<span class="pc bpc" id="L777" title="2 of 4 branches missed.">		if (lastName != null &amp;&amp; lastName.length()&gt;0)</span>
		{
<span class="fc" id="L779">			ret.append(lastName).append(' ');</span>
		}

<span class="fc" id="L782">		return(ret.toString().trim());</span>
	}

	/**
	 * Oreze s tak, aby nebol dlhsi ako maxLen
	 * @param s
	 * @param maxLen
	 * @return
	 */
	public static String prepareString(String s, int maxLen)
	{
<span class="fc bfc" id="L793" title="All 2 branches covered.">		if (s==null)</span>
		{
<span class="fc" id="L795">			return(s);</span>
		}

<span class="fc bfc" id="L798" title="All 2 branches covered.">		if (s.length() &gt; maxLen)</span>
		{
<span class="fc" id="L800">			s = s.substring(0, maxLen-1);</span>
		}

<span class="fc" id="L803">		return(s);</span>
	}

	/**
	 * Vrati List DynaBeanov pre zadane SQL
	 * @param sql - SQL prikaz
	 * @return
	 */
	public static List&lt;DynaBean&gt; getDynaList(String sql)
	{
<span class="nc" id="L813">		return(getDynaList(sql, null, null));</span>
	}

	public static List&lt;DynaBean&gt; getDynaList(String sql, List&lt;?&gt; params)
	{
<span class="nc" id="L818">		return getDynaList(sql, params, null);</span>
	}

	public static List&lt;DynaBean&gt; getDynaList(String sql, List&lt;?&gt; params, String dbName)
	{
		try
		{
<span class="nc" id="L825">			Logger.debug(DB.class, &quot;getting dynaList, query: &quot; + sql);</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">			Connection db_conn = Tools.isNotEmpty(dbName) ? DBPool.getConnection(dbName) : DBPool.getConnection();</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">			if (db_conn != null)</span>
				try
				{
<span class="nc" id="L830">					PreparedStatement ps = db_conn.prepareStatement(sql);</span>
					try
					{
<span class="nc bnc" id="L833" title="All 4 branches missed.">						if (params != null &amp;&amp; params.size()&gt;0)</span>
						{
<span class="nc" id="L835">							int size = params.size();</span>
							int i;
							Object o;
<span class="nc bnc" id="L838" title="All 2 branches missed.">							for (i=1; i&lt;=size; i++)</span>
							{
<span class="nc" id="L840">								o = params.get(i-1);</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">								if (o instanceof String)</span>
								{
<span class="nc" id="L843">									ps.setString(i, (String)o);</span>
								}
<span class="nc bnc" id="L845" title="All 2 branches missed.">								else if (o instanceof Integer)</span>
								{
<span class="nc" id="L847">									ps.setInt(i, ((Integer)o).intValue());</span>
								}
<span class="nc bnc" id="L849" title="All 2 branches missed.">								else if (o instanceof Double)</span>
								{
<span class="nc" id="L851">									ps.setDouble(i, ((Double)o).doubleValue());</span>
								}
<span class="nc bnc" id="L853" title="All 2 branches missed.">								else if (o instanceof Float)</span>
								{
<span class="nc" id="L855">									ps.setFloat(i, ((Float)o).floatValue());</span>
								}
<span class="nc bnc" id="L857" title="All 2 branches missed.">								else if (o instanceof Long)</span>
								{
<span class="nc" id="L859">									ps.setLong(i, ((Long)o).longValue());</span>
								}
<span class="nc bnc" id="L861" title="All 2 branches missed.">								else if (o instanceof Boolean)</span>
								{
<span class="nc" id="L863">									ps.setBoolean(i, ((Boolean)o).booleanValue());</span>
								}
<span class="nc bnc" id="L865" title="All 2 branches missed.">								else if (o instanceof Timestamp)</span>
								{
<span class="nc" id="L867">									ps.setTimestamp(i, (Timestamp)o);</span>
								}
<span class="nc bnc" id="L869" title="All 2 branches missed.">								else if (o instanceof java.sql.Date)</span>
								{
<span class="nc" id="L871">									ps.setDate(i, (java.sql.Date)o);</span>
								}
								else
								{
<span class="nc" id="L875">									ps.setObject(i, o);</span>
								}
							}
						}
<span class="nc" id="L879">						ResultSet rs = ps.executeQuery();</span>
						try
						{
<span class="nc" id="L882">							RowSetDynaClass rsdc = null;</span>
<span class="nc" id="L883">							rsdc=new IwcmRowSetDynaClass(rs);</span>
<span class="nc" id="L884">							Logger.debug(DB.class, &quot;dynaBenas found: &quot; + rsdc.getRows().size());</span>
<span class="nc" id="L885">							return rsdc.getRows();</span>
						}
<span class="nc" id="L887">						finally { rs.close(); }</span>
					}
<span class="nc" id="L889">					finally { ps.close(); }</span>
				}
<span class="nc" id="L891">				finally { db_conn.close(); }</span>
		}
<span class="nc" id="L893">		catch (Exception ex)</span>
		{
<span class="nc" id="L895">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L896">		}</span>
<span class="nc" id="L897">		return(new ArrayList&lt;DynaBean&gt;());</span>
	}

	public static int getIntValue(Object o, int defaultValue)
	{
<span class="nc" id="L902">		int ret = defaultValue;</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">		if (o instanceof Integer)</span>
		{
<span class="nc" id="L905">			ret = ((Integer)o).intValue();</span>
		}
<span class="nc bnc" id="L907" title="All 2 branches missed.">		else if (o instanceof Long)</span>
		{
<span class="nc" id="L909">			ret = (int)((Long)o).longValue();</span>
		}

<span class="nc" id="L912">		return(ret);</span>
	}

	public static long getLongValue(Object o, long defaultValue)
	{
<span class="nc" id="L917">		long ret = defaultValue;</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">		if (o instanceof Integer)</span>
		{
<span class="nc" id="L920">			ret = ((Integer)o).intValue();</span>
		}
<span class="nc bnc" id="L922" title="All 2 branches missed.">		else if (o instanceof Long)</span>
		{
<span class="nc" id="L924">			ret = ((Long)o).longValue();</span>
		}

<span class="nc" id="L927">		return(ret);</span>
	}


	public static void execute(String sql, Object... arguments)
	{
<span class="fc" id="L933">		new SimpleQuery().execute(sql, arguments);</span>
<span class="fc" id="L934">	}</span>

	public static int queryForInt(String sql, Object... parameters)
	{
<span class="fc" id="L938">		return new SimpleQuery().forInt(sql, parameters);</span>
	}

	public static long queryForLong(String sql, Object... parameters)
	{
<span class="nc" id="L943">		return new SimpleQuery().forLong(sql, parameters);</span>
	}

	public static String queryForString(String sql, Object... parameters)
	{
<span class="nc" id="L948">		return new SimpleQuery().forString(sql, parameters);</span>
	}

	public static double queryForDouble(String sql, Object... parameters)
	{
<span class="nc" id="L953">		return new SimpleQuery().forDouble(sql, parameters);</span>
	}

	public static BigDecimal queryForBigDecimal(String sql, Object...parameters)
	{
<span class="nc" id="L958">		return new SimpleQuery().forBigDecimal(sql, parameters);</span>
	}

	@SuppressWarnings(&quot;rawtypes&quot;)
	public static List queryForList(String sql, Object... parameters)
	{
<span class="fc" id="L964">		return new SimpleQuery().forList(sql, parameters);</span>
	}

	/**
	 * Vrati a skontroluje IN zoznam pre SQL tak, aby obsahoval len cisla, cize z &quot;1,xxx,2,3&quot; spravi &quot;1,2,3&quot;
	 * @param ids
	 * @return
	 */
	public static String getOnlyNumbersIn(String ids)
	{
<span class="fc" id="L974">		return getOnlyNumbersIn(ids,false);</span>
	}

	/**
	 * Vrati a skontroluje IN zoznam pre SQL tak, aby obsahoval len cisla, cize z &quot;1,xxx,2,3&quot; spravi &quot;1,2,3&quot;
	 * ak sa jedna o id-cka {@link GroupDetails} tak v pripade ze je zapnuty cloud sa kontroluje aj ich dostupnost pre aktualnu domenu
	 * @param ids
	 * @param checkGroups indikuje ci sa jedna o id-cka GroupDetails
	 * @return
	 */
	public static String getOnlyNumbersIn(String ids, boolean checkGroups)
	{
<span class="fc" id="L986">		StringTokenizer st = new StringTokenizer (ids, &quot;,&quot;);</span>
<span class="fc" id="L987">		StringBuilder ret = new StringBuilder();</span>
<span class="fc" id="L988">		GroupDetails group = null;</span>
<span class="fc" id="L989">		String domain = CloudToolsForCore.getDomainName();</span>
<span class="fc bfc" id="L990" title="All 2 branches covered.">		while (st.hasMoreTokens())</span>
		{
			try
			{
<span class="fc" id="L994">				String sid = st.nextToken();</span>
<span class="fc" id="L995">				sid = sid.replace('(', ' ');</span>
<span class="fc" id="L996">				sid = sid.replace(')', ')');</span>
<span class="fc" id="L997">				sid = sid.trim();</span>
<span class="fc" id="L998">				int id = Integer.parseInt(sid);</span>
<span class="pc bpc" id="L999" title="1 of 4 branches missed.">				if(checkGroups &amp;&amp; InitServlet.isTypeCloud())</span>
				{
<span class="nc" id="L1001">					group = GroupsDB.getInstance().getGroup(id);</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">					if(group != null)</span>
					{
<span class="nc bnc" id="L1004" title="All 2 branches missed.">						if(group.getDomainName().equalsIgnoreCase(domain))</span>
						{
<span class="nc bnc" id="L1006" title="All 2 branches missed.">							if (ret.length()==0) ret = new StringBuilder(String.valueOf(id));</span>
<span class="nc" id="L1007">							else ret.append(',').append(id);</span>
						}
					}
				}
				else
				{
<span class="fc bfc" id="L1013" title="All 2 branches covered.">					if (ret.length()==0) ret = new StringBuilder(String.valueOf(id));</span>
<span class="fc" id="L1014">					else ret.append(',').append(id);</span>
				}


			}
<span class="nc" id="L1019">			catch (Exception ex)</span>
			{

<span class="pc" id="L1022">			}</span>
		}

<span class="fc" id="L1025">		return ret.toString();</span>
	}


	/**
	 * Upravi hodnotu timestampu tak, aby nebola pred zadanym rokom (kedze DB to tak nevedia mat)
	 * @param timestamp
	 * @param year
	 * @return
	 */
	public static long getTimestampNotBeforeYear(long timestamp, int year)
	{
<span class="nc" id="L1037">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1038">		cal.setTimeInMillis(timestamp);</span>

<span class="nc bnc" id="L1040" title="All 2 branches missed.">		if (cal.get(Calendar.YEAR)&lt;year)</span>
		{
<span class="nc" id="L1042">			cal.set(Calendar.YEAR, year);</span>
		}

<span class="nc" id="L1045">		return cal.getTimeInMillis();</span>
	}

	/**
	 * Upravi hodnotu timestampu tak, aby nebola za zadanym rokom (kedze DB to tak nevedia mat)
	 * @param timestamp
	 * @param year
	 * @return
	 */
	public static long getTimestampNotAfterYear(long timestamp, int year)
	{
<span class="nc" id="L1056">		Calendar cal = Calendar.getInstance();</span>
<span class="nc" id="L1057">		cal.setTimeInMillis(timestamp);</span>

<span class="nc bnc" id="L1059" title="All 2 branches missed.">		if (cal.get(Calendar.YEAR)&gt;year)</span>
		{
<span class="nc" id="L1061">			cal.set(Calendar.YEAR, year);</span>
		}

<span class="nc" id="L1064">		return cal.getTimeInMillis();</span>
	}

	/**
	 * Upravi hodnotu timestampu tak, aby nebola pred a za zadanym rokom (kedze DB to tak nevedia mat)
	 * @param timestamp
	 * @param yearFrom
	 * @param yearTo
	 * @return
	 */
	public static long getTimestampNotBeforeAfterYear(long timestamp, int yearFrom, int yearTo)
	{
<span class="nc" id="L1076">		timestamp = getTimestampNotBeforeYear(timestamp, yearFrom);</span>
<span class="nc" id="L1077">		return getTimestampNotAfterYear(timestamp, yearTo);</span>
	}

	/**
	 * osetri HTML znacky v retazci - DEPRECATED, pouzi filterHtml
	 *
	 * @param escapedString
	 * @return*
	 * @deprecated - use filterHtml
	 */
	@Deprecated
	public static String filterEscaped(String escapedString)
	{
<span class="nc" id="L1090">		return filterHtml(escapedString);</span>
	}


	/**
	 * Vrati Integer hodnotu z databazy, pricom korektne vrati aj NULL
	 * @param rs
	 * @param colName
	 * @return
	 * @throws SQLException
	 */
	public static Integer getInteger(ResultSet rs, String colName) throws SQLException {
<span class="fc" id="L1102">		int nValue = rs.getInt(colName);</span>
<span class="fc bfc" id="L1103" title="All 2 branches covered.">		return rs.wasNull() ? null : nValue;</span>
  	}

	/**
	 * Vrati Boolean hodnotu z databazy, pricom korektne vrati aj NULL
	 * @param rs
	 * @param colName
	 * @return
	 * @throws SQLException
	 */
	public static Boolean getBoolean(ResultSet rs, String colName) throws SQLException {
<span class="fc" id="L1114">		boolean nValue = rs.getBoolean(colName);</span>
<span class="fc bfc" id="L1115" title="All 2 branches covered.">		return rs.wasNull() ? null : nValue;</span>
	}

	/**
	 * Returns 1/0 or true/false dependind on DB type
	 * @param b
	 * @return
	 */
	public static String getBooleanSql(boolean b) {
<span class="pc bpc" id="L1124" title="1 of 2 branches missed.">		if (Constants.DB_TYPE == Constants.DB_PGSQL) {</span>
<span class="nc bnc" id="L1125" title="All 2 branches missed.">			return b ? &quot;true&quot; : &quot;false&quot;;</span>
		}
<span class="fc bfc" id="L1127" title="All 2 branches covered.">		return b ? &quot;1&quot; : &quot;0&quot;;</span>
	}

	/**
	 * Add lower/unaccent(column) for case insensitive search in Oracle/PostgreSQL
	 * @param column
	 * @return
	 */
	public static String fixAiCiCol(String column) {
<span class="pc bpc" id="L1136" title="1 of 2 branches missed.">		if (Constants.DB_TYPE == Constants.DB_ORACLE) {</span>
<span class="nc" id="L1137">			return &quot;lower(&quot; + column + &quot;)&quot;;</span>
		}
<span class="pc bpc" id="L1139" title="1 of 2 branches missed.">		else if (Constants.DB_TYPE == Constants.DB_PGSQL) {</span>
<span class="nc" id="L1140">			return &quot;lower(unaccent(&quot; + column + &quot;))&quot;;</span>
		}
<span class="fc" id="L1142">		return column;</span>
	}

	/**
	 * Fix value for case insensitive search in Oracle/PostgreSQL
	 * @param value
	 * @return
	 */
	public static String fixAiCiValue(String value) {
<span class="pc bpc" id="L1151" title="1 of 2 branches missed.">		if (Constants.DB_TYPE == Constants.DB_ORACLE) {</span>
<span class="nc" id="L1152">			return value.toLowerCase();</span>
		}
<span class="pc bpc" id="L1154" title="1 of 2 branches missed.">		else if (Constants.DB_TYPE == Constants.DB_PGSQL) {</span>
<span class="nc" id="L1155">			return DB.internationalToEnglish(value).toLowerCase();</span>
		}
<span class="fc" id="L1157">		return value;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>