<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PasswordSecurity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjet8v9</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm.users</a> &gt; <span class="el_source">PasswordSecurity.java</span></div><h1>PasswordSecurity.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm.users;

import static sk.iway.iwcm.Tools.isAnyEmpty;

import org.apache.commons.lang3.RandomStringUtils;

import sk.iway.iwcm.Constants;
import sk.iway.iwcm.users.crypto.Bcrypt;
import sk.iway.iwcm.users.crypto.Sha512;

/**
 *  PasswordSecurity.java
 *
 *  Contains hash functions helping in
 *  users' password managment and verification.
 *
 *@Title        webjet7
 *@Company      Interway s.r.o. (www.interway.sk)
 *@Copyright    Interway s.r.o. (c) 2001-2011
 *@author       $Author: marosurbanec $
 *@version      $Revision: 1.3 $
 *@created      Date: 4.1.2011 10:38:12
 *@modified     $Date: 2004/08/16 06:26:11 $
 */
public final class PasswordSecurity {

	private PasswordSecurity(){}

	public static String generatePassword(int length) {
<span class="nc" id="L30">		return generatePassword(length, true, true, true, true, true);</span>
	}

	/**
	 * Generates a random string.
	 *
	 * @param length
	 * @param symbols ( e.g. @#$% )
	 * @param numbers ( e.g. 123456 )
	 * @param lowercase ( e.g. abcdefgh )
	 * @param uppercase ( e.g. ABCDEFGH )
	 * @param excludeAmbiguousCharacters ( { } [ ] ( ) / \ ' &quot; ` ~ , ; : . &lt; &gt; )
	 * @return
	 */
	public static String generatePassword(int length, boolean symbols, boolean numbers, boolean lowercase, boolean uppercase, boolean excludeAmbiguousCharacters)
	{
<span class="nc" id="L46">		String symbolsChar = &quot;@#$%&amp;!&quot;;</span>
<span class="nc" id="L47">		String numbersChar = &quot;1234567890&quot;;</span>
<span class="nc" id="L48">		String lowercaseChar = &quot;abcdefghijklmnopqrstuvwxyz&quot;;</span>
<span class="nc" id="L49">		String uppercaseChar = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span>
<span class="nc" id="L50">		String ambiguousCharactersChar = &quot;{}[]()/\\'\&quot;`~,;:.&lt;&gt;&quot;;</span>

<span class="nc" id="L52">		StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">		if (symbols) {</span>
<span class="nc" id="L54">			sb.append(symbolsChar);</span>
		}
<span class="nc bnc" id="L56" title="All 2 branches missed.">		if (numbers) {</span>
<span class="nc" id="L57">			sb.append(numbersChar);</span>
		}
<span class="nc bnc" id="L59" title="All 2 branches missed.">		if (lowercase) {</span>
<span class="nc" id="L60">			sb.append(lowercaseChar);</span>
		}
<span class="nc bnc" id="L62" title="All 2 branches missed.">		if (uppercase) {</span>
<span class="nc" id="L63">			sb.append(uppercaseChar);</span>
		}
<span class="nc bnc" id="L65" title="All 2 branches missed.">		if (!excludeAmbiguousCharacters) {</span>
<span class="nc" id="L66">			sb.append(ambiguousCharactersChar);</span>
		}

<span class="nc" id="L69">		return RandomStringUtils.random(length, sb.toString());</span>
	}

	/**
	 * Generates a random HEX string
	 * chars = [0-9a-f]{16}, lowercase only
	 *
	 * @return {@link String} random hex string
	 */
	public static String generateSalt()
	{
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">		if(Constants.getString(&quot;passwordHashAlgorithm&quot;).equals(&quot;bcrypt&quot;)) {</span>
<span class="fc" id="L81">			Bcrypt bcrypt = new Bcrypt();</span>
<span class="fc" id="L82">			return bcrypt.generateSalt();</span>
		} else {
<span class="nc" id="L84">			Sha512 sha512 = new Sha512();</span>
<span class="nc" id="L85">			return sha512.generateSalt();</span>
		}
	}

	/**
	 * Generates a hash combining password and a salt using concatenation.
	 *
	 * @param password any String
	 * @param salt Generated by generateSalt, must match ^[0-9a-f]{16}$, otherwise rejected
	 * @return [0-9a-f]{128} String
	 */
	public static String calculateHash(String password, String salt)
	{
<span class="pc bpc" id="L98" title="1 of 4 branches missed.">		if(Constants.getString(&quot;passwordHashAlgorithm&quot;).equals(&quot;bcrypt&quot;) &amp;&amp; salt.startsWith(&quot;bcrypt:&quot;)) {</span>
<span class="fc" id="L99">			Bcrypt bcrypt = new Bcrypt();</span>
<span class="fc" id="L100">			return bcrypt.calculateHash(password, salt); //calculateHash can handle salt prefix</span>
		} else {
<span class="fc" id="L102">			Sha512 sha512 = new Sha512();</span>
<span class="fc" id="L103">			return sha512.calculateHash(password, salt);</span>
		}
	}

	public static boolean isPasswordCorrect(String password, String salt, String hash)
	{
<span class="pc bpc" id="L109" title="1 of 2 branches missed.">		if(isAnyEmpty(salt, hash))</span>
<span class="nc" id="L110">			return false;</span>

<span class="pc bpc" id="L112" title="1 of 4 branches missed.">		if(hash.startsWith(&quot;bcrypt:&quot;) &amp;&amp; salt.startsWith(&quot;bcrypt:&quot;)) {</span>
			//!! salt is not required, because is build into hash
<span class="fc" id="L114">			Bcrypt bcrypt = new Bcrypt();</span>
<span class="fc" id="L115">			return bcrypt.isPasswordCorrect(password, salt, hash); //isPasswordCorrect can handle hash prefix</span>
		} else {
<span class="fc" id="L117">			Sha512 sha512 = new Sha512();</span>
<span class="fc" id="L118">			return sha512.isPasswordCorrect(password, salt, hash);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>