/*
 Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
(function(){function U(a,c,d){return n(c)&&n(d)&&d.equals(c.getNext(function(a){return!(E(a)||F(a)||t(a))}))}function y(a){this.upper=a[0];this.lower=a[1];this.set.apply(this,a.slice(2))}function O(a){var c=a.element;if(c&&n(c)&&(c=c.getAscendant(a.triggers,!0))&&a.editable.contains(c)){var d=P(c);if("true"==d.getAttribute("contenteditable"))return c;if(d.is(a.triggers))return d}return null}function ja(a,c,d){q(a,c);q(a,d);a=c.size.bottom;d=d.size.top;return a&&d?0|(a+d)/2:a||d}function v(a,c,d){return c=
c[d?"getPrevious":"getNext"](function(b){return b&&b.type==CKEDITOR.NODE_TEXT&&!E(b)||n(b)&&!t(b)&&!z(a,b)})}function p(a,c,d){return a>c&&a<d}function P(a,c){if(a.data("cke-editable"))return null;for(c||(a=a.getParent());a&&!a.data("cke-editable");){if(a.hasAttribute("contenteditable"))return a;a=a.getParent()}return null}function ka(a){var c=a.doc,d=B('\x3cspan contenteditable\x3d"false" style\x3d"'+G+"position:absolute;border-top:1px solid "+a.boxColor+'; margin-left: 2px; margin-right: 2px;"\x3e\x3c/span\x3e',
c);CKEDITOR.getUrl(this.path+"images/"+(u.hidpi?"hidpi/":"")+"icon"+(a.rtl?"-rtl":"")+".png");r(d,{attach:function(){this.wrap.getParent()||this.wrap.appendTo(a.editable,!0);return this},lineChildren:[r(B('\x3cspan title\x3d"'+a.editor.lang.webjetmagicline.insert+'" contenteditable\x3d"false"\x3e+\x3c/span\x3e',c),{base:G+"height:17px;width:17px; left: 50%; right 50%; transform: translateX(-50%);background-color: #fceba9;cursor:pointer;font-size: 16px;line-height:17px;border:1px solid "+a.boxColor+
";text-align:center;",looks:["top:-10px; border-radius: 2px;","top:-17px; border-radius: 2px 2px 0px 0px;","top:-1px; border-radius: 0px 0px 2px 2px;"]}),r(B('\x3cdiv id\x3d"wjmagiclineItems"\x3e\x3cul\x3e\x3cli style\x3d"background-image:url(/admin/skins/webjet8/ckeditor/dist/plugins/webjetmagicline/img/text.png);"\x3e'+a.editor.lang.webjetmagicline.text+'\x3c/li\x3e\x3cli data-wjcommand\x3d"image" style\x3d"background-image:url(/components/_common/admin/inline/editor-image.gif);"\x3e'+a.editor.lang.webjetmagicline.image+
'\x3c/li\x3e\x3cli data-wjcommand\x3d"webjetcomponentsDialog" style\x3d"background-image:url(/components/_common/admin/inline/editor-components.gif)"\x3e'+a.editor.lang.webjetmagicline.app+'\x3c/li\x3e\x3cli data-wjcommand\x3d"webjethtmlboxDialog" style\x3d"background-image:url(/admin/skins/webjet8/ckeditor/dist/plugins/webjetmagicline/img/templates.png)"\x3e'+a.editor.lang.webjetmagicline.temp+"\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e",c),{base:G+"height:56px;width:224px; left: 50%; right 50%; transform: translateX(-50%);box-sizing:content-box;background-color: #fceba9;font-size: 16px;line-height:17px;border:1px solid "+
a.boxColor+";text-align:center; display: none;",looks:["top:12px; border-radius: 2px;","top:-78px; border-radius: 2px 2px 0px 0px;","top:21px; border-radius: 0px 0px 2px 2px;"]}),r(B(V,c),{base:W+"left:0px;border-left-color:"+a.boxColor+";",looks:["border-width:4px 0 4px 4px;top:-4px","border-width:4px 0 0 4px;top:-4px","border-width:0 0 4px 4px;top:0px"]}),r(B(V,c),{base:W+"right:0px;border-right-color:"+a.boxColor+";",looks:["border-width:4px 4px 4px 0;top:-4px","border-width:4px 4px 0 0;top:-4px",
"border-width:0 4px 4px 0;top:0px"]})],detach:function(){this.wrap.getParent()&&this.wrap.remove();return this},mouseNear:function(){q(a,this);var b=a.holdDistance,c=this.size;return c&&p(a.mouse.y,c.top-b,c.bottom+b)&&p(a.mouse.x,c.left-b,c.right+b)?!0:!1},place:function(){var b=a.view,c=a.editable,d=a.trigger,g=d.upper,l=d.lower,h=g||l,m=h.getParent(),k={};this.trigger=d;g&&q(a,g,!0);l&&q(a,l,!0);q(a,m,!0);a.inInlineMode&&H(a,!0);m.equals(c)?(k.left=b.scroll.x,k.right=-b.scroll.x,k.width=""):(k.left=
h.size.left-h.size.margin.left+b.scroll.x-(a.inInlineMode?b.editable.left+b.editable.border.left:0),k.width=h.size.outerWidth+h.size.margin.left+h.size.margin.right+b.scroll.x,k.right="");g&&l?k.top=g.size.margin.bottom===l.size.margin.top?0|g.size.bottom+g.size.margin.bottom/2:g.size.margin.bottom<l.size.margin.top?g.size.bottom+g.size.margin.bottom:g.size.bottom+g.size.margin.bottom-l.size.margin.top:g?l||(k.top=g.size.bottom):k.top=l.size.top;d.is(C)||p(k.top,b.scroll.y-15,b.scroll.y+5)?(k.top=
a.inInlineMode?0:b.scroll.y,this.look(C)):d.is(D)||p(k.top,b.pane.bottom-5,b.pane.bottom+15)?(k.top=a.inInlineMode?b.editable.height+b.editable.padding.top+b.editable.padding.bottom:b.pane.bottom-1,this.look(D)):(a.inInlineMode&&(k.top-=b.editable.top+b.editable.border.top),this.look(w));a.inInlineMode&&(k.top--,k.top+=b.editable.scroll.top,k.left+=b.editable.scroll.left);for(var X in k)k[X]=CKEDITOR.tools.cssLength(k[X]);this.setStyles(k)},look:function(a){if(this.oldLook!=a){for(var c=this.lineChildren.length,
d;c--;)(d=this.lineChildren[c]).setAttribute("style",d.base+d.looks[0|a/2]);this.oldLook=a}},wrap:new Q("span",a.doc)});for(c=d.lineChildren.length;c--;)d.lineChildren[c].appendTo(d);d.look(w);d.appendTo(d.wrap);d.unselectable();d.lineChildren[0].on("mouseup",function(b){d.lineChildren[1].forEach(function(b){"LI"==b.$.tagName&&null==b.getAttribute("data-wjmouseup")&&(b.setAttribute("data-wjmouseup","1"),b.on("mouseup",function(c){var g=b.getAttribute("data-wjcommand");d.detach();R(a,function(b){var c=
a.line.trigger;b[c.is(I)?"insertBefore":"insertAfter"](c.is(I)?c.lower:c.upper)},!0);a.editor.focus();u.ie||a.enterMode==CKEDITOR.ENTER_BR||a.hotNode.scrollIntoView();c.data.preventDefault(!0);d.lineChildren[1].hide();null!=g&&void 0!=g&&setTimeout(function(){a.editor.execCommand(g)},100)}))});setTimeout(function(){d.attach();d.lineChildren[1].show();a.hiddenMode=1},100);b.data.preventDefault(!0)});d.on("mousedown",function(a){a.data.preventDefault(!0)});a.line=d}function R(a,c,d){var b=new CKEDITOR.dom.range(a.doc),
e=a.editor,f;u.ie&&a.enterMode==CKEDITOR.ENTER_BR?f=a.doc.createText(J):(f=(f=P(a.element,!0))&&f.data("cke-enter-mode")||a.enterMode,f=new Q(K[f],a.doc),f.is("br")||a.doc.createText(J).appendTo(f));d&&e.fire("saveSnapshot");c(f);b.moveToPosition(f,CKEDITOR.POSITION_AFTER_START);e.getSelection().selectRanges([b]);a.hotNode=f;d&&e.fire("saveSnapshot")}function Y(a,c){return{canUndo:!0,modes:{wysiwyg:1},exec:function(){function d(b){var d=u.ie&&9>u.version?" ":J,f=a.hotNode&&a.hotNode.getText()==d&&
a.element.equals(a.hotNode)&&a.lastCmdDirection===!!c;R(a,function(d){f&&a.hotNode&&a.hotNode.remove();d[c?"insertAfter":"insertBefore"](b);d.setAttributes({"data-cke-magicline-hot":1,"data-cke-magicline-dir":!!c});a.lastCmdDirection=!!c});u.ie||a.enterMode==CKEDITOR.ENTER_BR||a.hotNode.scrollIntoView();a.line.detach()}return function(b){b=b.getSelection().getStartElement();var e;b=b.getAscendant(la,1);if(!Z(a,b)&&b&&!b.equals(a.editable)&&!b.contains(a.editable)){(e=P(b))&&"false"==e.getAttribute("contenteditable")&&
(b=e);a.element=b;e=v(a,b,!c);var f;n(e)&&e.is(a.triggers)&&e.is(ma)&&(!v(a,e,!c)||(f=v(a,e,!c))&&n(f)&&f.is(a.triggers))?d(e):(f=O(a,b),n(f)&&(v(a,f,!c)?(b=v(a,f,!c))&&n(b)&&b.is(a.triggers)&&d(f):d(f)))}}}()}}function z(a,c){if(!c||c.type!=CKEDITOR.NODE_ELEMENT||!c.$)return!1;var d=a.line;return d.wrap.equals(c)||d.wrap.contains(c)}function n(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.$}function t(a){if(!n(a))return!1;var c;(c=aa(a))||(n(a)?(c={left:1,right:1,center:1},c=!(!c[a.getComputedStyle("float")]&&
!c[a.getAttribute("align")])):c=!1);return c}function aa(a){return!!{absolute:1,fixed:1}[a.getComputedStyle("position")]}function L(a,c){return n(c)?c.is(a.triggers):null}function Z(a,c){if(!c)return!1;for(var d=c.getParents(1),b=d.length;b--;)for(var e=a.tabuList.length;e--;)if(d[b].hasAttribute(a.tabuList[e]))return!0;return!1}function na(a,c,d){c=c[d?"getLast":"getFirst"](function(b){return a.isRelevant(b)&&!b.is(oa)});if(!c)return!1;q(a,c);return d?c.size.top>a.mouse.y:c.size.bottom<a.mouse.y}
function ba(a){var c=a.editable,d=a.mouse,b=a.view,e=a.triggerOffset;H(a);var f=d.y>(a.inInlineMode?b.editable.top+b.editable.height/2:Math.min(b.editable.height,b.pane.height)/2),c=c[f?"getLast":"getFirst"](function(a){return!(E(a)||F(a))});if(!c)return null;z(a,c)&&(c=a.line.wrap[f?"getPrevious":"getNext"](function(a){return!(E(a)||F(a))}));if(!n(c)||t(c)||!L(a,c))return null;q(a,c);return!f&&0<=c.size.top&&p(d.y,0,c.size.top+e)?(a=a.inInlineMode||0===b.scroll.y?C:w,new y([null,c,I,M,a])):f&&c.size.bottom<=
b.pane.height&&p(d.y,c.size.bottom-e,b.pane.height)?(a=a.inInlineMode||p(c.size.bottom,b.pane.height-e,b.pane.height)?D:w,new y([c,null,ca,M,a])):null}function da(a){var c=a.mouse,d=a.view,b=a.triggerOffset,e=O(a);if(!e)return null;q(a,e);var b=Math.min(b,0|e.size.outerHeight/2),f=[],g,l;if(p(c.y,e.size.top-1,e.size.top+b))l=!1;else if(p(c.y,e.size.bottom-b,e.size.bottom+1))l=!0;else return null;if(t(e)||na(a,e,l)||e.getParent().is(ea))return null;var h=v(a,e,!l);if(h){if(h&&h.type==CKEDITOR.NODE_TEXT)return null;
if(n(h)){if(t(h)||!L(a,h)||h.getParent().is(ea))return null;f=[h,e][l?"reverse":"concat"]().concat([S,M])}}else e.equals(a.editable[l?"getLast":"getFirst"](a.isRelevant))?(H(a),l&&p(c.y,e.size.bottom-b,d.pane.height)&&p(e.size.bottom,d.pane.height-b,d.pane.height)?g=D:p(c.y,0,e.size.top+b)&&(g=C)):g=w,f=[null,e][l?"reverse":"concat"]().concat([l?ca:I,M,g,e.equals(a.editable[l?"getLast":"getFirst"](a.isRelevant))?l?D:C:w]);return 0 in f?new y(f):null}function T(a,c,d,b){for(var e=c.getDocumentPosition(),
f={},g={},l={},h={},m=x.length;m--;)f[x[m]]=parseInt(c.getComputedStyle.call(c,"border-"+x[m]+"-width"),10)||0,l[x[m]]=parseInt(c.getComputedStyle.call(c,"padding-"+x[m]),10)||0,g[x[m]]=parseInt(c.getComputedStyle.call(c,"margin-"+x[m]),10)||0;d&&!b||N(a,b);h.top=e.y-(d?0:a.view.scroll.y);h.left=e.x-(d?0:a.view.scroll.x);h.outerWidth=c.$.offsetWidth;h.outerHeight=c.$.offsetHeight;h.height=h.outerHeight-(l.top+l.bottom+f.top+f.bottom);h.width=h.outerWidth-(l.left+l.right+f.left+f.right);h.bottom=h.top+
h.outerHeight;h.right=h.left+h.outerWidth;a.inInlineMode&&(h.scroll={top:c.$.scrollTop,left:c.$.scrollLeft});return r({border:f,padding:l,margin:g,ignoreScroll:d},h,!0)}function q(a,c,d){if(!n(c))return c.size=null;if(!c.size)c.size={};else if(c.size.ignoreScroll==d&&c.size.date>new Date-fa)return null;return r(c.size,T(a,c,d),{date:+new Date},!0)}function H(a,c){a.view.editable=T(a,a.editable,c,!0)}function N(a,c){a.view||(a.view={});var d=a.view;if(!(!c&&d&&d.date>new Date-fa)){var b=a.win,d=b.getScrollPosition(),
b=b.getViewPaneSize();r(a.view,{scroll:{x:d.x,y:d.y,width:a.doc.$.documentElement.scrollWidth-b.width,height:a.doc.$.documentElement.scrollHeight-b.height},pane:{width:b.width,height:b.height,bottom:b.height+d.y},date:+new Date},!0)}}function pa(a,c,d,b){for(var e=b,f=b,g=0,l=!1,h=!1,m=a.view.pane.height,k=a.mouse;k.y+g<m&&0<k.y-g;){l||(l=c(e,b));h||(h=c(f,b));!l&&0<k.y-g&&(e=d(a,{x:k.x,y:k.y-g}));!h&&k.y+g<m&&(f=d(a,{x:k.x,y:k.y+g}));if(l&&h)break;g+=2}return new y([e,f,null,null])}CKEDITOR.plugins.add("webjetmagicline",
{lang:"af,ar,bg,ca,cs,cy,da,de,el,en,en-gb,eo,es,et,eu,fa,fi,fr,fr-ca,gl,he,hr,hu,id,it,ja,km,ko,ku,lv,nb,nl,no,pl,pt,pt-br,ru,si,sk,sl,sq,sv,tr,tt,ug,uk,vi,zh,zh-cn",init:function(a){var c=a.config,d=c.magicline_triggerOffset||30,b={editor:a,enterMode:c.enterMode,triggerOffset:d,holdDistance:0|d*(c.magicline_holdDistance||.5),boxColor:c.magicline_color||"#ff0000",rtl:"rtl"==c.contentsLangDirection,tabuList:["data-cke-hidden-sel"].concat(c.magicline_tabuList||[]),triggers:c.magicline_triggers},e,
f,g;b.isRelevant=function(a){return n(a)&&!z(b,a)&&!t(a)};a.on("contentDom",function(){var d=a.editable(),h=a.document,m=a.window;r(b,{editable:d,inInlineMode:d.isInline(),doc:h,win:m,hotNode:null},!0);b.boundary=b.inInlineMode?b.editable:b.doc.getDocumentElement();d.is(A.$inline)||(b.inInlineMode&&!aa(d)&&d.setStyles({position:"relative",top:null,left:null}),ka.call(this,b),N(b),d.attachListener(a,"beforeUndoImage",function(a){b.line.detach();b.line.lineChildren[1].hide()}),d.attachListener(a,"beforeGetData",
function(){b.line.wrap.getParent()&&(b.line.detach(),a.once("getData",function(){b.line.attach()},null,null,1E3))},null,null,0),d.attachListener(b.inInlineMode?h:h.getWindow().getFrame(),"XXXmouseout",function(c){if("wysiwyg"==a.mode)if(b.inInlineMode){var d=c.data.$.clientX;c=c.data.$.clientY;N(b);H(b,!0);var e=b.view.editable,f=b.view.scroll;d>e.left-f.x&&d<e.right-f.x&&c>e.top-f.y&&c<e.bottom-f.y||(clearTimeout(g),g=null,b.line.detach())}else clearTimeout(g),g=null,b.line.detach()}),d.attachListener(d,
"keyup",function(){b.hiddenMode=0}),d.attachListener(d,"keydown",function(c){if("wysiwyg"==a.mode)switch(c.data.getKeystroke()){case 2228240:case 16:b.hiddenMode=1,b.line.detach()}}),d.attachListener(b.inInlineMode?d:h,"mousemove",function(c){f=!0;if("wysiwyg"==a.mode&&!a.readOnly&&!g){var d={x:c.data.$.clientX,y:c.data.$.clientY};g=setTimeout(function(){b.mouse=d;g=b.trigger=null;N(b);f&&!b.hiddenMode&&a.focusManager.hasFocus&&!b.line.mouseNear()&&(b.element=ga(b,!0))&&((b.trigger=ba(b)||da(b)||
ha(b))&&!Z(b,b.trigger.upper||b.trigger.lower)?b.line.attach().place():(b.trigger=null,b.line.detach()),f=!1)},30)}}),d.attachListener(m,"scroll",function(){"wysiwyg"==a.mode&&(b.line.detach(),u.webkit&&(b.hiddenMode=1,clearTimeout(e),e=setTimeout(function(){b.mouseDown||(b.hiddenMode=0)},50)))}),d.attachListener(ia?h:m,"mousedown",function(){"wysiwyg"==a.mode&&(b.line.detach(),b.hiddenMode=1,b.mouseDown=1)}),d.attachListener(ia?h:m,"mouseup",function(){b.hiddenMode=0;b.mouseDown=0}),a.addCommand("accessPreviousSpace",
Y(b)),a.addCommand("accessNextSpace",Y(b,!0)),a.setKeystroke([[c.magicline_keystrokePrevious,"accessPreviousSpace"],[c.magicline_keystrokeNext,"accessNextSpace"]]),a.on("loadSnapshot",function(){var c,d,e,f;for(f in{p:1,br:1,div:1})for(c=a.document.getElementsByTag(f),e=c.count();e--;)if((d=c.getItem(e)).data("cke-magicline-hot")){b.hotNode=d;b.lastCmdDirection="true"===d.data("cke-magicline-dir")?!0:!1;return}}),this.backdoor={accessFocusSpace:R,boxTrigger:y,isLine:z,getAscendantTrigger:O,getNonEmptyNeighbour:v,
getSize:T,that:b,triggerEdge:da,triggerEditable:ba,triggerExpand:ha})},this)}});var r=CKEDITOR.tools.extend,Q=CKEDITOR.dom.element,B=Q.createFromHtml,u=CKEDITOR.env,ia=CKEDITOR.env.ie&&9>CKEDITOR.env.version,A=CKEDITOR.dtd,K={},I=128,ca=64,S=32,M=16,C=4,D=2,w=1,J=" ",ea=A.$listItem,oa=A.$tableContent,ma=r({},A.$nonEditable,A.$empty),la=A.$block,fa=100,G="width:0px;height:0px;padding:0px;margin:0px;display:block;z-index:9999;color:#fff;position:absolute;font-size: 0px;line-height:0px;",W=G+"border-color:transparent;display:block;border-style:solid;",
V="\x3cspan\x3e"+J+"\x3c/span\x3e";K[CKEDITOR.ENTER_BR]="br";K[CKEDITOR.ENTER_P]="p";K[CKEDITOR.ENTER_DIV]="div";y.prototype={set:function(a,c,d){this.properties=a+c+(d||w);return this},is:function(a){return(this.properties&a)==a}};var ga=function(){function a(a,d){var b=a.$.elementFromPoint(d.x,d.y);return b&&b.nodeType?new CKEDITOR.dom.element(b):null}return function(c,d,b){if(!c.mouse)return null;var e=c.doc,f=c.line.wrap;b=b||c.mouse;var g=a(e,b);d&&z(c,g)&&(f.hide(),g=a(e,b),f.show());return!g||
g.type!=CKEDITOR.NODE_ELEMENT||!g.$||u.ie&&9>u.version&&!c.boundary.equals(g)&&!c.boundary.contains(g)?null:g}}(),E=CKEDITOR.dom.walker.whitespaces(),F=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_COMMENT),ha=function(){function a(a){var b=a.element,e,f,g;if(!n(b)||b.contains(a.editable)||b.isReadOnly())return null;g=pa(a,function(a,b){return!b.equals(a)},function(a,b){return ga(a,!0,b)},b);e=g.upper;f=g.lower;if(U(a,e,f))return g.set(S,8);if(e&&b.contains(e))for(;!e.getParent().equals(b);)e=e.getParent();
else e=b.getFirst(function(b){return c(a,b)});if(f&&b.contains(f))for(;!f.getParent().equals(b);)f=f.getParent();else f=b.getLast(function(b){return c(a,b)});if(!e||!f)return null;q(a,e);q(a,f);if(!p(a.mouse.y,e.size.top,f.size.bottom))return null;for(var b=Number.MAX_VALUE,l,h,m,k;f&&!f.equals(e)&&(h=e.getNext(a.isRelevant));)l=Math.abs(ja(a,e,h)-a.mouse.y),l<b&&(b=l,m=e,k=h),e=h,q(a,e);if(!m||!k||!p(a.mouse.y,m.size.top,k.size.bottom))return null;g.upper=m;g.lower=k;return g.set(S,8)}function c(a,
b){return!(b&&b.type==CKEDITOR.NODE_TEXT||F(b)||t(b)||z(a,b)||b.type==CKEDITOR.NODE_ELEMENT&&b.$&&b.is("br"))}return function(c){var b=a(c),e;if(e=b){e=b.upper;var f=b.lower;e=!e||!f||t(f)||t(e)||f.equals(e)||e.equals(f)||f.contains(e)||e.contains(f)?!1:L(c,e)&&L(c,f)&&U(c,e,f)?!0:!1}return e?b:null}}(),x=["top","left","right","bottom"]})();CKEDITOR.config.magicline_keystrokePrevious=CKEDITOR.CTRL+CKEDITOR.SHIFT+51;CKEDITOR.config.magicline_keystrokeNext=CKEDITOR.CTRL+CKEDITOR.SHIFT+52;