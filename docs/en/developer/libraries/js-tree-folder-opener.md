# 'JsTree Folder Opener'

Expanding library

***

**Dependencies**

- [Tools](tools.md)

***

The library allows automated manipulation (opening) of tree nodes generated by the jsTree library, based on the node (folder) ID.

Expands the class `AbstractJsTreeOpener`

```javascript
import AbstractJsTreeOpener from "../abstract-opener/abstract-js-tree-opener";

export class JsTreeFolderOpener extends AbstractJsTreeOpener {}
```

***

## Creating an instance:

**WebJET** creates an instance in the file [app.js](https://github.com/webjetcms/webjetcms/blob/main/src/main/webapp/admin/v9/src/js/app.js)

```javascript
import JsTreeFolderOpener from "./libs/js-tree-document-opener/js-tree-document-opener";

window.jsTreeFolderOpener = new JsTreeFolderOpener();
```

**Application:**

### Initiation:

Ideally, the initialization is performed whenever the jstree is initialized by calling the method [init()](#init)

```javascript
window.jsTreeFolderOpener.init();
```

Wo **WebJET** initialization is in progress in the file [app-init.js](https://github.com/webjetcms/webjetcms/blob/main/src/main/webapp/admin/v9/src/js/app-init.js)

```javascript
window.jstree = somStromcek.jstree({
    'core': {
        'check_callback': function (operation, node, parent, position, more) {},
        'data': function (obj, callback) {
            window.jsTreeFolderOpener.init();
        }
    }
});
```

Method [init()](#init) ensure: <a id="init-algo" />
- Parses from the browser url using [Tools.getUrlQuery()](tools.md#geturlquery) search query after question mark
- Removes the key from the evaporated object `groupid` if we haven't changed it before with [idKeyName](#idkeyname)
- The value of z `groupid` sows with a setter [id](#id)
- Setter [id](#id) resets the class to the new state and validates the input: <a id="id-algo" />
  - If the input is invalid, the DEV environment prints a message about the invalid input and aborts the execution
    - The class switches to the state `Not Ready & Iddle`, waiting for the setter's call [id](#id)
  - If the input is valid, a request is made to the API, whose default address can be changed using [apiUrl](#apiurl)
    - The received data is stored in the class so that it can be worked with
    - The class switches to the state `Ready & Iddle` and waiting for the call [next()](#next) or [id](#id)

***

### Opening tree nodes:

Opening tree nodes is done by calling the method [next()](#next):

```javascript
window.jsTreeFolderOpener.next();
```

Wo **WebJET** a call is in progress in the file [app-init.js](https://github.com/webjetcms/webjetcms/blob/main/src/main/webapp/admin/v9/src/js/app-init.js)

1. After thinning the tree `/listener: loaded.jstree`

2. After opening (*open node*) of the node `/listener: after_open.jstree`

3. After selecting (*select node*) of the node `/listener: select_node.jstree`

Entering special tags in the parameter is supported `groupid`:
- `SYSTEM` - the System tab opens
- `TRASH` - the Basket tab opens

An example of such a URL: `/admin/v9/webpages/web-pages-list/?groupid=SYSTEM`.

***

!>**Warning:** In case we want to externally set [id](#id) it is good to use the method before [loaded()](#Retrieved-from) in which we can call [next()](#next) and test [notFound](#notfound).

```javascript
/** @type {JsTreeFolderOpener} jstfo */
const jstfo = window.jsTreeFolderOpener.loaded((result, docId, selfClass) => {
    if (selfClass.notFound) {
        // Napr. nejaký alert pre používateľa
    } else {
        selfClass.next();
    }
});

jstfo.id = 4;
```

***

## List of APIs

**(Click to see the detail for the function)**

| Methods | Gettery | Settery |
| --------------------------------- | --------------------- | ----------------------- |
| [init()](#init)                   | [notFound](#notfound) | [id](#id)               |
| [next()](#next)                   | | [apiUrl](#apiurl)       |
| [loaded()](#Retrieved-from)               | | [idKeyName](#idkeyname) |
| [inputDataFrom()](#inputdatafrom) | | |
| [setInputValue()](#setinputvalue) | | |

***

### Detailed description of functions

#### init()

Invokes an initialization that provides [the following procedure](#init-algo)

```javascript
/**
 * @description Inicializácia po načítaní jstree
 * @returns {void}
 * @public
 */
window.jsTreeFolderOpener.init();
```

***

#### next()

Opens the next node in the sequence.

```javascript
/**
 * @description Otvorí nasledujúci node v poradí.
 * @returns {void}
 * @public
 */
window.jsTreeFolderOpener.next();
```

***

#### loaded()

Sets a callback that is executed after a new [id](#id) and receipt of data.

```javascript
/**
 * @description Nastaví callback, ktorý sa vykoná po zadaní nového DocID a prijatí dát.
 * @param {Function} callback [result, docId, JsTreeFolderOpener]
 * @returns {JsTreeFolderOpener}
 * @public
 */
window.jsTreeFolderOpener.loaded(callback);
```

***

#### inputDataFrom()

Connects the specified input, which must be inserted as a jQuery object `$('.input-css-trieda')`. Input ensures entering a new ID

```javascript
/**
 * @description Pripojí zadaný input, ktorý musí byť vložený ako jQuery objekt `$('.input-css-trieda')`
 *              Input zabezpečuje zadanie nového ID
 * @param {jQuery} openerInput jQuery selector for input
 * @param {function} [withNotifyCallback] Callback, ktorý sa vykoná, pri chybnom vstupe.
 *                                        V callbacku je dostupný argument `value`
 * @returns {void}
 * @public
 */
window.jsTreeFolderOpener.inputDataFrom(openerInput, withNotifyCallback);
```

***

#### setInputValue()

If it was connected using [inputDataFrom()](#inputdatafrom) input, we can set the value of the input from anywhere.

```javascript
/**
 * @description Ak bol pripojený pomocou inputDataFrom() input, tak danému inputu môžeme odkiaľkoľvek nastaviť value.
 * @see inputDataFrom
 * @param {string|number} value
 * @returns {void}
 * @public
 */
window.jsTreeFolderOpener.setInputValue(value);
```

***

#### id

Set a new folder ID. This ID will be sent via API

[Click for more info what setter id does](#id-algo)

```javascript
/**
 * @description Nastavenie nového ID priečinka.
 *              Toto ID bude odoslané cez API
 * @default groupid
 * @param {number|string} id
 * @returns {void}
 * @public
 * @setter
 */
window.jsTreeFolderOpener.docId = value;
```

***

#### apiUrl

Setting up a new API url

```javascript
/**
 * @description Nastavenie novej API url
 * @param {string} value
 * @example
 *          API url bez ID
 *          `/admin/rest/web-pages/parents/`
 * @returns {void}
 * @public
 * @setter
 */
window.jsTreeFolderOpener.apiUrl = value;
```

***

#### idKeyName

The new name of the URl query key that will contain the node ID.

```javascript
/**
 * @description Nový názov URl query kľúča, v ktorom sa bude nachádzať ID uzla.
 * @param {string} value
 * @returns {void}
 * @public
 * @setter
 */
window.jsTreeFolderOpener.idKeyName = value;
```

***

#### notFound

It is used to determine if, after receiving data, the node we want to open first exists in the jsTree. If such a node does not exist (not found), then the value TRUE is returned. If such a node exists (has been found), then the value FALSE is returned.

The ideal use of this getter is inside a method [loaded()](#Retrieved-from)

```javascript
/**
 * @description Slúži na zistenie, či po prijatí dát, existuje v jsTree uzol, ktorý chceme otvoriť ako prvý.
 *              Ak takýto uzol neexistuje (nebol nájdený / not found), tak sa nám vráti hodnota TRUE
 *              Ak takýto uzol existuje (bol nájdený / found), tak sa nám vráti hodnota FALSE
 *              Ideálne použitie tohto gettera je vo vnútri metódy loaded()
 * @returns {boolean}
 * @public
 * @getter
 */
window.jsTreeFolderOpener.notFound;
```

***
